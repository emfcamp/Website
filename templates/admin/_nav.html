{% macro badge(count) %}
    {% if count > 0 %}
        <span class="badge">{{count}}</span>
    {% endif %}
{% endmacro %}

{% macro menuitem(text, view, badge_count=0) %}
<li {% if view_name == view -%} class="active" {%- endif %}>
    <a href="{{url_for(view)}}">{{text}}{{badge(badge_count)}}</a>
</li>
{% endmacro %}

<ul class="nav navbar-nav">
    {% if current_user.has_permission('admin') %}
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
            aria-haspopup="true" aria-expanded="false">Payments
            {{badge(requested_refund_count + unreconciled_count + expiring_count)}}
            <span class="caret"></span></a>
        <ul class="dropdown-menu">
            {{ menuitem("All", "admin.payments") }}
            {{ menuitem("Refunds Requested", "admin.refunds", requested_refund_count) }}
            <li role="separator" class="divider"></li>
            {{ menuitem("Bank Transfer", "admin.transactions", unreconciled_count) }}
            {{ menuitem("Expiring", "admin.expiring", expiring_count) }}
            {{ menuitem("Suppressed Transactions", "admin.suppressed") }}
        </ul>
    </li>
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
            aria-haspopup="true" aria-expanded="false">Tickets <span class="caret"></span></a>
        <ul class="dropdown-menu">
            {{ menuitem("Paid", "admin.tickets") }}
            {{ menuitem("Unpaid", "admin.tickets_unpaid") }}
            {{ menuitem("Free Tickets", "admin.list_free_tickets") }}
            <li role="separator" class="divider"></li>
            {{ menuitem("Issue or Reserve Tickets", "admin.tickets_issue") }}
        </ul>
    </li>
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
            aria-haspopup="true" aria-expanded="false">Hires <span class="caret"></span></a>
        <ul class="dropdown-menu">
            {{ menuitem("All Hires", "admin.hire") }}
        </ul>
    </li>
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
            aria-haspopup="true" aria-expanded="false">Products <span class="caret"></span></a>
        <ul class="dropdown-menu">
            {{ menuitem("Overview", "admin.products.products_main") }}
            <li role="separator" class="divider"></li>
            {{ menuitem("Product Views", "admin.product_views.product_views_main") }}
            <li role="separator" class="divider"></li>
            {{ menuitem("Arrivals Views", "admin.arrivals_views") }}
        </ul>
    </li>
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
            aria-haspopup="true" aria-expanded="false">Users <span class="caret"></span></a>
        <ul class="dropdown-menu">
            {{ menuitem("All users", "admin.users") }}
            {{ menuitem("Signup link", "admin.user_signup") }}
        </ul>
    </li>

    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
            aria-haspopup="true" aria-expanded="false">Config <span class="caret"></span></a>
        <ul class="dropdown-menu">
            {{ menuitem("Feature Flags", "admin.feature_flags") }}
            {{ menuitem("Site States", "admin.site_states") }}
            {{ menuitem("Schedule Messages", "admin.all_messages") }}
            {{ menuitem("Payments", "admin.payment_config_verify") }}
            {{ menuitem("Scheduled Tasks", "admin.scheduled_tasks") }}
        </ul>
    </li>
    <li role="separator" class="divider"></li>
    {{ menuitem("CfP", "cfp_review.main") }}
    {{ menuitem("Volunteers", "volunteer_admin.index") }}
    {{ menuitem("Villages", "villages.admin") }}
{% endif %}
</ul>
<form class="navbar-form navbar-right" action="{{url_for('admin.search')}}" method="get">
    <div class="form-group">
        <input type="text" class="form-control" placeholder="Search" name="q" value="{{q}}">
    </div>
</form>

