"""currency_enum

Revision ID: 1022e87cb291
Revises: ceb7b5b33993
Create Date: 2025-08-28 21:54:02.810145

"""

# revision identifiers, used by Alembic.
revision = '1022e87cb291'
down_revision = 'ceb7b5b33993'

import enum
from alembic import op
import sqlalchemy as sa

# Work around https://github.com/sqlalchemy/alembic/issues/278
class Currency(enum.StrEnum):
    GBP = "GBP"
    EUR = "EUR"

def upgrade():
    currency = sa.Enum(Currency, name="currency")
    currency.create(op.get_bind(), checkfirst=True)
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('payment', schema=None) as batch_op:
        batch_op.alter_column('currency',
               existing_type=sa.VARCHAR(),
               type_=sa.Enum('GBP', 'EUR', name='currency'),
               existing_nullable=False,
               postgresql_using="currency::currency")

    with op.batch_alter_table('payment_version', schema=None) as batch_op:
        batch_op.alter_column('currency',
               existing_type=sa.VARCHAR(),
               type_=sa.Enum('GBP', 'EUR', name='currency'),
               existing_nullable=True,
               autoincrement=False,
               postgresql_using="currency::currency")

    with op.batch_alter_table('price', schema=None) as batch_op:
        batch_op.alter_column('currency',
               existing_type=sa.VARCHAR(),
               type_=sa.Enum('GBP', 'EUR', name='currency'),
               existing_nullable=False,
               postgresql_using="currency::currency")

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('price', schema=None) as batch_op:
        batch_op.alter_column('currency',
               existing_type=sa.Enum('GBP', 'EUR', name='currency'),
               type_=sa.VARCHAR(),
               existing_nullable=False)

    with op.batch_alter_table('payment_version', schema=None) as batch_op:
        batch_op.alter_column('currency',
               existing_type=sa.Enum('GBP', 'EUR', name='currency'),
               type_=sa.VARCHAR(),
               existing_nullable=True,
               autoincrement=False)

    with op.batch_alter_table('payment', schema=None) as batch_op:
        batch_op.alter_column('currency',
               existing_type=sa.Enum('GBP', 'EUR', name='currency'),
               type_=sa.VARCHAR(),
               existing_nullable=False)

    # ### end Alembic commands ###
    currency = sa.Enum(Currency, name="currency")
    currency.drop(op.get_bind())
