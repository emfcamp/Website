/*
@license
dhtmlxScheduler v.4.3.35 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
function dtmlXMLLoaderObject(e,t,i,s){return this.xmlDoc="","undefined"!=typeof i?this.async=i:this.async=!0,this.onloadAction=e||null,this.mainObject=t||null,this.waitCall=null,this.rSeed=s||!1,this}function callerFunction(e,t){return this.handler=function(i){return i||(i=window.event),e(i,t),!0},this.handler}function getAbsoluteLeft(e){return getOffset(e).left}function getAbsoluteTop(e){return getOffset(e).top}function getOffsetSum(e){for(var t=0,i=0;e;)t+=parseInt(e.offsetTop),i+=parseInt(e.offsetLeft),
e=e.offsetParent;return{top:t,left:i}}function getOffsetRect(e){var t=e.getBoundingClientRect(),i=document.body,s=document.documentElement,r=window.pageYOffset||s.scrollTop||i.scrollTop,a=window.pageXOffset||s.scrollLeft||i.scrollLeft,n=s.clientTop||i.clientTop||0,d=s.clientLeft||i.clientLeft||0,o=t.top+r-n,l=t.left+a-d;return{top:Math.round(o),left:Math.round(l)}}function getOffset(e){return e.getBoundingClientRect?getOffsetRect(e):getOffsetSum(e)}function convertStringToBoolean(e){switch("string"==typeof e&&(e=e.toLowerCase()),
e){case"1":case"true":case"yes":case"y":case 1:case!0:return!0;default:return!1}}function getUrlSymbol(e){return-1!=e.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.lastLanding=0,this.dragNode=0,this.dragStartNode=0,this.dragStartObject=0,this.tempDOMU=null,this.tempDOMM=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function _dhtmlxError(e,t,i){return this.catches||(this.catches=[]),this}function dhtmlXHeir(e,t){for(var i in t)"function"==typeof t[i]&&(e[i]=t[i]);
return e}function dataProcessor(e){return this.serverProcessor=e,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",
error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhtmlxEventable(this),this}window.dhtmlXScheduler=window.scheduler={version:"4.3.35"},window.dhtmlx||(dhtmlx=function(e){for(var t in e)dhtmlx[t]=e[t];return dhtmlx}),dhtmlx.extend_api=function(e,t,i){var s=window[e];s&&(window[e]=function(e){var i;if(e&&"object"==typeof e&&!e.tagName){i=s.apply(this,t._init?t._init(e):arguments);for(var r in dhtmlx)t[r]&&this[t[r]](dhtmlx[r]);for(var r in e)t[r]?this[t[r]](e[r]):0===r.indexOf("on")&&this.attachEvent(r,e[r]);
}else i=s.apply(this,arguments);return t._patch&&t._patch(this),i||this},window[e].prototype=s.prototype,i&&dhtmlXHeir(window[e].prototype,i))},dhtmlxAjax={get:function(e,t){var i=new dtmlXMLLoaderObject(!0);return i.async=arguments.length<3,i.waitCall=t,i.loadXML(e),i},post:function(e,t,i){var s=new dtmlXMLLoaderObject(!0);return s.async=arguments.length<4,s.waitCall=i,s.loadXML(e,!0,t),s},getSync:function(e){return this.get(e,null,!0)},postSync:function(e,t){return this.post(e,t,null,!0)}},dtmlXMLLoaderObject.count=0,
dtmlXMLLoaderObject.prototype.waitLoadFunction=function(e){var t=!0;return this.check=function(){if(e&&e.onloadAction&&(!e.xmlDoc.readyState||4==e.xmlDoc.readyState)){if(!t)return;t=!1,dtmlXMLLoaderObject.count++,"function"==typeof e.onloadAction&&e.onloadAction(e.mainObject,null,null,null,e),e.waitCall&&(e.waitCall.call(this,e),e.waitCall=null)}},this.check},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(e,t){var i;if(this.xmlDoc.responseXML){var s=this.xmlDoc.responseXML.getElementsByTagName(e);
if(0===s.length&&-1!=e.indexOf(":"))var s=this.xmlDoc.responseXML.getElementsByTagName(e.split(":")[1]);i=s[0]}else i=this.xmlDoc.documentElement;if(i)return this._retry=!1,i;if(!this._retry&&_isIE){this._retry=!0;var t=this.xmlDoc;return this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(e,t)}return dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),document.createElement("DIV")},dtmlXMLLoaderObject.prototype.loadXMLString=function(e,t){
if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(e);else{var i=new DOMParser;this.xmlDoc=i.parseFromString(e,"text/xml")}t||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(e,t,i,s){this.rSeed&&(e+=(-1!=e.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=e,
!_isIE&&window.XMLHttpRequest?this.xmlDoc=new XMLHttpRequest:this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),"string"==typeof t?this.xmlDoc.open(t,e,this.async):this.xmlDoc.open(t?"POST":"GET",e,this.async),s?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):t&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),
this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(i),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.filePath=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.doXSLTransToObject=null,this.doXSLTransToString=null,this.loadXML=null,this.loadXMLString=null,
this.doSerialization=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,this.setXSLParamValue=null,null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(e){for(var t={},i=0;i<e.attributes.length;i++)t[e.attributes[i].name]=e.attributes[i].value;t._tagvalue=e.firstChild?e.firstChild.nodeValue:"";for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i].tagName;s&&(t[s]||(t[s]=[]),t[s].push(this.xmlNodeToJSON(e.childNodes[i])))}return t},dhtmlDragAndDropObject.prototype.removeDraggableItem=function(e){
e.onmousedown=null,e.dragStarter=null,e.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(e,t){e.onmousedown=this.preCreateDragCopy,e.dragStarter=t,this.addDragLanding(e,t)},dhtmlDragAndDropObject.prototype.addDragLanding=function(e,t){e.dragLanding=t},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){return!e&&!window.event||2!=(e||event).button?window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,
document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(e),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,
window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),e&&e.preventDefault?(e.preventDefault(),!1):!1):void 0},dhtmlDragAndDropObject.prototype.callDrag=function(e){e||(e=window.event);var t=window.dhtmlDragAndDrop;if(!((new Date).valueOf()-t.downtime<100)){if(!t.dragNode){if(!t.waitDrag)return t.stopDrag(e,!0);if(t.dragNode=t.dragStartObject._createDragNode(t.dragStartNode,e),!t.dragNode)return t.stopDrag();t.dragNode.onselectstart=function(){return!1},t.gldragNode=t.dragNode,document.body.appendChild(t.dragNode),
document.body.onmouseup=t.stopDrag,t.waitDrag=0,t.dragNode.pWindow=window,t.initFrameRoute()}if(t.dragNode.parentNode!=window.document.body&&t.gldragNode){var i=t.gldragNode;t.gldragNode.old&&(i=t.gldragNode.old),i.parentNode.removeChild(i);var s=t.dragNode.pWindow;if(i.pWindow&&i.pWindow.dhtmlDragAndDrop.lastLanding&&i.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(i.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var r=document.createElement("Div");r.innerHTML=t.dragNode.outerHTML,t.dragNode=r.childNodes[0];
}else t.dragNode=t.dragNode.cloneNode(!0);t.dragNode.pWindow=window,t.gldragNode.old=t.dragNode,document.body.appendChild(t.dragNode),s.dhtmlDragAndDrop.dragNode=t.dragNode}t.dragNode.style.left=e.clientX+15+(t.fx?-1*t.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",t.dragNode.style.top=e.clientY+3+(t.fy?-1*t.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px";var a;a=e.srcElement?e.srcElement:e.target,t.checkLanding(a,e)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(e){
if(window.name){for(var t=parent.frames[window.name].frameElement.offsetParent,i=0,s=0;t;)i+=t.offsetLeft,s+=t.offsetTop,t=t.offsetParent;if(parent.dhtmlDragAndDrop){var r=parent.dhtmlDragAndDrop.calculateFramePosition(1);i+=1*r.split("_")[0],s+=1*r.split("_")[1]}if(e)return i+"_"+s;this.fx=i,this.fy=s}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(e,t){e&&e.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=e,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,t.clientX,t.clientY,t),
this.lastLanding_scr=_isIE?t.srcElement:t.target):e&&"BODY"!=e.tagName?this.checkLanding(e.parentNode,t):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,t.clientX,t.clientY,t),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(e,t){var i=window.dhtmlDragAndDrop;if(!t){i.stopFrameRoute();var s=i.lastLanding;i.lastLanding=null,s&&s.dragLanding._drag(i.dragStartNode,i.dragStartObject,s,_isIE?event.srcElement:e.target);
}i.lastLanding=null,i.dragNode&&i.dragNode.parentNode==document.body&&i.dragNode.parentNode.removeChild(i.dragNode),i.dragNode=0,i.gldragNode=0,i.fx=0,i.fy=0,i.dragStartNode=0,i.dragStartObject=0,document.body.onmouseup=i.tempDOMU,document.body.onmousemove=i.tempDOMM,i.tempDOMU=null,i.tempDOMM=null,i.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(e){e&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var t=0;t<window.frames.length;t++)try{window.frames[t]!=e&&window.frames[t].dhtmlDragAndDrop&&window.frames[t].dhtmlDragAndDrop.stopFrameRoute(window);
}catch(i){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(i){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(e,t){e&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=e.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=e.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=e.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=e.dhtmlDragAndDrop.dragNode,
window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&t&&(!_isFF||_FFrv<1.8)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(i){}for(var s=0;s<window.frames.length;s++)try{window.frames[s]!=e&&window.frames[s].dhtmlDragAndDrop&&window.frames[s].dhtmlDragAndDrop.initFrameRoute(window,!e||t?1:0)}catch(i){}},_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,
_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,
-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(e,t,i,s){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(e,t);if(_isIE)return t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),
t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),i&&t.setProperty("SelectionNamespaces","xmlns:xsl='"+i+"'"),"single"==s?t.selectSingleNode(e):t.selectNodes(e)||new Array(0);var r=t;t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),-1!=t.nodeName.indexOf("document")?r=t:(r=t,t=t.ownerDocument);var a=XPathResult.ANY_TYPE;"single"==s&&(a=XPathResult.FIRST_ORDERED_NODE_TYPE);
var n=[],d=t.evaluate(e,r,function(e){return i},a,null);if(a==XPathResult.FIRST_ORDERED_NODE_TYPE)return d.singleNodeValue;for(var o=d.iterateNext();o;)n[n.length]=o,o=d.iterateNext();return n},_dhtmlxError.prototype.catchError=function(e,t){this.catches[e]=t},_dhtmlxError.prototype.throwError=function(e,t,i){return this.catches[e]?this.catches[e](e,t,i):this.catches.ALL?this.catches.ALL(e,t,i):(window.alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]),null)},window.dhtmlxError=new _dhtmlxError,
dtmlXMLLoaderObject.prototype.doXPathOpera=function(e,t){var i=e.replace(/[\/]+/gi,"/").split("/"),s=null,r=1;if(!i.length)return[];if("."==i[0])s=[t];else{if(""!==i[0])return[];s=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(i[r].replace(/\[[^\]]*\]/g,"")),r++}for(r;r<i.length;r++)s=this._getAllNamedChilds(s,i[r]);return-1!=i[r-1].indexOf("[")&&(s=this._filterXPath(s,i[r-1])),s},dtmlXMLLoaderObject.prototype._filterXPath=function(e,t){for(var i=[],t=t.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),s=0;s<e.length;s++)e[s].getAttribute(t)&&(i[i.length]=e[s]);
return i},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(e,t){var i=[];_isKHTML&&(t=t.toUpperCase());for(var s=0;s<e.length;s++)for(var r=0;r<e[s].childNodes.length;r++)_isKHTML?e[s].childNodes[r].tagName&&e[s].childNodes[r].tagName.toUpperCase()==t&&(i[i.length]=e[s].childNodes[r]):e[s].childNodes[r].tagName==t&&(i[i.length]=e[s].childNodes[r]);return i},"undefined"==typeof window.dhtmlxEvent&&(window.dhtmlxEvent=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i);
}),dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(e,t,i){i||(i=this.xslDoc),i.responseXML&&(i=i.responseXML);var s=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+e+"']",i,"http://www.w3.org/1999/XSL/Transform","single");s&&(s.firstChild.nodeValue=t)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(e,t){e||(e=this.xslDoc),e.responseXML&&(e=e.responseXML),t||(t=this.xmlDoc),t.responseXML&&(t=t.responseXML);var i;if(_isIE){i=new ActiveXObject("Msxml2.DOMDocument.3.0");
try{t.transformNodeToObject(e,i)}catch(s){i=t.transformNode(e)}}else this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(e)),i=this.XSLProcessor.transformToDocument(t);return i},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(e,t){var i=this.doXSLTransToObject(e,t);return"string"==typeof i?i:this.doSerialization(i)},dtmlXMLLoaderObject.prototype.doSerialization=function(e){if(e||(e=this.xmlDoc),e.responseXML&&(e=e.responseXML),_isIE)return e.xml;var t=new XMLSerializer;
return t.serializeToString(e)},dhtmlxEventable=function(obj){obj.attachEvent=function(e,t,i){return e="ev_"+e.toLowerCase(),this[e]||(this[e]=new this.eventCatcher(i||this)),e+":"+this[e].addEvent(t)},obj.callEvent=function(e,t){return e="ev_"+e.toLowerCase(),this[e]?this[e].apply(this,t):!0},obj.checkEvent=function(e){return!!this["ev_"+e.toLowerCase()]},obj.eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var e=!0,t=0;t<dhx_catch.length;t++)if(dhx_catch[t]){var i=dhx_catch[t].apply(obj,arguments);
e=e&&i}return e};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(e){dhx_catch[e]=null},z},obj.detachEvent=function(e){if(e){var t=e.split(":");this[t[0]].removeEvent(t[1])}},obj.detachAllEvents=function(){for(var e in this)0===e.indexOf("ev_")&&(this.detachEvent(e),this[e]=null)},obj=null},window.dhtmlx||(window.dhtmlx={}),function(){function e(e,t){var s=e.callback;i(!1),e.box.parentNode.removeChild(e.box),c=e.box=null,
s&&s(t)}function t(t){if(c){t=t||event;var i=t.which||event.keyCode;return dhtmlx.message.keyboard&&((13==i||32==i)&&e(c,!0),27==i&&e(c,!1)),t.preventDefault&&t.preventDefault(),!(t.cancelBubble=!0)}}function i(e){i.cover||(i.cover=document.createElement("DIV"),i.cover.onkeydown=t,i.cover.className="dhx_modal_cover",document.body.appendChild(i.cover));document.body.scrollHeight;i.cover.style.display=e?"inline-block":"none"}function s(e,t,i){var s=i?i:e||"",r="dhtmlx_"+s.toLowerCase().replace(/ /g,"_")+"_button";
return"<div class='dhtmlx_popup_button "+r+"' result='"+t+"' ><div>"+e+"</div></div>"}function r(e){u.area||(u.area=document.createElement("DIV"),u.area.className="dhtmlx_message_area",u.area.style[u.position]="5px",document.body.appendChild(u.area)),u.hide(e.id);var t=document.createElement("DIV");return t.innerHTML="<div>"+e.text+"</div>",t.className="dhtmlx-info dhtmlx-"+e.type,t.onclick=function(){u.hide(e.id),e=null},"bottom"==u.position&&u.area.firstChild?u.area.insertBefore(t,u.area.firstChild):u.area.appendChild(t),
e.expire>0&&(u.timers[e.id]=window.setTimeout(function(){u.hide(e.id)},e.expire)),u.pull[e.id]=t,t=null,e.id}function a(t,i,r){var a=document.createElement("DIV");a.className=" dhtmlx_modal_box dhtmlx-"+t.type,a.setAttribute("dhxbox",1);var n="";if(t.width&&(a.style.width=t.width),t.height&&(a.style.height=t.height),t.title&&(n+='<div class="dhtmlx_popup_title">'+t.title+"</div>"),n+='<div class="dhtmlx_popup_text"><span>'+(t.content?"":t.text)+'</span></div><div  class="dhtmlx_popup_controls">',
i){var d=t.ok||scheduler.locale.labels.message_ok;void 0===d&&(d="OK"),n+=s(d,!0,"ok")}if(r){var o=t.cancel||scheduler.locale.labels.message_cancel;void 0===o&&(o="Cancel"),n+=s(o,!1,"cancel")}if(t.buttons)for(var l=0;l<t.buttons.length;l++)n+=s(t.buttons[l],l);if(n+="</div>",a.innerHTML=n,t.content){var _=t.content;"string"==typeof _&&(_=document.getElementById(_)),"none"==_.style.display&&(_.style.display=""),a.childNodes[t.title?1:0].appendChild(_)}return a.onclick=function(i){i=i||event;var s=i.target||i.srcElement,r=scheduler._getClassName(s);
if(r||(s=s.parentNode),r=scheduler._getClassName(s),"dhtmlx_popup_button"==r.split(" ")[0]){var a=s.getAttribute("result");a="true"==a||("false"==a?!1:a),e(t,a)}},t.box=a,(i||r)&&(c=t),a}function n(e,s,r){var n=e.tagName?e:a(e,s,r);e.hidden||i(!0),document.body.appendChild(n);var d=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-n.offsetWidth)/2)),o=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-n.offsetHeight)/2));return"top"==e.position?n.style.top="-3px":n.style.top=o+"px",
n.style.left=d+"px",n.onkeydown=t,n.focus(),e.hidden&&dhtmlx.modalbox.hide(n),n}function d(e){return n(e,!0,!1)}function o(e){return n(e,!0,!0)}function l(e){return n(e)}function _(e,t,i){return"object"!=typeof e&&("function"==typeof t&&(i=t,t=""),e={text:e,type:t,callback:i}),e}function h(e,t,i,s){return"object"!=typeof e&&(e={text:e,type:t,expire:i,id:s}),e.id=e.id||u.uid(),e.expire=e.expire||u.expire,e}var c=null;document.attachEvent?document.attachEvent("onkeydown",t):document.addEventListener("keydown",t,!0),
dhtmlx.alert=function(){var e=_.apply(this,arguments);return e.type=e.type||"confirm",d(e)},dhtmlx.confirm=function(){var e=_.apply(this,arguments);return e.type=e.type||"alert",o(e)},dhtmlx.modalbox=function(){var e=_.apply(this,arguments);return e.type=e.type||"alert",l(e)},dhtmlx.modalbox.hide=function(e){for(;e&&e.getAttribute&&!e.getAttribute("dhxbox");)e=e.parentNode;e&&(e.parentNode.removeChild(e),i(!1))};var u=dhtmlx.message=function(e,t,i,s){e=h.apply(this,arguments),e.type=e.type||"info";
var a=e.type.split("-")[0];switch(a){case"alert":return d(e);case"confirm":return o(e);case"modalbox":return l(e);default:return r(e)}};u.seed=(new Date).valueOf(),u.uid=function(){return u.seed++},u.expire=4e3,u.keyboard=!0,u.position="top",u.pull={},u.timers={},u.hideAll=function(){for(var e in u.pull)u.hide(e)},u.hide=function(e){var t=u.pull[e];t&&t.parentNode&&(window.setTimeout(function(){t.parentNode.removeChild(t),t=null},2e3),t.className+=" hidden",u.timers[e]&&window.clearTimeout(u.timers[e]),
delete u.pull[e])}}(),dataProcessor.prototype={setTransactionMode:function(e,t){this._tMode=e,this._tSend=t,"REST"==e&&(this._tSend=!1,this._endnm=!0)},escape:function(e){return this._utf?encodeURIComponent(e):escape(e)},enableUTFencoding:function(e){this._utf=convertStringToBoolean(e)},setDataColumns:function(e){this._columns="string"==typeof e?e.split(","):e},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(e){this._endnm=convertStringToBoolean(e)},enablePartialDataSend:function(e){
this._changed=convertStringToBoolean(e)},setUpdateMode:function(e,t){this.autoUpdate="cell"==e,this.updateMode=e,this.dnd=t},ignore:function(e,t){this._silent_mode=!0,e.call(t||window),this._silent_mode=!1},setUpdated:function(e,t,i){if(!this._silent_mode){var s=this.findRow(e);i=i||"updated";var r=this.obj.getUserData(e,this.action_param);r&&"updated"==i&&(i=r),t?(this.set_invalid(e,!1),this.updatedRows[s]=e,this.obj.setUserData(e,this.action_param,i),this._in_progress[e]&&(this._in_progress[e]="wait")):this.is_invalid(e)||(this.updatedRows.splice(s,1),
this.obj.setUserData(e,this.action_param,"")),t||this._clearUpdateFlag(e),this.markRow(e,t,i),t&&this.autoUpdate&&this.sendData(e)}},_clearUpdateFlag:function(e){},markRow:function(e,t,i){var s="",r=this.is_invalid(e);if(r&&(s=this.styles[r],t=!0),this.callEvent("onRowMark",[e,t,i,r])&&(s=this.styles[t?i:"clear"]+s,this.obj[this._methods[0]](e,s),r&&r.details)){s+=this.styles[r+"_cell"];for(var a=0;a<r.details.length;a++)r.details[a]&&this.obj[this._methods[1]](e,a,s)}},getState:function(e){return this.obj.getUserData(e,this.action_param);
},is_invalid:function(e){return this._invalid[e]},set_invalid:function(e,t,i){i&&(t={value:t,details:i,toString:function(){return this.value.toString()}}),this._invalid[e]=t},checkBeforeUpdate:function(e){return!0},sendData:function(e){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),"undefined"==typeof e||this._tSend?this.sendAllData():this._in_progress[e]?!1:(this.messages=[],!this.checkBeforeUpdate(e)&&this.callEvent("onValidationError",[e,this.messages])?!1:void this._beforeSendData(this._getRowData(e),e))):void 0;
},_beforeSendData:function(e,t){return this.callEvent("onBeforeUpdate",[t,this.getState(t),e])?void this._sendData(e,t):!1},serialize:function(e,t){if("string"==typeof e)return e;if("undefined"!=typeof t)return this.serialize_one(e,"");var i=[],s=[];for(var r in e)e.hasOwnProperty(r)&&(i.push(this.serialize_one(e[r],r+this.post_delim)),s.push(r));return i.push("ids="+this.escape(s.join(","))),dhtmlx.security_key&&i.push("dhx_security="+dhtmlx.security_key),i.join("&")},serialize_one:function(e,t){
if("string"==typeof e)return e;var i=[];for(var s in e)if(e.hasOwnProperty(s)){if(("id"==s||s==this.action_param)&&"REST"==this._tMode)continue;i.push(this.escape((t||"")+s)+"="+this.escape(e[s]))}return i.join("&")},_sendData:function(e,t){if(e){if(!this.callEvent("onBeforeDataSending",t?[t,this.getState(t),e]:[null,null,e]))return!1;t&&(this._in_progress[t]=(new Date).valueOf());var i=new dtmlXMLLoaderObject(function(i,s,r,a,n){var d=[];if(t)d.push(t);else if(e)for(var o in e)d.push(o);return i.afterUpdate(i,n,d);
},this,!0),s=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)i.loadXML(s+(-1!=s.indexOf("?")?"&":"?")+this.serialize(e,t));else if("POST"==this._tMode)i.loadXML(s,!0,this.serialize(e,t));else if("REST"==this._tMode){var r=this.getState(t),a=s.replace(/(\&|\?)editing\=true/,"");"inserted"==r?i.loadXML(a+t,"POST",this.serialize(e,t)):"deleted"==r?i.loadXML(a+t,"DELETE",""):i.loadXML(a+t,"PUT",this.serialize(e,t));
}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var e=!0,t=0;t<this.updatedRows.length;t++)e&=this.checkBeforeUpdate(this.updatedRows[t]);if(!e&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var t=0;t<this.updatedRows.length;t++)if(!this._in_progress[this.updatedRows[t]]){if(this.is_invalid(this.updatedRows[t]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[t]),this.updatedRows[t]),
this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(e){for(var t={},i=!1,s=0;s<this.updatedRows.length;s++){var r=this.updatedRows[s];this._in_progress[r]||this.is_invalid(r)||this.callEvent("onBeforeUpdate",[r,this.getState(r),this._getRowData(r)])&&(t[r]=this._getRowData(r,r+this.post_delim),i=!0,this._in_progress[r]=(new Date).valueOf())}return i?t:null},setVerificator:function(e,t){this.mandatoryFields[e]=t||function(e){return""!==e}},clearVerificator:function(e){
this.mandatoryFields[e]=!1},findRow:function(e){var t=0;for(t=0;t<this.updatedRows.length&&e!=this.updatedRows[t];t++);return t},defineAction:function(e,t){this._uActions||(this._uActions=[]),this._uActions[e]=t},afterUpdateCallback:function(e,t,i,s){var r=e,a="error"!=i&&"invalid"!=i;if(a||this.set_invalid(e,i),this._uActions&&this._uActions[i]&&!this._uActions[i](s))return delete this._in_progress[r];"wait"!=this._in_progress[r]&&this.setUpdated(e,!1);var n=e;switch(i){case"inserted":case"insert":
t!=e&&(this.obj[this._methods[2]](e,t),e=t);break;case"delete":case"deleted":return this.obj.setUserData(e,this.action_param,"true_deleted"),this.obj[this._methods[3]](e,t),delete this._in_progress[r],this.callEvent("onAfterUpdate",[e,i,t,s])}"wait"!=this._in_progress[r]?(a&&this.obj.setUserData(e,this.action_param,""),delete this._in_progress[r]):(delete this._in_progress[r],this.setUpdated(t,!0,this.obj.getUserData(e,this.action_param))),this.callEvent("onAfterUpdate",[n,i,t,s])},afterUpdate:function(e,t,i){
if(window.JSON)try{var s=JSON.parse(t.xmlDoc.responseText),r=s.action||this.getState(i)||"updated",a=s.sid||i[0],n=s.tid||i[0];return e.afterUpdateCallback(a,n,r,s),void e.finalizeUpdate()}catch(d){}if(t.getXMLTopNode("data"),!t.xmlDoc.responseXML)return this.obj&&this.obj.callEvent&&this.obj.callEvent("onSaveError",[i,t.xmlDoc]),this.cleanUpdate(i);var o=t.doXPath("//data/action");if(!o.length)return this.cleanUpdate(i);for(var l=0;l<o.length;l++){var _=o[l],r=_.getAttribute("type"),a=_.getAttribute("sid"),n=_.getAttribute("tid");
e.afterUpdateCallback(a,n,r,_)}e.finalizeUpdate()},cleanUpdate:function(e){if(e)for(var t=0;t<e.length;t++)delete this._in_progress[e[t]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(e){this.obj=e,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(e){this.attachEvent("onAfterUpdate",e);
},enableDebug:function(e){},setOnBeforeUpdateHandler:function(e){this.attachEvent("onBeforeDataSending",e)},setAutoUpdate:function(e,t){e=e||2e3,this._user=t||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(e,t,i,s){this.afterAutoUpdate(e,t,i,s)}),this.attachEvent("onFullSync",function(){this.fullSync()});var i=this;window.setInterval(function(){i.loadUpdate()},e)},afterAutoUpdate:function(e,t,i,s){return"collision"==t?(this._need_update=!0,
!1):!0},fullSync:function(){return this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(e,t){return this._update_busy?!1:(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=t,void this._loader.loadXML(e))},_v:function(e){return e.firstChild?e.firstChild.nodeValue:""},_a:function(e){for(var t=[],i=0;i<e.length;i++)t[i]=this._v(e[i]);return t},loadUpdate:function(){var e=this,t=this.obj.getUserData(0,"version"),i=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+t].join("&");
i=i.replace("editing=true&",""),this.getUpdates(i,function(){var t;try{t=e._loader.doXPath("//userdata")}catch(i){return void(e._update_busy=!1)}e.obj.setUserData(0,"version",e._v(t[0]));var s=e._loader.doXPath("//update");if(s.length){e._silent_mode=!0;for(var r=0;r<s.length;r++){var a=s[r].getAttribute("status"),n=s[r].getAttribute("id"),d=s[r].getAttribute("parent");switch(a){case"inserted":e.callEvent("insertCallback",[s[r],n,d]);break;case"updated":e.callEvent("updateCallback",[s[r],n,d]);break;
case"deleted":e.callEvent("deleteCallback",[s[r],n,d])}}e._silent_mode=!1}e._update_busy=!1,e=null})}},window.dataProcessor&&!dataProcessor.prototype.init_original&&(dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(e){this.init_original(e),e._dataprocessor=this,this.setTransactionMode("POST",!0),this.serverProcessor+=(-1!=this.serverProcessor.indexOf("?")?"&":"?")+"editing=true"}),dhtmlxError.catchError("LoadXML",function(e,t,i){var s=i[0].responseText;
switch(scheduler.config.ajax_error){case"alert":window.alert(s);break;case"console":window.console.log(s)}}),dhtmlxEventable(scheduler),scheduler._detachDomEvent=function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)},scheduler._init_once=function(){function e(e){for(var t=document.body;e&&e!=t;)e=e.parentNode;return!(t!=e)}function t(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight
}}function i(e,t){return e.w==t.w&&e.h==t.h}var s=t();dhtmlxEvent(window,"resize",function(){e(scheduler._obj)&&(window.clearTimeout(scheduler._resize_timer),scheduler._resize_timer=window.setTimeout(function(){var r=t();if(!i(s,r)){if(!e(scheduler._obj))return;scheduler.callEvent("onSchedulerResize",[])&&(scheduler.update_view(),scheduler.callEvent("onAfterSchedulerResize",[]))}s=r},20))}),scheduler._init_once=function(){}},scheduler.init=function(e,t,i){t=t||scheduler._currentDate(),i=i||"week",
this._obj&&this.unset_actions(),this._obj="string"==typeof e?document.getElementById(e):e,this._skin_init&&scheduler._skin_init(),scheduler.date.init(),this._els=[],this._scroll=!0,this._quirks=_isIE&&"BackCompat"==document.compatMode,this._quirks7=_isIE&&-1==navigator.appVersion.indexOf("MSIE 8"),this.get_elements(),this.init_templates(),this.set_actions(),this._init_once(),this._init_touch_events(),this.set_sizes(),scheduler.callEvent("onSchedulerReady",[]),this.setCurrentView(t,i)},scheduler.xy={
min_event_height:40,scale_width:50,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140,month_head_height:22},scheduler.keys={edit_save:13,edit_cancel:27},scheduler.set_sizes=function(){var e=this._x=this._obj.clientWidth-this.xy.margin_left,t=this._y=this._obj.clientHeight-this.xy.margin_top,i=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,s=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els.dhx_cal_navline[0],e,this.xy.nav_height,0,0),
this.set_xy(this._els.dhx_cal_header[0],e-i,this.xy.scale_height,s,this.xy.nav_height+(this._quirks?-1:1));var r=this._els.dhx_cal_navline[0].offsetHeight;r>0&&(this.xy.nav_height=r);var a=this.xy.scale_height+this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.dhx_cal_data[0],e,t-(a+2),0,a+2)},scheduler.set_xy=function(e,t,i,s,r){e.style.width=Math.max(0,t)+"px",e.style.height=Math.max(0,i)+"px",arguments.length>3&&(e.style.left=s+"px",e.style.top=r+"px")},scheduler.get_elements=function(){
for(var e=this._obj.getElementsByTagName("DIV"),t=0;t<e.length;t++){var i=scheduler._getClassName(e[t]),s=e[t].getAttribute("name")||"";i&&(i=i.split(" ")[0]),this._els[i]||(this._els[i]=[]),this._els[i].push(e[t]);var r=scheduler.locale.labels[s||i];"string"!=typeof r&&s&&!e[t].innerHTML&&(r=s.split("_")[0]),r&&(e[t].innerHTML=r)}},scheduler.unset_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=null;this._obj.onselectstart=null,
this._obj.onmousemove=null,this._obj.onmousedown=null,this._obj.onmouseup=null,this._obj.ondblclick=null,this._obj.oncontextmenu=null},scheduler.set_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=scheduler._click[e];this._obj.onselectstart=function(e){return!1},this._obj.onmousemove=function(e){scheduler._temp_touch_block||scheduler._on_mouse_move(e||event)},this._obj.onmousedown=function(e){scheduler._ignore_next_click||scheduler._on_mouse_down(e||event);
},this._obj.onmouseup=function(e){scheduler._ignore_next_click||scheduler._on_mouse_up(e||event)},this._obj.ondblclick=function(e){scheduler._on_dbl_click(e||event)},this._obj.oncontextmenu=function(e){var t=e||event,i=t.target||t.srcElement,s=scheduler.callEvent("onContextMenu",[scheduler._locate_event(i),t]);return s}},scheduler.select=function(e){this._select_id!=e&&(scheduler._close_not_saved(),this.editStop(!1),this.unselect(),this._select_id=e,this.updateEvent(e))},scheduler.unselect=function(e){
if(!e||e==this._select_id){var t=this._select_id;this._select_id=null,t&&this.getEvent(t)&&this.updateEvent(t)}},scheduler.getState=function(){return{mode:this._mode,date:new Date(this._date),min_date:new Date(this._min_date),max_date:new Date(this._max_date),editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode}},scheduler._click={dhx_cal_data:function(e){if(scheduler._ignore_next_click)return e.preventDefault&&e.preventDefault(),
e.cancelBubble=!0,scheduler._ignore_next_click=!1,!1;var t=e?e.target:event.srcElement,i=scheduler._locate_event(t);if(e=e||event,i){if(!scheduler.callEvent("onClick",[i,e])||scheduler.config.readonly)return}else scheduler.callEvent("onEmptyClick",[scheduler.getActionData(e).date,e]);if(i&&scheduler.config.select){scheduler.select(i);var s=scheduler._getClassName(t);-1!=s.indexOf("_icon")&&scheduler._click.buttons[s.split(" ")[1].replace("icon_","")](i)}else scheduler._close_not_saved(),(new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler.unselect();
},dhx_cal_prev_button:function(){scheduler._click.dhx_cal_next_button(0,-1)},dhx_cal_next_button:function(e,t){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+"_start"](scheduler._date),t||1,scheduler._mode))},dhx_cal_today_button:function(){scheduler.callEvent("onBeforeTodayDisplayed",[])&&scheduler.setCurrentView(scheduler._currentDate())},dhx_cal_tab:function(){var e=this.getAttribute("name"),t=e.substring(0,e.search("_tab"));scheduler.setCurrentView(scheduler._date,t);
},buttons:{"delete":function(e){var t=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(t,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(e)})},edit:function(e){scheduler.edit(e)},save:function(e){scheduler.editStop(!0)},details:function(e){scheduler.showLightbox(e)},cancel:function(e){scheduler.editStop(!1)}}},scheduler._dhtmlx_confirm=function(e,t,i){if(!e)return i();var s={text:e};t&&(s.title=t),i&&(s.callback=function(e){e&&i()}),dhtmlx.confirm(s);
},scheduler.addEventNow=function(e,t,i){var s={};e&&null!==e.constructor.toString().match(/object/i)&&(s=e,e=null);var r=6e4*(this.config.event_duration||this.config.time_step);e||(e=s.start_date||Math.round(scheduler._currentDate().valueOf()/r)*r);var a=new Date(e);if(!t){var n=this.config.first_hour;n>a.getHours()&&(a.setHours(n),e=a.valueOf()),t=e.valueOf()+r}var d=new Date(t);a.valueOf()==d.valueOf()&&d.setTime(d.valueOf()+r),s.start_date=s.start_date||a,s.end_date=s.end_date||d,s.text=s.text||this.locale.labels.new_event,
s.id=this._drag_id=s.id||this.uid(),this._drag_mode="new-size",this._loading=!0;var o=this.addEvent(s);return this.callEvent("onEventCreated",[this._drag_id,i]),this._loading=!1,this._drag_event={},this._on_mouse_up(i),o},scheduler._on_dbl_click=function(e,t){if(t=t||e.target||e.srcElement,!this.config.readonly){var i=scheduler._getClassName(t).split(" ")[0];switch(i){case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_wa_day_data":if(!scheduler.config.dblclick_create)break;
this.addEventNow(this.getActionData(e).date,null,e);break;case"dhx_cal_event":case"dhx_wa_ev_body":case"dhx_agenda_line":case"dhx_grid_event":case"dhx_cal_event_line":case"dhx_cal_event_clear":var s=this._locate_event(t);if(!this.callEvent("onDblClick",[s,e]))return;this.config.details_on_dblclick||this._table_view||!this.getEvent(s)._timed||!this.config.select?this.showLightbox(s):this.edit(s);break;case"dhx_time_block":case"dhx_cal_container":return;default:var r=this["dblclick_"+i];if(r)r.call(this,e);else if(t.parentNode&&t!=this)return scheduler._on_dbl_click(e,t.parentNode);
}}},scheduler._get_column_index=function(e){var t=0;if(this._cols){for(var i=0,s=0;s<this._cols.length&&!i;s++)i=this._cols[s];if(t=i?e/i:0,this._ignores)for(var s=0;t>=s;s++)this._ignores[s]&&t++}return t},scheduler._week_indexes_from_pos=function(e){if(this._cols){var t=this._get_column_index(e.x);return e.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(t)-1)),e.y=Math.max(0,Math.ceil(60*e.y/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step),
e}return e},scheduler._mouse_coords=function(e){var t,i=document.body,s=document.documentElement;t=_isIE||!e.pageX&&!e.pageY?{x:e.clientX+(i.scrollLeft||s.scrollLeft||0)-i.clientLeft,y:e.clientY+(i.scrollTop||s.scrollTop||0)-i.clientTop}:{x:e.pageX,y:e.pageY},t.x-=getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width),t.y-=getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els.dhx_cal_data[0].scrollTop,t.ev=e;var r=this["mouse_"+this._mode];if(r)t=r.call(this,t);else if(this._table_view){
var a=this._get_column_index(t.x);if(!this._cols||!this._colsS)return t;var n=0;for(n=1;n<this._colsS.heights.length&&!(this._colsS.heights[n]>t.y);n++);t.y=Math.ceil(24*(Math.max(0,a)+7*Math.max(0,n-1))*60/this.config.time_step),(scheduler._drag_mode||"month"==this._mode)&&(t.y=24*(Math.max(0,Math.ceil(a)-1)+7*Math.max(0,n-1))*60/this.config.time_step),"move"==this._drag_mode&&scheduler._ignores_detected&&scheduler.config.preserve_length&&(t._ignores=!0,this._drag_event._event_length||(this._drag_event._event_length=this._get_real_event_length(this._drag_event.start_date,this._drag_event.end_date,{
x_step:1,x_unit:"day"}))),t.x=0}else t=this._week_indexes_from_pos(t);return t.timestamp=+new Date,t},scheduler._close_not_saved=function(){if((new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler._edit_id){var e=scheduler.locale.labels.confirm_closing;scheduler._dhtmlx_confirm(e,scheduler.locale.labels.title_confirm_closing,function(){scheduler.editStop(scheduler.config.positive_closing)}),e&&(this._drag_id=this._drag_pos=this._drag_mode=null)}},scheduler._correct_shift=function(e,t){return e-=6e4*(new Date(scheduler._min_date).getTimezoneOffset()-new Date(e).getTimezoneOffset())*(t?-1:1);
},scheduler._is_pos_changed=function(e,t){function i(e,t,i){return!!(Math.abs(e-t)>i)}if(!e||!this._drag_pos)return!0;var s=100,r=5;return!!(this._drag_pos.has_moved||!this._drag_pos.timestamp||t.timestamp-this._drag_pos.timestamp>s||i(e.ev.clientX,t.ev.clientX,r)||i(e.ev.clientY,t.ev.clientY,r))},scheduler._correct_drag_start_date=function(e){var t;scheduler.matrix&&(t=scheduler.matrix[scheduler._mode]),t=t||{x_step:1,x_unit:"day"},e=new Date(e);var i=1;return(t._start_correction||t._end_correction)&&(i=60*(t.last_hour||0)-(60*e.getHours()+e.getMinutes())||1),
1*e+(scheduler._get_fictional_event_length(e,i,t)-i)},scheduler._correct_drag_end_date=function(e,t){var i;scheduler.matrix&&(i=scheduler.matrix[scheduler._mode]),i=i||{x_step:1,x_unit:"day"};var s=1*e+scheduler._get_fictional_event_length(e,t,i);return new Date(1*s-(scheduler._get_fictional_event_length(s,-1,i,-1)+1))},scheduler._on_mouse_move=function(e){if(this._drag_mode){var t=this._mouse_coords(e);if(this._is_pos_changed(this._drag_pos,t)){var i,s;if(this._edit_id!=this._drag_id&&this._close_not_saved(),
!this._drag_mode)return;if(this._drag_pos=t,this._drag_pos.has_moved=!0,"create"==this._drag_mode){if(this._close_not_saved(),this.unselect(this._select_id),this._loading=!0,i=this._get_date_from_pos(t).valueOf(),!this._drag_start){var r=this.callEvent("onBeforeEventCreated",[e,this._drag_id]);return r?(this._loading=!1,void(this._drag_start=i)):void(this._loading=!1)}s=i,s==this._drag_start;var a=new Date(this._drag_start),n=new Date(s);"day"!=this._mode&&"week"!=this._mode||a.getHours()!=n.getHours()||a.getMinutes()!=n.getMinutes()||(n=new Date(this._drag_start+1e3)),
this._drag_id=this.uid(),this.addEvent(a,n,this.locale.labels.new_event,this._drag_id,t.fields),this.callEvent("onEventCreated",[this._drag_id,e]),this._loading=!1,this._drag_mode="new-size"}var d,o=this.getEvent(this._drag_id);if(scheduler.matrix&&(d=scheduler.matrix[scheduler._mode]),d=d||{x_step:1,x_unit:"day"},"move"==this._drag_mode)i=this._min_date.valueOf()+6e4*(t.y*this.config.time_step+24*t.x*60-(scheduler._move_pos_shift||0)),!t.custom&&this._table_view&&(i+=1e3*this.date.time_part(o.start_date)),
i=this._correct_shift(i),t._ignores&&this.config.preserve_length&&this._table_view?(i=scheduler._correct_drag_start_date(i),s=scheduler._correct_drag_end_date(i,this._drag_event._event_length)):s=o.end_date.valueOf()-(o.start_date.valueOf()-i);else{if(i=o.start_date.valueOf(),s=o.end_date.valueOf(),this._table_view){var l=this._min_date.valueOf()+t.y*this.config.time_step*6e4+(t.custom?0:864e5);if("month"==this._mode)if(l=this._correct_shift(l,!1),this._drag_from_start){var _=864e5;l<=scheduler.date.date_part(new Date(s+_-1)).valueOf()&&(i=l-_);
}else s=l;else t.resize_from_start?i=scheduler._correct_drag_start_date(l):s=scheduler._correct_drag_end_date(l,0)}else{var h=this.date.date_part(new Date(o.end_date.valueOf()-1)).valueOf(),c=new Date(h);s=h+t.y*this.config.time_step*6e4,s+=6e4*(new Date(s).getTimezoneOffset()-c.getTimezoneOffset()),this._els.dhx_cal_data[0].style.cursor="s-resize",("week"==this._mode||"day"==this._mode)&&(s=this._correct_shift(s))}if("new-size"==this._drag_mode)if(s<=this._drag_start){var u=t.shift||(this._table_view&&!t.custom?864e5:0);
i=s-(t.shift?0:u),s=this._drag_start+(u||6e4*this.config.time_step)}else i=this._drag_start;else i>=s&&(s=i+6e4*this.config.time_step)}var g=new Date(s-1),f=new Date(i);if("move"==this._drag_mode&&scheduler.config.limit_drag_out&&(+f<+scheduler._min_date||+s>+scheduler._max_date)){if(+o.start_date<+scheduler._min_date||+o.end_date>+scheduler._max_date)f=new Date(o.start_date),s=new Date(o.end_date);else{var v=s-f;+f<+scheduler._min_date?(f=new Date(scheduler._min_date),t._ignores&&this.config.preserve_length&&this._table_view?(f=new Date(scheduler._correct_drag_start_date(f)),
d._start_correction&&(f=new Date(f.valueOf()+d._start_correction)),s=new Date(1*f+this._get_fictional_event_length(f,this._drag_event._event_length,d))):s=new Date(+f+v)):(s=new Date(scheduler._max_date),t._ignores&&this.config.preserve_length&&this._table_view?(d._end_correction&&(s=new Date(s.valueOf()-d._end_correction)),s=new Date(1*s-this._get_fictional_event_length(s,0,d,!0)),f=new Date(1*s-this._get_fictional_event_length(s,this._drag_event._event_length,d,!0)),this._ignores_detected&&(f=scheduler.date.add(f,d.x_step,d.x_unit),
s=new Date(1*s-this._get_fictional_event_length(s,0,d,!0)),s=scheduler.date.add(s,d.x_step,d.x_unit))):f=new Date(+s-v))}var g=new Date(s-1)}if(!this._table_view&&!scheduler.config.all_timed&&(!scheduler._get_section_view()&&t.x!=this._get_event_sday({start_date:new Date(s),end_date:new Date(s)})||new Date(s).getHours()>=this.config.last_hour)){var v=s-f,_=this._min_date.valueOf()+24*t.x*60*6e4;s=scheduler.date.date_part(new Date(_)),s.setHours(this.config.last_hour),g=new Date(s-1),"move"==this._drag_mode&&(f=new Date(+s-v));
}if(this._table_view||g.getDate()==f.getDate()&&g.getHours()<this.config.last_hour||scheduler._allow_dnd)if(o.start_date=f,o.end_date=new Date(s),this.config.update_render){var m=scheduler._els.dhx_cal_data[0].scrollTop;this.update_view(),scheduler._els.dhx_cal_data[0].scrollTop=m}else this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(e){e.className+=" dhx_in_move"}),this.callEvent("onEventDrag",[this._drag_id,this._drag_mode,e])}}else if(scheduler.checkEvent("onMouseMove")){
var p=this._locate_event(e.target||e.srcElement);this.callEvent("onMouseMove",[p,e])}},scheduler._on_mouse_down=function(e,t){if(2!=e.button&&!this.config.readonly&&!this._drag_mode){t=t||e.target||e.srcElement;var i=scheduler._getClassName(t).split(" ")[0];switch(i){case"dhx_cal_event_line":case"dhx_cal_event_clear":this._table_view&&(this._drag_mode="move");break;case"dhx_event_move":case"dhx_wa_ev_body":this._drag_mode="move";break;case"dhx_event_resize":this._drag_mode="resize";var s=scheduler._getClassName(t);
s.indexOf("dhx_event_resize_end")<0?scheduler._drag_from_start=!0:scheduler._drag_from_start=!1;break;case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_matrix_cell":case"dhx_marked_timespan":this._drag_mode="create";break;case"":if(t.parentNode)return scheduler._on_mouse_down(e,t.parentNode);break;default:if((!scheduler.checkEvent("onMouseDown")||scheduler.callEvent("onMouseDown",[i]))&&t.parentNode&&t!=this&&"dhx_body"!=i)return scheduler._on_mouse_down(e,t.parentNode);
this._drag_mode=null,this._drag_id=null}if(this._drag_mode){var r=this._locate_event(t);if(this.config["drag_"+this._drag_mode]&&this.callEvent("onBeforeDrag",[r,this._drag_mode,e])){if(this._drag_id=r,(this._edit_id!=this._drag_id||this._edit_id&&"create"==this._drag_mode)&&this._close_not_saved(),!this._drag_mode)return;this._drag_event=scheduler._lame_clone(this.getEvent(this._drag_id)||{}),this._drag_pos=this._mouse_coords(e)}else this._drag_mode=this._drag_id=0}this._drag_start=null}},scheduler._get_private_properties=function(e){
var t={};for(var i in e)0===i.indexOf("_")&&(t[i]=!0);return t},scheduler._clear_temporary_properties=function(e,t){var i=this._get_private_properties(e),s=this._get_private_properties(t);for(var r in s)i[r]||delete t[r]},scheduler._on_mouse_up=function(e){if(!e||2!=e.button||!scheduler.config.touch){if(this._drag_mode&&this._drag_id){this._els.dhx_cal_data[0].style.cursor="default";var t=this._drag_id,i=this._drag_mode,s=!this._drag_pos||this._drag_pos.has_moved,r=this.getEvent(this._drag_id);if(s&&(this._drag_event._dhx_changed||!this._drag_event.start_date||r.start_date.valueOf()!=this._drag_event.start_date.valueOf()||r.end_date.valueOf()!=this._drag_event.end_date.valueOf())){
var a="new-size"==this._drag_mode;if(this.callEvent("onBeforeEventChanged",[r,e,a,this._drag_event]))if(this._drag_id=this._drag_mode=null,a&&this.config.edit_on_create){if(this.unselect(),this._new_event=new Date,this._table_view||this.config.details_on_create||!this.config.select)return scheduler.callEvent("onDragEnd",[t,i,e]),this.showLightbox(t);this._drag_pos=!0,this._select_id=this._edit_id=t}else this._new_event||this.callEvent(a?"onEventAdded":"onEventChanged",[t,this.getEvent(t)]);else a?this.deleteEvent(r.id,!0):(this._drag_event._dhx_changed=!1,
this._clear_temporary_properties(r,this._drag_event),scheduler._lame_copy(r,this._drag_event),this.updateEvent(r.id))}this._drag_pos&&(this._drag_pos.has_moved||this._drag_pos===!0)&&(this._drag_id=this._drag_mode=null,this.render_view_data()),scheduler.callEvent("onDragEnd",[t,i,e])}this._drag_id=null,this._drag_mode=null,this._drag_pos=null}},scheduler._trigger_dyn_loading=function(){return this._load_mode&&this._load()?(this._render_wait=!0,!0):!1},scheduler.update_view=function(){this._reset_ignores();
var e=this[this._mode+"_view"];return e?e(!0):this._reset_scale(),this._trigger_dyn_loading()?!0:void this.render_view_data()},scheduler.isViewExists=function(e){return!!(scheduler[e+"_view"]||scheduler.date[e+"_start"]&&scheduler.templates[e+"_date"]&&scheduler.templates[e+"_scale_date"])},scheduler.updateView=function(e,t){e=e||this._date,t=t||this._mode;var i="dhx_cal_data";this._mode?this._obj.className=this._obj.className.replace("dhx_scheduler_"+this._mode,"dhx_scheduler_"+t):this._obj.className+=" dhx_scheduler_"+t;
var s=this._mode==t&&this.config.preserve_scroll?this._els[i][0].scrollTop:!1;this[this._mode+"_view"]&&t&&this._mode!=t&&this[this._mode+"_view"](!1),this._close_not_saved();var r="dhx_multi_day";this._els[r]&&(this._els[r][0].parentNode.removeChild(this._els[r][0]),this._els[r]=null),this._mode=t,this._date=e,this._table_view="month"==this._mode,this._dy_shift=0;var a=this._els.dhx_cal_tab;if(a)for(var n=0;n<a.length;n++){var d=a[n].className;d=d.replace(/ active/g,""),a[n].getAttribute("name")==this._mode+"_tab"&&(d+=" active"),
a[n].className=d}this.update_view(),"number"==typeof s&&(this._els[i][0].scrollTop=s)},scheduler.setCurrentView=function(e,t){this.callEvent("onBeforeViewChange",[this._mode,this._date,t||this._mode,e||this._date])&&(this.updateView(e,t),this.callEvent("onViewChange",[this._mode,this._date]))},scheduler._render_x_header=function(e,t,i,s,r){r=r||0;var a=document.createElement("DIV");a.className="dhx_scale_bar",this.templates[this._mode+"_scalex_class"]&&(a.className+=" "+this.templates[this._mode+"_scalex_class"](i));
var n=this._cols[e]-1;"month"==this._mode&&0===e&&this.config.left_border&&(a.className+=" dhx_scale_bar_border",t+=1),this.set_xy(a,n,this.xy.scale_height-2,t,r),a.innerHTML=this.templates[this._mode+"_scale_date"](i,this._mode),s.appendChild(a)},scheduler._get_columns_num=function(e,t){var i=7;if(!scheduler._table_view){var s=scheduler.date["get_"+scheduler._mode+"_end"];s&&(t=s(e)),i=Math.round((t.valueOf()-e.valueOf())/864e5)}return i},scheduler._get_timeunit_start=function(){return this.date[this._mode+"_start"](new Date(this._date.valueOf()));
},scheduler._get_view_end=function(){var e=this._get_timeunit_start(),t=scheduler.date.add(e,1,this._mode);if(!scheduler._table_view){var i=scheduler.date["get_"+scheduler._mode+"_end"];i&&(t=i(e))}return t},scheduler._calc_scale_sizes=function(e,t,i){var s=e,r=this._get_columns_num(t,i);this._process_ignores(t,r,"day",1);for(var a=r-this._ignores_detected,n=0;r>n;n++)this._ignores[n]?(this._cols[n]=0,a++):this._cols[n]=Math.floor(s/(a-n)),s-=this._cols[n],this._colsS[n]=(this._cols[n-1]||0)+(this._colsS[n-1]||(this._table_view?0:this.xy.scale_width+2));
this._colsS.col_length=r,this._colsS[r]=this._cols[r-1]+this._colsS[r-1]||0},scheduler._set_scale_col_size=function(e,t,i){var s=this.config;this.set_xy(e,t-1,s.hour_size_px*(s.last_hour-s.first_hour),i+this.xy.scale_width+1,0)},scheduler._render_scales=function(e,t){var i=new Date(scheduler._min_date),s=new Date(scheduler._max_date),r=this.date.date_part(scheduler._currentDate()),a=parseInt(e.style.width,10),n=new Date(this._min_date),d=this._get_columns_num(i,s);this._calc_scale_sizes(a,i,s);var o=0;
e.innerHTML="";for(var l=0;d>l;l++){if(this._ignores[l]||this._render_x_header(l,o,n,e),!this._table_view){var _=document.createElement("DIV"),h="dhx_scale_holder";n.valueOf()==r.valueOf()&&(h_disabled="dhx_scale_holder_now"),this._ignores_detected&&this._ignores[l]&&(h+=" dhx_scale_ignore"),_.className=h+" "+this.templates.week_date_class(n,r),this._set_scale_col_size(_,this._cols[l],o),t.appendChild(_),this.callEvent("onScaleAdd",[_,n])}o+=this._cols[l],n=this.date.add(n,1,"day"),n=this.date.day_start(n);
}},scheduler._reset_scale=function(){if(this.templates[this._mode+"_date"]){var e=this._els.dhx_cal_header[0],t=this._els.dhx_cal_data[0],i=this.config;e.innerHTML="",t.innerHTML="";var s=(i.readonly||!i.drag_resize?" dhx_resize_denied":"")+(i.readonly||!i.drag_move?" dhx_move_denied":"");t.className="dhx_cal_data"+s,this._scales={},this._cols=[],this._colsS={height:0},this._dy_shift=0,this.set_sizes();var r,a,n=this._get_timeunit_start(),d=scheduler._get_view_end();if(r=a=this._table_view?scheduler.date.week_start(n):n,
this._min_date=r,this._els.dhx_cal_date[0].innerHTML=this.templates[this._mode+"_date"](n,d,this._mode),this._max_date=d,scheduler._render_scales(e,t),this._table_view)this._reset_month_scale(t,n,a);else if(this._reset_hours_scale(t,n,a),i.multi_day){var o="dhx_multi_day";this._els[o]&&(this._els[o][0].parentNode.removeChild(this._els[o][0]),this._els[o]=null);var l=this._els.dhx_cal_navline[0],_=l.offsetHeight+this._els.dhx_cal_header[0].offsetHeight+1,h=document.createElement("DIV");h.className=o,
h.style.visibility="hidden",this.set_xy(h,Math.max(this._colsS[this._colsS.col_length]+this.xy.scroll_width-2,0),0,0,_),t.parentNode.insertBefore(h,t);var c=h.cloneNode(!0);c.className=o+"_icon",c.style.visibility="hidden",this.set_xy(c,this.xy.scale_width,0,0,_),h.appendChild(c),this._els[o]=[h,c],this._els[o][0].onclick=this._click.dhx_cal_data}}},scheduler._reset_hours_scale=function(e,t,i){var s=document.createElement("DIV");s.className="dhx_scale_holder";for(var r=new Date(1980,1,1,this.config.first_hour,0,0),a=1*this.config.first_hour;a<this.config.last_hour;a++){
var n=document.createElement("DIV");n.className="dhx_scale_hour",n.style.height=this.config.hour_size_px+"px";var d=this.xy.scale_width;this.config.left_border&&(n.className+=" dhx_scale_hour_border"),n.style.width=d+"px",n.innerHTML=scheduler.templates.hour_scale(r),s.appendChild(n),r=this.date.add(r,1,"hour")}e.appendChild(s),this.config.scroll_hour&&(e.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour))},scheduler._currentDate=function(){return scheduler.config.now_date?new Date(scheduler.config.now_date):new Date;
},scheduler._reset_ignores=function(){this._ignores={},this._ignores_detected=0},scheduler._process_ignores=function(e,t,i,s,r){this._reset_ignores();var a=scheduler["ignore_"+this._mode];if(a)for(var n=new Date(e),d=0;t>d;d++)a(n)&&(this._ignores_detected+=1,this._ignores[d]=!0,r&&t++),n=scheduler.date.add(n,s,i),scheduler.date[i+"_start"]&&(n=scheduler.date[i+"_start"](n))},scheduler._render_month_scale=function(e,t,i,s){function r(e){var t=scheduler._colsS.height;return void 0!==scheduler._colsS.heights[e+1]&&(t=scheduler._colsS.heights[e+1]-(scheduler._colsS.heights[e]||0)),
t}var a=scheduler.date.add(t,1,"month"),n=new Date(i),d=scheduler._currentDate();this.date.date_part(d),this.date.date_part(i),s=s||Math.ceil(Math.round((a.valueOf()-i.valueOf())/864e5)/7);for(var o=[],l=0;7>=l;l++){var _=(this._cols[l]||0)-1;0===l&&this.config.left_border&&(_-=1),o[l]=_+"px"}var h=0,c=document.createElement("table");c.setAttribute("cellpadding","0"),c.setAttribute("cellspacing","0");var u=document.createElement("tbody");c.appendChild(u);for(var g=[],l=0;s>l;l++){var f=document.createElement("tr");
u.appendChild(f);for(var v=Math.max(r(l)-scheduler.xy.month_head_height,0),m=0;7>m;m++){var p=document.createElement("td");f.appendChild(p);var x="";t>i?x="dhx_before":i>=a?x="dhx_after":i.valueOf()==d.valueOf()&&(x_disabled="dhx_now"),this._ignores_detected&&this._ignores[m]&&(x+=" dhx_scale_ignore"),p.className=x+" "+this.templates.month_date_class(i,d);var b="dhx_month_body",y="dhx_month_head";if(0===m&&this.config.left_border&&(b+=" dhx_month_body_border",y+=" dhx_month_head_border"),this._ignores_detected&&this._ignores[m])p.appendChild(document.createElement("div")),
p.appendChild(document.createElement("div"));else{var w=document.createElement("DIV");w.className=y,w.innerHTML=this.templates.month_day(i),p.appendChild(w);var D=document.createElement("DIV");D.className=b,D.style.height=v+"px",D.style.width=o[m],p.appendChild(D)}g.push(i);var E=i.getDate();i=this.date.add(i,1,"day"),i.getDate()-E>1&&(i=new Date(i.getFullYear(),i.getMonth(),E+1,12,0))}scheduler._colsS.heights[l]=h,h+=r(l)}this._min_date=n,this._max_date=i,e.innerHTML="",e.appendChild(c),this._scales={};
for(var k=e.getElementsByTagName("div"),l=0;l<g.length;l++){var e=k[2*l+1],M=g[l];this._scales[+M]=e}for(var l=0;l<g.length;l++){var M=g[l];this.callEvent("onScaleAdd",[this._scales[+M],M])}return this._max_date},scheduler._reset_month_scale=function(e,t,i,s){var r=scheduler.date.add(t,1,"month"),a=scheduler._currentDate();this.date.date_part(a),this.date.date_part(i),s=s||Math.ceil(Math.round((r.valueOf()-i.valueOf())/864e5)/7);var n=Math.floor(e.clientHeight/s)-this.xy.month_head_height;return this._colsS.height=n+this.xy.month_head_height,
this._colsS.heights=[],scheduler._render_month_scale(e,t,i,s)},scheduler.getLabel=function(e,t){for(var i=this.config.lightbox.sections,s=0;s<i.length;s++)if(i[s].map_to==e)for(var r=i[s].options,a=0;a<r.length;a++)if(r[a].key==t)return r[a].label;return""},scheduler.updateCollection=function(e,t){var i=scheduler.serverList(e);return i?(i.splice(0,i.length),i.push.apply(i,t||[]),scheduler.callEvent("onOptionsLoad",[]),scheduler.resetLightbox(),!0):!1},scheduler._lame_clone=function(e,t){var i,s,r;
for(t=t||[],i=0;i<t.length;i+=2)if(e===t[i])return t[i+1];if(e&&"object"==typeof e){for(r={},s=[Array,Date,Number,String,Boolean],i=0;i<s.length;i++)e instanceof s[i]&&(r=i?new s[i](e):new s[i]);t.push(e,r);for(i in e)Object.prototype.hasOwnProperty.apply(e,[i])&&(r[i]=scheduler._lame_clone(e[i],t))}return r||e},scheduler._lame_copy=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},scheduler._get_date_from_pos=function(e){var t=this._min_date.valueOf()+6e4*(e.y*this.config.time_step+24*(this._table_view?0:e.x)*60);
return new Date(this._correct_shift(t))},scheduler.getActionData=function(e){var t=this._mouse_coords(e);return{date:this._get_date_from_pos(t),section:t.section}},scheduler._focus=function(e,t){e&&e.focus&&(this.config.touch?window.setTimeout(function(){e.focus()},10):(t&&e.select&&e.select(),e.focus()))},scheduler._get_real_event_length=function(e,t,i){var s,r=t-e,a=i._start_correction+i._end_correction||0,n=this["ignore_"+this._mode],d=0;i.render?(d=this._get_date_index(i,e),s=this._get_date_index(i,t)):s=Math.round(r/60/60/1e3/24);
for(var o=!0;s>d;){var l=scheduler.date.add(t,-i.x_step,i.x_unit);n&&n(t)&&(!o||o&&n(l))?r-=t-l:(o=!1,r-=a),t=l,s--}return r},scheduler._get_fictional_event_length=function(e,t,i,s){var r=new Date(e),a=s?-1:1;if(i._start_correction||i._end_correction){var n;n=s?60*r.getHours()+r.getMinutes()-60*(i.first_hour||0):60*(i.last_hour||0)-(60*r.getHours()+r.getMinutes());var d=60*(i.last_hour-i.first_hour),o=Math.ceil((t/6e4-n)/d);0>o&&(o=0),t+=o*(1440-d)*60*1e3}var l,_=new Date(1*e+t*a),h=this["ignore_"+this._mode],c=0;
for(i.render?(c=this._get_date_index(i,r),l=this._get_date_index(i,_)):l=Math.round(t/60/60/1e3/24);l*a>=c*a;){var u=scheduler.date.add(r,i.x_step*a,i.x_unit);h&&h(r)&&(t+=(u-r)*a,l+=a),r=u,c+=a}return t},scheduler._get_section_view=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode]:this._props&&this._props[this._mode]?this._props[this._mode]:null},scheduler._get_section_property=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode].y_property:this._props&&this._props[this._mode]?this._props[this._mode].map_to:null;
},scheduler._is_initialized=function(){var e=this.getState();return this._obj&&e.date&&e.mode},scheduler._is_lightbox_open=function(){var e=this.getState();return null!==e.lightbox_id&&void 0!==e.lightbox_id},scheduler._getClassName=function(e){if(!e)return"";var t=e.className||"";return t.baseVal&&(t=t.baseVal),t.indexOf||(t=""),t||""},scheduler.date={init:function(){for(var e=scheduler.locale.date.month_short,t=scheduler.locale.date.month_short_hash={},i=0;i<e.length;i++)t[e[i]]=i;for(var e=scheduler.locale.date.month_full,t=scheduler.locale.date.month_full_hash={},i=0;i<e.length;i++)t[e[i]]=i;
},date_part:function(e){var t=new Date(e);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.getHours()&&(e.getDate()<t.getDate()||e.getMonth()<t.getMonth()||e.getFullYear()<t.getFullYear())&&e.setTime(e.getTime()+36e5*(24-e.getHours())),e},time_part:function(e){return(e.valueOf()/1e3-60*e.getTimezoneOffset())%86400},week_start:function(e){var t=e.getDay();return scheduler.config.start_on_monday&&(0===t?t=6:t--),this.date_part(this.add(e,-1*t,"day"))},month_start:function(e){
return e.setDate(1),this.date_part(e)},year_start:function(e){return e.setMonth(0),this.month_start(e)},day_start:function(e){return this.date_part(e)},_add_days:function(e,t){var i=new Date(e.valueOf());if(i.setDate(i.getDate()+t),t==Math.round(t)&&t>0){var s=+i-+e,r=s%864e5;if(r&&e.getTimezoneOffset()==i.getTimezoneOffset()){var a=r/36e5;i.setTime(i.getTime()+60*(24-a)*60*1e3)}}return t>=0&&!e.getHours()&&i.getHours()&&(i.getDate()<e.getDate()||i.getMonth()<e.getMonth()||i.getFullYear()<e.getFullYear())&&i.setTime(i.getTime()+36e5*(24-i.getHours())),
i},add:function(e,t,i){var s=new Date(e.valueOf());switch(i){case"day":s=scheduler.date._add_days(s,t);break;case"week":s=scheduler.date._add_days(s,7*t);break;case"month":s.setMonth(s.getMonth()+t);break;case"year":s.setYear(s.getFullYear()+t);break;case"hour":s.setTime(s.getTime()+60*t*60*1e3);break;case"minute":s.setTime(s.getTime()+60*t*1e3);break;default:return scheduler.date["add_"+i](e,t,i)}return s},to_fixed:function(e){return 10>e?"0"+e:e},copy:function(e){return new Date(e.valueOf())},date_to_str:function(e,t){
return e=e.replace(/%[a-zA-Z]/g,function(e){switch(e){case"%d":return'"+scheduler.date.to_fixed(date.getDate())+"';case"%m":return'"+scheduler.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+scheduler.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+scheduler.locale.date.day_short[date.getDay()]+"';case"%l":return'"+scheduler.locale.date.day_full[date.getDay()]+"';
case"%M":return'"+scheduler.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+scheduler.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+scheduler.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+scheduler.date.to_fixed(date.getHours())+"';case"%i":return'"+scheduler.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';
case"%s":return'"+scheduler.date.to_fixed(date.getSeconds())+"';case"%W":return'"+scheduler.date.to_fixed(scheduler.date.getISOWeek(date))+"';default:return e}}),t&&(e=e.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+e+'";')},str_to_date:function(e,t){for(var i="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",s=e.match(/%[a-zA-Z]/g),r=0;r<s.length;r++)switch(s[r]){case"%j":case"%d":i+="set[2]=temp["+r+"]||1;";break;case"%n":case"%m":i+="set[1]=(temp["+r+"]||1)-1;";break;case"%y":i+="set[0]=temp["+r+"]*1+(temp["+r+"]>50?1900:2000);";
break;case"%g":case"%G":case"%h":case"%H":i+="set[3]=temp["+r+"]||0;";break;case"%i":i+="set[4]=temp["+r+"]||0;";break;case"%Y":i+="set[0]=temp["+r+"]||0;";break;case"%a":case"%A":i+="set[3]=set[3]%12+((temp["+r+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":i+="set[5]=temp["+r+"]||0;";break;case"%M":i+="set[1]=scheduler.locale.date.month_short_hash[temp["+r+"]]||0;";break;case"%F":i+="set[1]=scheduler.locale.date.month_full_hash[temp["+r+"]]||0;"}var a="set[0],set[1],set[2],set[3],set[4],set[5]";
return t&&(a=" Date.UTC("+a+")"),new Function("date","var set=[0,0,1,0,0,0]; "+i+" return new Date("+a+");")},getISOWeek:function(e){if(!e)return!1;var t=e.getDay();0===t&&(t=7);var i=new Date(e.valueOf());i.setDate(e.getDate()+(4-t));var s=i.getFullYear(),r=Math.round((i.getTime()-new Date(s,0,1).getTime())/864e5),a=1+Math.floor(r/7);return a},getUTCISOWeek:function(e){return this.getISOWeek(this.convert_to_utc(e))},convert_to_utc:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());
}},scheduler.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",
icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",button_edit_series:"Edit series",button_edit_occurrence:"Edit occurrence",agenda_tab:"Agenda",date:"Date",
description:"Description",year_tab:"Year",week_agenda_tab:"Agenda",grid_tab:"Grid",drag_to_create:"Drag to create",drag_to_move:"Drag to move",message_ok:"OK",message_cancel:"Cancel"}},scheduler.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",xml_date:"%m/%d/%Y %H:%i",api_date:"%d-%m-%Y %H:%i",preserve_length:!0,time_step:5,start_on_monday:1,first_hour:0,last_hour:24,readonly:!1,drag_resize:1,drag_move:1,
drag_create:1,dblclick_create:1,edit_on_create:1,details_on_create:0,resize_month_events:!1,resize_month_timed:!1,cascade_event_display:!1,cascade_event_count:4,cascade_event_margin:30,multi_day:!0,multi_day_height_limit:0,drag_lightbox:!0,preserve_scroll:!0,select:!0,server_utc:!1,touch:!0,touch_tip:!0,touch_drag:500,quick_info_detached:!0,positive_closing:!1,drag_highlight:!0,limit_drag_out:!1,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],
buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:200,map_to:"text",type:"textarea",focus:!0},{name:"time",height:72,type:"time",map_to:"auto"}]},highlight_displayed_event:!0,left_border:!1,ajax_error:"alert",delay_render:0,timeline_swap_resize:!1},scheduler.templates={},scheduler.init_templates=function(){var e=scheduler.locale.labels;e.dhx_save_btn=e.icon_save,e.dhx_cancel_btn=e.icon_cancel,e.dhx_delete_btn=e.icon_delete;var t=scheduler.date.date_to_str,i=scheduler.config,s=function(e,t){
for(var i in t)e[i]||(e[i]=t[i])};s(scheduler.templates,{day_date:t(i.default_date),month_date:t(i.month_date),week_date:function(e,t){return scheduler.templates.day_date(e)+" &ndash; "+scheduler.templates.day_date(scheduler.date.add(t,-1,"day"))},day_scale_date:t(i.default_date),month_scale_date:t(i.week_date),week_scale_date:t(i.day_date),hour_scale:t(i.hour_date),time_picker:t(i.hour_date),event_date:t(i.hour_date),month_day:t(i.month_day),xml_date:scheduler.date.str_to_date(i.xml_date,i.server_utc),
load_format:t(i.load_date,i.server_utc),xml_format:t(i.xml_date,i.server_utc),api_date:scheduler.date.str_to_date(i.api_date),event_header:function(e,t,i){return scheduler.templates.event_date(e)+" - "+scheduler.templates.event_date(t)},event_text:function(e,t,i){return i.text},event_class:function(e,t,i){return""},month_date_class:function(e){return""},week_date_class:function(e){return""},event_bar_date:function(e,t,i){return scheduler.templates.event_date(e)+" "},event_bar_text:function(e,t,i){
return i.text},month_events_link:function(e,t){return"<a>View more("+t+" events)</a>"},drag_marker_class:function(e,t,i){return""},drag_marker_content:function(e,t,i){return""}}),this.callEvent("onTemplatesReady",[])},scheduler.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++},scheduler._events={},scheduler.clearAll=function(){this._events={},this._loaded={},this._edit_id=null,this._select_id=null,this._drag_id=null,this._drag_mode=null,this._drag_pos=null,this.clear_view(),
this.callEvent("onClearAll",[])},scheduler.addEvent=function(e,t,i,s,r){if(!arguments.length)return this.addEventNow();var a=e;1!=arguments.length&&(a=r||{},a.start_date=e,a.end_date=t,a.text=i,a.id=s),a.id=a.id||scheduler.uid(),a.text=a.text||"","string"==typeof a.start_date&&(a.start_date=this.templates.api_date(a.start_date)),"string"==typeof a.end_date&&(a.end_date=this.templates.api_date(a.end_date));var n=6e4*(this.config.event_duration||this.config.time_step);a.start_date.valueOf()==a.end_date.valueOf()&&a.end_date.setTime(a.end_date.valueOf()+n),
a._timed=this.isOneDayEvent(a);var d=!this._events[a.id];return this._events[a.id]=a,this.event_updated(a),this._loading||this.callEvent(d?"onEventAdded":"onEventChanged",[a.id,a]),a.id},scheduler.deleteEvent=function(e,t){var i=this._events[e];(t||this.callEvent("onBeforeEventDelete",[e,i])&&this.callEvent("onConfirmedBeforeEventDelete",[e,i]))&&(i&&(this._select_id=null,delete this._events[e],this.event_updated(i)),this.callEvent("onEventDeleted",[e,i]))},scheduler.getEvent=function(e){return this._events[e];
},scheduler.setEvent=function(e,t){t.id||(t.id=e),this._events[e]=t},scheduler.for_rendered=function(e,t){for(var i=this._rendered.length-1;i>=0;i--)this._rendered[i].getAttribute("event_id")==e&&t(this._rendered[i],i)},scheduler.changeEventId=function(e,t){if(e!=t){var i=this._events[e];i&&(i.id=t,this._events[t]=i,delete this._events[e]),this.for_rendered(e,function(e){e.setAttribute("event_id",t)}),this._select_id==e&&(this._select_id=t),this._edit_id==e&&(this._edit_id=t),this.callEvent("onEventIdChange",[e,t]);
}},function(){for(var e=["text","Text","start_date","StartDate","end_date","EndDate"],t=function(e){return function(t){return scheduler.getEvent(t)[e]}},i=function(e){return function(t,i){var s=scheduler.getEvent(t);s[e]=i,s._changed=!0,s._timed=this.isOneDayEvent(s),scheduler.event_updated(s,!0)}},s=0;s<e.length;s+=2)scheduler["getEvent"+e[s+1]]=t(e[s]),scheduler["setEvent"+e[s+1]]=i(e[s])}(),scheduler.event_updated=function(e,t){this.is_visible_events(e)?this.render_view_data():this.clear_event(e.id);
},scheduler.is_visible_events=function(e){var t=e.start_date.valueOf()<this._max_date.valueOf()&&this._min_date.valueOf()<e.end_date.valueOf();if(t){var i=e.start_date.getHours(),s=e.end_date.getHours()+e.end_date.getMinutes()/60,r=this.config.last_hour,a=this.config.first_hour,n=this._table_view||!((s>r||a>s)&&(i>=r||a>i));if(n)return!0;var d=(e.end_date.valueOf()-e.start_date.valueOf())/36e5,o=24-(this.config.last_hour-this.config.first_hour);return!!(d>o||r>i&&s>=a)}return!1},scheduler.isOneDayEvent=function(e){
var t=e.end_date.getDate()-e.start_date.getDate();return t?(0>t&&(t=Math.ceil((e.end_date.valueOf()-e.start_date.valueOf())/864e5)),1==t&&!e.end_date.getHours()&&!e.end_date.getMinutes()&&(e.start_date.getHours()||e.start_date.getMinutes())):e.start_date.getMonth()==e.end_date.getMonth()&&e.start_date.getFullYear()==e.end_date.getFullYear()},scheduler.get_visible_events=function(e){var t=[];for(var i in this._events)this.is_visible_events(this._events[i])&&(!e||this._events[i]._timed)&&this.filter_event(i,this._events[i])&&t.push(this._events[i]);
return t},scheduler.filter_event=function(e,t){var i=this["filter_"+this._mode];return i?i(e,t):!0},scheduler._is_main_area_event=function(e){return!!e._timed},scheduler.render_view_data=function(e,t){if(!e){if(this._not_render)return void(this._render_wait=!0);this._render_wait=!1,this.clear_view(),e=this.get_visible_events(!(this._table_view||this.config.multi_day))}for(var i=0,s=e.length;s>i;i++)this._recalculate_timed(e[i]);if(this.config.multi_day&&!this._table_view){for(var r=[],a=[],i=0;i<e.length;i++)this._is_main_area_event(e[i])?r.push(e[i]):a.push(e[i]);
this._rendered_location=this._els.dhx_multi_day[0],this._table_view=!0,this.render_data(a,t),this._table_view=!1,this._rendered_location=this._els.dhx_cal_data[0],this._table_view=!1,this.render_data(r,t)}else this._rendered_location=this._els.dhx_cal_data[0],this.render_data(e,t)},scheduler._view_month_day=function(e){var t=scheduler.getActionData(e).date;scheduler.callEvent("onViewMoreClick",[t])&&scheduler.setCurrentView(t,"day")},scheduler._render_month_link=function(e){for(var t=this._rendered_location,i=this._lame_clone(e),s=e._sday;s<e._eday;s++){
i._sday=s,i._eday=s+1;var r=scheduler.date,a=scheduler._min_date;a=r.add(a,i._sweek,"week"),a=r.add(a,i._sday,"day");var n=scheduler.getEvents(a,r.add(a,1,"day")).length,d=this._get_event_bar_pos(i),o=d.x2-d.x,l=document.createElement("div");l.onclick=function(e){scheduler._view_month_day(e||event)},l.className="dhx_month_link",l.style.top=d.y+"px",l.style.left=d.x+"px",l.style.width=o+"px",l.innerHTML=scheduler.templates.month_events_link(a,n),this._rendered.push(l),t.appendChild(l)}},scheduler._recalculate_timed=function(e){
if(e){var t;t="object"!=typeof e?this._events[e]:e,t&&(t._timed=scheduler.isOneDayEvent(t))}},scheduler.attachEvent("onEventChanged",scheduler._recalculate_timed),scheduler.attachEvent("onEventAdded",scheduler._recalculate_timed),scheduler.render_data=function(e,t){e=this._pre_render_events(e,t);for(var i=0;i<e.length;i++)if(this._table_view)if("month"!=scheduler._mode)this.render_event_bar(e[i]);else{var s=scheduler.config.max_month_events;s!==1*s||e[i]._sorder<s?this.render_event_bar(e[i]):void 0!==s&&e[i]._sorder==s&&scheduler._render_month_link(e[i]);
}else this.render_event(e[i])},scheduler._get_first_visible_cell=function(e){for(var t=0;t<e.length;t++)if(-1==(e[t].className||"").indexOf("dhx_scale_ignore"))return e[t];return e[0]},scheduler._pre_render_events=function(e,t){var i=this.xy.bar_height,s=this._colsS.heights,r=this._colsS.heights=[0,0,0,0,0,0,0],a=this._els.dhx_cal_data[0];if(e=this._table_view?this._pre_render_events_table(e,t):this._pre_render_events_line(e,t),this._table_view)if(t)this._colsS.heights=s;else{var n=a.firstChild;if(n.rows){
for(var d=0;d<n.rows.length;d++){r[d]++;var o=n.rows[d].cells,l=this._colsS.height-this.xy.month_head_height;if(r[d]*i>l){var _=l;1*this.config.max_month_events!==this.config.max_month_events||r[d]<=this.config.max_month_events?_=r[d]*i:(this.config.max_month_events+1)*i>l&&(_=(this.config.max_month_events+1)*i);for(var h=0;h<o.length;h++)o[h].childNodes[1].style.height=_+"px"}r[d]=(r[d-1]||0)+scheduler._get_first_visible_cell(o).offsetHeight}if(r.unshift(0),n.parentNode.offsetHeight<n.parentNode.scrollHeight&&!scheduler._colsS.scroll_fix&&scheduler.xy.scroll_width){
var c=scheduler._colsS,u=c[c.col_length],g=c.heights.slice();u-=scheduler.xy.scroll_width||0,this._calc_scale_sizes(u,this._min_date,this._max_date),scheduler._colsS.heights=g,this.set_xy(this._els.dhx_cal_header[0],u,this.xy.scale_height),scheduler._render_scales(this._els.dhx_cal_header[0]),scheduler._render_month_scale(this._els.dhx_cal_data[0],this._get_timeunit_start(),this._min_date),c.scroll_fix=!0}}else if(e.length||"visible"!=this._els.dhx_multi_day[0].style.visibility||(r[0]=-1),e.length||-1==r[0]){
var f=(n.parentNode.childNodes,(r[0]+1)*i+1),v=f,m=f+"px";this.config.multi_day_height_limit&&(v=Math.min(f,this.config.multi_day_height_limit),m=v+"px"),a.style.top=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+v+"px",a.style.height=this._obj.offsetHeight-parseInt(a.style.top,10)-(this.xy.margin_top||0)+"px";var p=this._els.dhx_multi_day[0];p.style.height=m,p.style.visibility=-1==r[0]?"hidden":"visible";var x=this._els.dhx_multi_day[1];x.style.height=m,x.style.visibility=-1==r[0]?"hidden":"visible",
x.className=r[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small",this._dy_shift=(r[0]+1)*i,this.config.multi_day_height_limit&&(this._dy_shift=Math.min(this.config.multi_day_height_limit,this._dy_shift)),r[0]=0,v!=f&&(a.style.top=parseInt(a.style.top)+2+"px",p.style.overflowY="auto",x.style.position="fixed",x.style.top="",x.style.left="")}}return e},scheduler._get_event_sday=function(e){var t=this.date.day_start(new Date(e.start_date));return Math.round((t.valueOf()-this._min_date.valueOf())/864e5);
},scheduler._get_event_mapped_end_date=function(e){var t=e.end_date;if(this.config.separate_short_events){var i=(e.end_date-e.start_date)/6e4;i<this._min_mapped_duration&&(t=this.date.add(t,this._min_mapped_duration-i,"minute"))}return t},scheduler._pre_render_events_line=function(e,t){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});var i=[],s=[];this._min_mapped_duration=Math.ceil(60*this.xy.min_event_height/this.config.hour_size_px);
for(var r=0;r<e.length;r++){var a=e[r],n=a.start_date,d=a.end_date,o=n.getHours(),l=d.getHours();if(a._sday=this._get_event_sday(a),this._ignores[a._sday])e.splice(r,1),r--;else{if(i[a._sday]||(i[a._sday]=[]),!t){a._inner=!1;for(var _=i[a._sday];_.length;){var h=_[_.length-1],c=this._get_event_mapped_end_date(h);if(!(c.valueOf()<=a.start_date.valueOf()))break;_.splice(_.length-1,1)}for(var u=_.length,g=!1,f=0;f<_.length;f++){var h=_[f],c=this._get_event_mapped_end_date(h);if(c.valueOf()<=a.start_date.valueOf()){
g=!0,a._sorder=h._sorder,u=f,a._inner=!0;break}}if(_.length&&(_[_.length-1]._inner=!0),!g)if(_.length)if(_.length<=_[_.length-1]._sorder){if(_[_.length-1]._sorder)for(f=0;f<_.length;f++){for(var v=!1,m=0;m<_.length;m++)if(_[m]._sorder==f){v=!0;break}if(!v){a._sorder=f;break}}else a._sorder=0;a._inner=!0}else{var p=_[0]._sorder;for(f=1;f<_.length;f++)_[f]._sorder>p&&(p=_[f]._sorder);a._sorder=p+1,a._inner=!1}else a._sorder=0;_.splice(u,u==_.length?0:1,a),_.length>(_.max_count||0)?(_.max_count=_.length,
a._count=_.length):a._count=a._count?a._count:1}(o<this.config.first_hour||l>=this.config.last_hour)&&(s.push(a),e[r]=a=this._copy_event(a),o<this.config.first_hour&&(a.start_date.setHours(this.config.first_hour),a.start_date.setMinutes(0)),l>=this.config.last_hour&&(a.end_date.setMinutes(0),a.end_date.setHours(this.config.last_hour)),a.start_date>a.end_date||o==this.config.last_hour)&&(e.splice(r,1),r--)}}if(!t){for(var r=0;r<e.length;r++)e[r]._count=i[e[r]._sday].max_count;for(var r=0;r<s.length;r++)s[r]._count=i[s[r]._sday].max_count;
}return e},scheduler._time_order=function(e){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e._timed&&!t._timed?1:!e._timed&&t._timed?-1:e.id>t.id?1:-1:e.start_date>t.start_date?1:-1})},scheduler._pre_render_events_table=function(e,t){this._time_order(e);for(var i,s=[],r=[[],[],[],[],[],[],[]],a=this._colsS.heights,n=this._cols.length,d={},o=0;o<e.length;o++){var l=e[o],_=l.id;d[_]||(d[_]={first_chunk:!0,last_chunk:!0});var h=d[_],c=i||l.start_date,u=l.end_date;c<this._min_date&&(h.first_chunk=!1,
c=this._min_date),u>this._max_date&&(h.last_chunk=!1,u=this._max_date);var g=this.locate_holder_day(c,!1,l);if(l._sday=g%n,!this._ignores[l._sday]||!l._timed){var f=this.locate_holder_day(u,!0,l)||n;l._eday=f%n||n,l._length=f-g,l._sweek=Math.floor((this._correct_shift(c.valueOf(),1)-this._min_date.valueOf())/(864e5*n));var v,m=r[l._sweek];for(v=0;v<m.length&&!(m[v]._eday<=l._sday);v++);if(l._sorder&&t||(l._sorder=v),l._sday+l._length<=n)i=null,s.push(l),m[v]=l,a[l._sweek]=m.length-1,l._first_chunk=h.first_chunk,
l._last_chunk=h.last_chunk;else{var p=this._copy_event(l);p.id=l.id,p._length=n-l._sday,p._eday=n,p._sday=l._sday,p._sweek=l._sweek,p._sorder=l._sorder,p.end_date=this.date.add(c,p._length,"day"),p._first_chunk=h.first_chunk,h.first_chunk&&(h.first_chunk=!1),s.push(p),m[v]=p,i=p.end_date,a[l._sweek]=m.length-1,o--}}}return s},scheduler._copy_dummy=function(){var e=new Date(this.start_date),t=new Date(this.end_date);this.start_date=e,this.end_date=t},scheduler._copy_event=function(e){return this._copy_dummy.prototype=e,
new this._copy_dummy},scheduler._rendered=[],scheduler.clear_view=function(){for(var e=0;e<this._rendered.length;e++){var t=this._rendered[e];t.parentNode&&t.parentNode.removeChild(t)}this._rendered=[]},scheduler.updateEvent=function(e){var t=this.getEvent(e);this.clear_event(e),t&&this.is_visible_events(t)&&this.filter_event(e,t)&&(this._table_view||this.config.multi_day||t._timed)&&(this.config.update_render?this.render_view_data():"month"!=this.getState().mode||this.getState().drag_id||this.isOneDayEvent(t)?this.render_view_data([t],!0):this.render_view_data());
},scheduler.clear_event=function(e){this.for_rendered(e,function(e,t){e.parentNode&&e.parentNode.removeChild(e),scheduler._rendered.splice(t,1)})},scheduler._y_from_date=function(e){var t=60*e.getHours()+e.getMinutes();return Math.round((60*t*1e3-60*this.config.first_hour*60*1e3)*this.config.hour_size_px/36e5)%(24*this.config.hour_size_px)},scheduler._calc_event_y=function(e,t){t=t||0;var i=60*e.start_date.getHours()+e.start_date.getMinutes(),s=60*e.end_date.getHours()+e.end_date.getMinutes()||60*scheduler.config.last_hour,r=this._y_from_date(e.start_date),a=Math.max(t,(s-i)*this.config.hour_size_px/60);
return{top:r,height:a}},scheduler.render_event=function(e){var t=scheduler.xy.menu_width,i=this.config.use_select_menu_space?0:t;if(!(e._sday<0)){var s=scheduler.locate_holder(e._sday);if(s){var r=this._calc_event_y(e,scheduler.xy.min_event_height),a=r.top,n=r.height,d=e._count||1,o=e._sorder||0,l=Math.floor((s.clientWidth-i)/d),_=o*l+1;if(e._inner||(l*=d-o),this.config.cascade_event_display){var h=this.config.cascade_event_count,c=this.config.cascade_event_margin;_=o%h*c;var u=e._inner?(d-o-1)%h*c/2:0;
l=Math.floor(s.clientWidth-i-_-u)}var g=this._render_v_bar(e,i+_,a,l,n,e._text_style,scheduler.templates.event_header(e.start_date,e.end_date,e),scheduler.templates.event_text(e.start_date,e.end_date,e));if(this._rendered.push(g),s.appendChild(g),_=_+parseInt(s.style.left,10)+i,this._edit_id==e.id){g.style.zIndex=1,l=Math.max(l-4,scheduler.xy.editor_width),g=document.createElement("DIV"),g.setAttribute("event_id",e.id),this.set_xy(g,l,n-20,_,a+14),g.className="dhx_cal_event dhx_cal_editor";var f=scheduler.templates.event_class(e.start_date,e.end_date,e);
f&&(g.className+=" "+f);var v=document.createElement("DIV");this.set_xy(v,l-6,n-26),v.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;",g.appendChild(v),this._els.dhx_cal_data[0].appendChild(g),this._rendered.push(g),v.innerHTML="<textarea class='dhx_cal_editor'>"+e.text+"</textarea>",this._quirks7&&(v.firstChild.style.height=n-12+"px"),this._editor=v.firstChild,this._editor.onkeydown=function(e){if((e||event).shiftKey)return!0;var t=(e||event).keyCode;t==scheduler.keys.edit_save&&scheduler.editStop(!0),
t==scheduler.keys.edit_cancel&&scheduler.editStop(!1)},this._editor.onselectstart=function(e){return(e||event).cancelBubble=!0,!0},scheduler._focus(v.firstChild,!0),this._els.dhx_cal_data[0].scrollLeft=0}if(0!==this.xy.menu_width&&this._select_id==e.id){this.config.cascade_event_display&&this._drag_mode&&(g.style.zIndex=1);for(var m=this.config["icons_"+(this._edit_id==e.id?"edit":"select")],p="",x=e.color?"background-color: "+e.color+";":"",b=e.textColor?"color: "+e.textColor+";":"",y=0;y<m.length;y++)p+="<div class='dhx_menu_icon "+m[y]+"' style='"+x+b+"' title='"+this.locale.labels[m[y]]+"'></div>";
var w=this._render_v_bar(e,_-t+1,a,t,20*m.length+26-2,"","<div style='"+x+b+"' class='dhx_menu_head'></div>",p,!0);w.style.left=_-t+1,this._els.dhx_cal_data[0].appendChild(w),this._rendered.push(w)}this.config.drag_highlight&&this._drag_id==e.id&&this.highlightEventPosition(e)}}},scheduler._render_v_bar=function(e,t,i,s,r,a,n,d,o){var l=document.createElement("DIV"),_=e.id,h=o?"dhx_cal_event dhx_cal_select_menu":"dhx_cal_event",c=scheduler.templates.event_class(e.start_date,e.end_date,e);c&&(h=h+" "+c);
var u=e.color?"background:"+e.color+";":"",g=e.textColor?"color:"+e.textColor+";":"",f='<div event_id="'+_+'" class="'+h+'" style="position:absolute; top:'+i+"px; left:"+t+"px; width:"+(s-4)+"px; height:"+r+"px;"+(a||"")+'"></div>';l.innerHTML=f;var v=l.cloneNode(!0).firstChild;if(!o&&scheduler.renderEvent(v,e,s,r,n,d))return v;v=l.firstChild;var m='<div class="dhx_event_move dhx_header" style=" width:'+(s-6)+"px;"+u+'" >&nbsp;</div>';m+='<div class="dhx_event_move dhx_title" style="'+u+g+'">'+n+"</div>",
m+='<div class="dhx_body" style=" width:'+(s-(this._quirks?4:14))+"px; height:"+(r-(this._quirks?20:30)+1)+"px;"+u+g+'">'+d+"</div>";var p="dhx_event_resize dhx_footer";return o&&(p="dhx_resize_denied "+p),m+='<div class="'+p+'" style=" width:'+(s-8)+"px;"+(o?" margin-top:-1px;":"")+u+g+'" ></div>',v.innerHTML=m,v},scheduler.renderEvent=function(){return!1},scheduler.locate_holder=function(e){return"day"==this._mode?this._els.dhx_cal_data[0].firstChild:this._els.dhx_cal_data[0].childNodes[e]},scheduler.locate_holder_day=function(e,t){
var i=Math.floor((this._correct_shift(e,1)-this._min_date)/864e5);return t&&this.date.time_part(e)&&i++,i},scheduler._get_dnd_order=function(e,t,i){if(!this._drag_event)return e;this._drag_event._orig_sorder?e=this._drag_event._orig_sorder:this._drag_event._orig_sorder=e;for(var s=t*e;s+t>i;)e--,s-=t;return e=Math.max(e,0)},scheduler._get_event_bar_pos=function(e){var t=this._colsS[e._sday],i=this._colsS[e._eday];i==t&&(i=this._colsS[e._eday+1]);var s=this.xy.bar_height,r=e._sorder;if(e.id==this._drag_id){
var a=this._colsS.heights[e._sweek+1]-this._colsS.heights[e._sweek]-this.xy.month_head_height;r=scheduler._get_dnd_order(r,s,a)}var n=r*s,d=this._colsS.heights[e._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+n;return{x:t,x2:i,y:d}},scheduler.render_event_bar=function(e){var t=this._rendered_location,i=this._get_event_bar_pos(e),s=i.y,r=i.x,a=i.x2,n="";if(a){var d=scheduler.config.resize_month_events&&"month"==this._mode&&(!e._timed||scheduler.config.resize_month_timed),o=document.createElement("DIV"),l=e.hasOwnProperty("_first_chunk")&&e._first_chunk,_=e.hasOwnProperty("_last_chunk")&&e._last_chunk,h=d&&(e._timed||l),c=d&&(e._timed||_),u="dhx_cal_event_clear";
(!e._timed||d)&&(u="dhx_cal_event_line"),l&&(u+=" dhx_cal_event_line_start"),_&&(u+=" dhx_cal_event_line_end"),h&&(n+="<div class='dhx_event_resize dhx_event_resize_start'></div>"),c&&(n+="<div class='dhx_event_resize dhx_event_resize_end'></div>");var g=scheduler.templates.event_class(e.start_date,e.end_date,e);g&&(u+=" "+g);var f=e.color?"background:"+e.color+";":"",v=e.textColor?"color:"+e.textColor+";":"",m=["position:absolute","top:"+s+"px","left:"+r+"px","width:"+(a-r-15)+"px",v,f,e._text_style||""].join(";"),p='<div event_id="'+e.id+'" class="'+u+'" style="'+m+'">';
d&&(p+=n),"month"==scheduler.getState().mode&&(e=scheduler.getEvent(e.id)),e._timed&&(p+=scheduler.templates.event_bar_date(e.start_date,e.end_date,e)),p+=scheduler.templates.event_bar_text(e.start_date,e.end_date,e)+"</div>",p+="</div>",o.innerHTML=p,this._rendered.push(o.firstChild),t.appendChild(o.firstChild)}},scheduler._locate_event=function(e){for(var t=null;e&&!t&&e.getAttribute;)t=e.getAttribute("event_id"),e=e.parentNode;return t},scheduler.edit=function(e){this._edit_id!=e&&(this.editStop(!1,e),
this._edit_id=e,this.updateEvent(e))},scheduler.editStop=function(e,t){if(!t||this._edit_id!=t){var i=this.getEvent(this._edit_id);i&&(e&&(i.text=this._editor.value),this._edit_id=null,this._editor=null,this.updateEvent(i.id),this._edit_stop_event(i,e))}},scheduler._edit_stop_event=function(e,t){this._new_event?(t?this.callEvent("onEventAdded",[e.id,e]):e&&this.deleteEvent(e.id,!0),this._new_event=null):t&&this.callEvent("onEventChanged",[e.id,e])},scheduler.getEvents=function(e,t){var i=[];for(var s in this._events){
var r=this._events[s];r&&(!e&&!t||r.start_date<t&&r.end_date>e)&&i.push(r)}return i},scheduler.getRenderedEvent=function(e){if(e){for(var t=scheduler._rendered,i=0;i<t.length;i++){var s=t[i];if(s.getAttribute("event_id")==e)return s}return null}},scheduler.showEvent=function(e,t){var i="number"==typeof e||"string"==typeof e?scheduler.getEvent(e):e;if(t=t||scheduler._mode,i&&(!this.checkEvent("onBeforeEventDisplay")||this.callEvent("onBeforeEventDisplay",[i,t]))){var s=scheduler.config.scroll_hour;
scheduler.config.scroll_hour=i.start_date.getHours();var r=scheduler.config.preserve_scroll;scheduler.config.preserve_scroll=!1;var a=i.color,n=i.textColor;if(scheduler.config.highlight_displayed_event&&(i.color=scheduler.config.displayed_event_color,i.textColor=scheduler.config.displayed_event_text_color),scheduler.setCurrentView(new Date(i.start_date),t),i.color=a,i.textColor=n,scheduler.config.scroll_hour=s,scheduler.config.preserve_scroll=r,scheduler.matrix&&scheduler.matrix[t]){var d=scheduler.getRenderedEvent(i.id);
d&&(scheduler._els.dhx_cal_data[0].scrollTop=getAbsoluteTop(d)-getAbsoluteTop(scheduler._els.dhx_cal_data[0])-20)}scheduler.callEvent("onAfterEventDisplay",[i,t])}},scheduler._append_drag_marker=function(e){if(!e.parentNode){var t=scheduler._els.dhx_cal_data[0],i=t.lastChild,s=scheduler._getClassName(i);s.indexOf("dhx_scale_holder")<0&&i.previousSibling&&(i=i.previousSibling),s=scheduler._getClassName(i),i&&0===s.indexOf("dhx_scale_holder")&&i.appendChild(e)}},scheduler._update_marker_position=function(e,t){
var i=scheduler._calc_event_y(t,0);e.style.top=i.top+"px",e.style.height=i.height+"px"},scheduler.highlightEventPosition=function(e){var t=document.createElement("div");t.setAttribute("event_id",e.id),this._rendered.push(t),this._update_marker_position(t,e);var i=this.templates.drag_marker_class(e.start_date,e.end_date,e),s=this.templates.drag_marker_content(e.start_date,e.end_date,e);t.className="dhx_drag_marker",i&&(t.className+=" "+i),s&&(t.innerHTML=s),this._append_drag_marker(t)},scheduler._loaded={},
scheduler._load=function(e,t){if(e=e||this._load_url){e+=(-1==e.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset(),this.config.prevent_cache&&(e+="&uid="+this.uid());var i;if(t=t||this._date,this._load_mode){var s=this.templates.load_format;for(t=this.date[this._load_mode+"_start"](new Date(t.valueOf()));t>this._min_date;)t=this.date.add(t,-1,this._load_mode);i=t;for(var r=!0;i<this._max_date;)i=this.date.add(i,1,this._load_mode),this._loaded[s(t)]&&r?t=this.date.add(t,1,this._load_mode):r=!1;
var a=i;do i=a,a=this.date.add(i,-1,this._load_mode);while(a>t&&this._loaded[s(a)]);if(t>=i)return!1;for(dhtmlxAjax.get(e+"&from="+s(t)+"&to="+s(i),function(e){scheduler.on_load(e)});i>t;)this._loaded[s(t)]=!0,t=this.date.add(t,1,this._load_mode)}else dhtmlxAjax.get(e,function(e){scheduler.on_load(e)});return this.callEvent("onXLS",[]),!0}},scheduler.on_load=function(e){var t,i=!1;if(this._process&&"xml"!=this._process)try{t=this[this._process].parse(e.xmlDoc.responseText)}catch(s){i=!0}else t=this._magic_parser(e),
t||(i=!0);i&&(this.callEvent("onLoadError",[e.xmlDoc]),t=[]),scheduler._process_loading(t),this.callEvent("onXLE",[])},scheduler._process_loading=function(e){this._loading=!0,this._not_render=!0;for(var t=0;t<e.length;t++)this.callEvent("onEventLoading",[e[t]])&&this.addEvent(e[t]);this._not_render=!1,this._render_wait&&this.render_view_data(),this._loading=!1,this._after_call&&this._after_call(),this._after_call=null},scheduler._init_event=function(e){e.text=e.text||e._tagvalue||"",e.start_date=scheduler._init_date(e.start_date),
e.end_date=scheduler._init_date(e.end_date)},scheduler._init_date=function(e){return e?"string"==typeof e?scheduler.templates.xml_date(e):new Date(e):null},scheduler.json={},scheduler.json.parse=function(data){"string"==typeof data&&(scheduler._temp=eval("("+data+")"),data=scheduler._temp?scheduler._temp.data||scheduler._temp.d||scheduler._temp:[]),data.dhx_security&&(dhtmlx.security_key=data.dhx_security);var collections=scheduler._temp&&scheduler._temp.collections?scheduler._temp.collections:{},collections_loaded=!1;
for(var key in collections)if(collections.hasOwnProperty(key)){collections_loaded=!0;var collection=collections[key],arr=scheduler.serverList[key];if(!arr)continue;arr.splice(0,arr.length);for(var j=0;j<collection.length;j++){var option=collection[j],obj={key:option.value,label:option.label};for(var option_key in option)if(option.hasOwnProperty(option_key)){if("value"==option_key||"label"==option_key)continue;obj[option_key]=option[option_key]}arr.push(obj)}}collections_loaded&&scheduler.callEvent("onOptionsLoad",[]);
for(var evs=[],i=0;i<data.length;i++){var event=data[i];scheduler._init_event(event),evs.push(event)}return evs},scheduler.parse=function(e,t){this._process=t,this.on_load({xmlDoc:{responseText:e}})},scheduler.load=function(e,t){"string"==typeof t&&(this._process=t,t=arguments[2]),this._load_url=e,this._after_call=t,this._load(e,this._date)},scheduler.setLoadMode=function(e){"all"==e&&(e=""),this._load_mode=e},scheduler.serverList=function(e,t){return t?(this.serverList[e]=t.slice(0),this.serverList[e]):(this.serverList[e]=this.serverList[e]||[],
this.serverList[e])},scheduler._userdata={},scheduler._magic_parser=function(e){var t;if(!e.getXMLTopNode){var i=e.xmlDoc.responseText;e=new dtmlXMLLoaderObject(function(){}),e.loadXMLString(i)}if(t=e.getXMLTopNode("data"),"data"!=t.tagName)return null;var s=t.getAttribute("dhx_security");s&&(dhtmlx.security_key=s);for(var r=e.doXPath("//coll_options"),a=0;a<r.length;a++){var n=r[a].getAttribute("for"),d=this.serverList[n];if(d){d.splice(0,d.length);for(var o=e.doXPath(".//item",r[a]),l=0;l<o.length;l++){
for(var _=o[l],h=_.attributes,c={key:o[l].getAttribute("value"),label:o[l].getAttribute("label")},u=0;u<h.length;u++){var g=h[u];"value"!=g.nodeName&&"label"!=g.nodeName&&(c[g.nodeName]=g.nodeValue)}d.push(c)}}}r.length&&scheduler.callEvent("onOptionsLoad",[]);for(var f=e.doXPath("//userdata"),a=0;a<f.length;a++){var v=this._xmlNodeToJSON(f[a]);this._userdata[v.name]=v.text}var m=[];t=e.doXPath("//event");for(var a=0;a<t.length;a++){var p=m[a]=this._xmlNodeToJSON(t[a]);scheduler._init_event(p)}return m;
},scheduler._xmlNodeToJSON=function(e){for(var t={},i=0;i<e.attributes.length;i++)t[e.attributes[i].name]=e.attributes[i].value;for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];1==s.nodeType&&(t[s.tagName]=s.firstChild?s.firstChild.nodeValue:"")}return t.text||(t.text=e.firstChild?e.firstChild.nodeValue:""),t},scheduler.attachEvent("onXLS",function(){if(this.config.show_loading===!0){var e;e=this.config.show_loading=document.createElement("DIV"),e.className="dhx_loading",e.style.left=Math.round((this._x-128)/2)+"px",
e.style.top=Math.round((this._y-15)/2)+"px",this._obj.appendChild(e)}}),scheduler.attachEvent("onXLE",function(){var e=this.config.show_loading;e&&"object"==typeof e&&(this._obj.removeChild(e),this.config.show_loading=!0)}),scheduler.ical={parse:function(e){var t=e.match(RegExp(this.c_start+"[^\f]*"+this.c_end,""));if(t.length){t[0]=t[0].replace(/[\r\n]+(?=[a-z \t])/g," "),t[0]=t[0].replace(/\;[^:\r\n]*:/g,":");for(var i,s=[],r=RegExp("(?:"+this.e_start+")([^\f]*?)(?:"+this.e_end+")","g");null!==(i=r.exec(t));){
for(var a,n={},d=/[^\r\n]+[\r\n]+/g;null!==(a=d.exec(i[1]));)this.parse_param(a.toString(),n);n.uid&&!n.id&&(n.id=n.uid),s.push(n)}return s}},parse_param:function(e,t){var i=e.indexOf(":");if(-1!=i){var s=e.substr(0,i).toLowerCase(),r=e.substr(i+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");"summary"==s?s="text":"dtstart"==s?(s="start_date",r=this.parse_date(r,0,0)):"dtend"==s&&(s="end_date",r=this.parse_date(r,0,0)),t[s]=r}},parse_date:function(e,t,i){var s=e.split("T");s[1]&&(t=s[1].substr(0,2),
i=s[1].substr(2,2));var r=s[0].substr(0,4),a=parseInt(s[0].substr(4,2),10)-1,n=s[0].substr(6,2);return scheduler.config.server_utc&&!s[1]?new Date(Date.UTC(r,a,n,t,i)):new Date(r,a,n,t,i)},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",e_end:"END:VEVENT",c_end:"END:VCALENDAR"},scheduler._lightbox_controls={},scheduler.formSection=function(e){var t=this.config.lightbox.sections,i=0;for(i;i<t.length&&t[i].name!=e;i++);var s=t[i];scheduler._lightbox||scheduler.getLightbox();var r=document.getElementById(s.id),a=r.nextSibling,n={
section:s,header:r,node:a,getValue:function(e){return scheduler.form_blocks[s.type].get_value(a,e||{},s)},setValue:function(e,t){return scheduler.form_blocks[s.type].set_value(a,e,t||{},s)}},d=scheduler._lightbox_controls["get_"+s.type+"_control"];return d?d(n):n},scheduler._lightbox_controls.get_template_control=function(e){return e.control=e.node,e},scheduler._lightbox_controls.get_select_control=function(e){return e.control=e.node.getElementsByTagName("select")[0],e},scheduler._lightbox_controls.get_textarea_control=function(e){
return e.control=e.node.getElementsByTagName("textarea")[0],e},scheduler._lightbox_controls.get_time_control=function(e){return e.control=e.node.getElementsByTagName("select"),e},scheduler.form_blocks={template:{render:function(e){var t=(e.height||"30")+"px";return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+t+";'></div>"},set_value:function(e,t,i,s){e.innerHTML=t||""},get_value:function(e,t,i){return e.innerHTML||""},focus:function(e){}},textarea:{render:function(e){var t=(e.height||"130")+"px";
return"<div class='dhx_cal_ltext' style='height:"+t+";'><textarea></textarea></div>"},set_value:function(e,t,i){scheduler.form_blocks.textarea._get_input(e).value=t||""},get_value:function(e,t){return scheduler.form_blocks.textarea._get_input(e).value},focus:function(e){var t=scheduler.form_blocks.textarea._get_input(e);scheduler._focus(t,!0)},_get_input:function(e){return e.getElementsByTagName("textarea")[0]}},select:{render:function(e){for(var t=(e.height||"23")+"px",i="<div class='dhx_cal_ltext' style='height:"+t+";'><select style='width:100%;'>",s=0;s<e.options.length;s++)i+="<option value='"+e.options[s].key+"'>"+e.options[s].label+"</option>";
return i+="</select></div>"},set_value:function(e,t,i,s){var r=e.firstChild;!r._dhx_onchange&&s.onchange&&(r.onchange=s.onchange,r._dhx_onchange=!0),"undefined"==typeof t&&(t=(r.options[0]||{}).value),r.value=t||""},get_value:function(e,t){return e.firstChild.value},focus:function(e){var t=e.firstChild;scheduler._focus(t,!0)}},time:{render:function(e){e.time_format||(e.time_format=["%H:%i","%d","%m","%Y"]),e._time_format_order={};var t=e.time_format,i=scheduler.config,s=this.date.date_part(scheduler._currentDate()),r=1440,a=0;
scheduler.config.limit_time_select&&(r=60*i.last_hour+1,a=60*i.first_hour,s.setHours(i.first_hour));for(var n="",d=0;d<t.length;d++){var o=t[d];switch(d>0&&(n+=" "),o){case"%Y":e._time_format_order[3]=d,n+="<select>";for(var l=s.getFullYear()-5,_=0;10>_;_++)n+="<option value='"+(l+_)+"'>"+(l+_)+"</option>";n+="</select> ";break;case"%m":e._time_format_order[2]=d,n+="<select>";for(var _=0;12>_;_++)n+="<option value='"+_+"'>"+this.locale.date.month_full[_]+"</option>";n+="</select>";break;case"%d":
e._time_format_order[1]=d,n+="<select>";for(var _=1;32>_;_++)n+="<option value='"+_+"'>"+_+"</option>";n+="</select>";break;case"%H:%i":e._time_format_order[0]=d,n+="<select>";var _=a,h=s.getDate();for(e._time_values=[];r>_;){var c=this.templates.time_picker(s);n+="<option value='"+_+"'>"+c+"</option>",e._time_values.push(_),s.setTime(s.valueOf()+60*this.config.time_step*1e3);var u=s.getDate()!=h?1:0;_=24*u*60+60*s.getHours()+s.getMinutes()}n+="</select>"}}return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+n+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+n+"</div>";
},set_value:function(e,t,i,s){function r(e,t,i){for(var r=s._time_values,a=60*i.getHours()+i.getMinutes(),n=a,d=!1,o=0;o<r.length;o++){var _=r[o];if(_===a){d=!0;break}a>_&&(n=_)}e[t+l[0]].value=d?a:n,d||n||(e[t+l[0]].selectedIndex=-1),e[t+l[1]].value=i.getDate(),e[t+l[2]].value=i.getMonth(),e[t+l[3]].value=i.getFullYear()}var a,n,d=scheduler.config,o=e.getElementsByTagName("select"),l=s._time_format_order;if(d.full_day){if(!e._full_day){var _="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";
scheduler.config.wide_form||(_=e.previousSibling.innerHTML+_),e.previousSibling.innerHTML=_,e._full_day=!0}var h=e.previousSibling.getElementsByTagName("input")[0];h.checked=0===scheduler.date.time_part(i.start_date)&&0===scheduler.date.time_part(i.end_date),o[l[0]].disabled=h.checked,o[l[0]+o.length/2].disabled=h.checked,h.onclick=function(){if(h.checked){var t={};scheduler.form_blocks.time.get_value(e,t,s),a=scheduler.date.date_part(t.start_date),n=scheduler.date.date_part(t.end_date),(+n==+a||+n>=+a&&(0!==i.end_date.getHours()||0!==i.end_date.getMinutes()))&&(n=scheduler.date.add(n,1,"day"));
}else a=null,n=null;o[l[0]].disabled=h.checked,o[l[0]+o.length/2].disabled=h.checked,r(o,0,a||i.start_date),r(o,4,n||i.end_date)}}if(d.auto_end_date&&d.event_duration)for(var c=function(){a=new Date(o[l[3]].value,o[l[2]].value,o[l[1]].value,0,o[l[0]].value),n=new Date(a.getTime()+60*scheduler.config.event_duration*1e3),r(o,4,n)},u=0;4>u;u++)o[u].onchange=c;r(o,0,i.start_date),r(o,4,i.end_date)},get_value:function(e,t,i){var s=e.getElementsByTagName("select"),r=i._time_format_order;if(t.start_date=new Date(s[r[3]].value,s[r[2]].value,s[r[1]].value,0,s[r[0]].value),
t.end_date=new Date(s[r[3]+4].value,s[r[2]+4].value,s[r[1]+4].value,0,s[r[0]+4].value),!s[r[3]].value||!s[r[3]+4].value){var a=this.getEvent(this._lightbox_id);a&&(t.start_date=a.start_date,t.end_date=a.end_date)}return t.end_date<=t.start_date&&(t.end_date=scheduler.date.add(t.start_date,scheduler.config.time_step,"minute")),{start_date:new Date(t.start_date),end_date:new Date(t.end_date)}},focus:function(e){scheduler._focus(e.getElementsByTagName("select")[0])}}},scheduler.showCover=function(e){
if(e){e.style.display="block";var t=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,i=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,s=window.innerHeight||document.documentElement.clientHeight;t?e.style.top=Math.round(t+Math.max((s-e.offsetHeight)/2,0))+"px":e.style.top=Math.round(Math.max((s-e.offsetHeight)/2,0)+9)+"px",document.documentElement.scrollWidth>document.body.offsetWidth?e.style.left=Math.round(i+(document.body.offsetWidth-e.offsetWidth)/2)+"px":e.style.left=Math.round((document.body.offsetWidth-e.offsetWidth)/2)+"px";
}this.show_cover()},scheduler.showLightbox=function(e){if(e){if(!this.callEvent("onBeforeLightbox",[e]))return void(this._new_event&&(this._new_event=null));var t=this.getLightbox();this.showCover(t),this._fill_lightbox(e,t),this.callEvent("onLightbox",[e])}},scheduler._fill_lightbox=function(e,t){var i=this.getEvent(e),s=t.getElementsByTagName("span");scheduler.templates.lightbox_header?(s[1].innerHTML="",s[2].innerHTML=scheduler.templates.lightbox_header(i.start_date,i.end_date,i)):(s[1].innerHTML=this.templates.event_header(i.start_date,i.end_date,i),
s[2].innerHTML=(this.templates.event_bar_text(i.start_date,i.end_date,i)||"").substr(0,70));for(var r=this.config.lightbox.sections,a=0;a<r.length;a++){var n=r[a],d=document.getElementById(n.id).nextSibling,o=this.form_blocks[n.type],l=void 0!==i[n.map_to]?i[n.map_to]:n.default_value;o.set_value.call(this,d,l,i,n),r[a].focus&&o.focus.call(this,d)}scheduler._lightbox_id=e},scheduler._lightbox_out=function(e){for(var t=this.config.lightbox.sections,i=0;i<t.length;i++){var s=document.getElementById(t[i].id);
s=s?s.nextSibling:s;var r=this.form_blocks[t[i].type],a=r.get_value.call(this,s,e,t[i]);"auto"!=t[i].map_to&&(e[t[i].map_to]=a)}return e},scheduler._empty_lightbox=function(e){var t=scheduler._lightbox_id,i=this.getEvent(t);this.getLightbox();this._lame_copy(i,e),this.setEvent(i.id,i),this._edit_stop_event(i,!0),this.render_view_data()},scheduler.hide_lightbox=function(e){this.hideCover(this.getLightbox()),this._lightbox_id=null,this.callEvent("onAfterLightbox",[])},scheduler.hideCover=function(e){
e&&(e.style.display="none"),this.hide_cover()},scheduler.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},scheduler.show_cover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="dhx_cal_cover";var e=void 0!==document.height?document.height:document.body.offsetHeight,t=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(e,t)+"px",document.body.appendChild(this._cover);
}},scheduler.save_lightbox=function(){var e=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));(!this.checkEvent("onEventSave")||this.callEvent("onEventSave",[this._lightbox_id,e,this._new_event]))&&(this._empty_lightbox(e),this.hide_lightbox())},scheduler.startLightbox=function(e,t){this._lightbox_id=e,this._custom_lightbox=!0,this._temp_lightbox=this._lightbox,this._lightbox=t,this.showCover(t)},scheduler.endLightbox=function(e,t){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),e),
e&&scheduler.render_view_data(),this.hideCover(t),this._custom_lightbox&&(this._lightbox=this._temp_lightbox,this._custom_lightbox=!1),this._temp_lightbox=this._lightbox_id=null},scheduler.resetLightbox=function(){scheduler._lightbox&&!scheduler._custom_lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox),scheduler._lightbox=null},scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]),this.endLightbox(!1),this.hide_lightbox()},
scheduler._init_lightbox_events=function(){this.getLightbox().onclick=function(e){var t=e?e.target:event.srcElement;t.className||(t=t.previousSibling);var i=scheduler._getClassName(t);if(t&&i)switch(i){case"dhx_save_btn":scheduler.save_lightbox();break;case"dhx_delete_btn":var s=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(s,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(scheduler._lightbox_id),scheduler._new_event=null,scheduler.hide_lightbox();
});break;case"dhx_cancel_btn":scheduler.cancel_lightbox();break;default:if(t.getAttribute("dhx_button"))scheduler.callEvent("onLightboxButton",[i,t,e]);else{var r,a,n;-1!=i.indexOf("dhx_custom_button")&&(-1!=i.indexOf("dhx_custom_button_")?(r=t.parentNode.getAttribute("index"),n=t.parentNode.parentNode):(r=t.getAttribute("index"),n=t.parentNode,t=t.firstChild)),r&&(a=scheduler.form_blocks[scheduler.config.lightbox.sections[r].type],a.button_click(r,t,n,n.nextSibling))}}},this.getLightbox().onkeydown=function(e){
switch((e||event).keyCode){case scheduler.keys.edit_save:if((e||event).shiftKey)return;scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox()}}},scheduler.setLightboxSize=function(){var e=this._lightbox;if(e){var t=e.childNodes[1];t.style.height="0px",t.style.height=t.scrollHeight+"px",e.style.height=t.scrollHeight+scheduler.xy.lightbox_additional_height+"px",t.style.height=t.scrollHeight+"px"}},scheduler._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",scheduler._move_while_dnd),
dhtmlxEvent(document.body,"mouseup",scheduler._finish_dnd),scheduler._init_dnd_events=function(){}},scheduler._move_while_dnd=function(e){if(scheduler._dnd_start_lb){document.dhx_unselectable||(document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0);var t=scheduler.getLightbox(),i=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY];t.style.top=scheduler._lb_start[1]+i[1]-scheduler._dnd_start_lb[1]+"px",t.style.left=scheduler._lb_start[0]+i[0]-scheduler._dnd_start_lb[0]+"px";
}},scheduler._ready_to_dnd=function(e){var t=scheduler.getLightbox();scheduler._lb_start=[parseInt(t.style.left,10),parseInt(t.style.top,10)],scheduler._dnd_start_lb=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY]},scheduler._finish_dnd=function(){scheduler._lb_start&&(scheduler._lb_start=scheduler._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1)},scheduler.getLightbox=function(){if(!this._lightbox){var e=document.createElement("DIV");
e.className="dhx_cal_light",scheduler.config.wide_form&&(e.className+=" dhx_cal_light_wide"),scheduler.form_blocks.recurring&&(e.className+=" dhx_cal_light_rec"),/msie|MSIE 6/.test(navigator.userAgent)&&(e.className+=" dhx_ie6"),e.style.visibility="hidden";for(var t=this._lightbox_template,i=this.config.buttons_left,s=0;s<i.length;s++)t+="<div class='dhx_btn_set dhx_left_btn_set "+i[s]+"_set'><div dhx_button='1' class='"+i[s]+"'></div><div>"+scheduler.locale.labels[i[s]]+"</div></div>";i=this.config.buttons_right;
for(var s=0;s<i.length;s++)t+="<div class='dhx_btn_set dhx_right_btn_set "+i[s]+"_set' style='float:right;'><div dhx_button='1' class='"+i[s]+"'></div><div>"+scheduler.locale.labels[i[s]]+"</div></div>";t+="</div>",e.innerHTML=t,scheduler.config.drag_lightbox&&(e.firstChild.onmousedown=scheduler._ready_to_dnd,e.firstChild.onselectstart=function(){return!1},e.firstChild.style.cursor="pointer",scheduler._init_dnd_events()),document.body.insertBefore(e,document.body.firstChild),this._lightbox=e;var r=this.config.lightbox.sections;
t="";for(var s=0;s<r.length;s++){var a=this.form_blocks[r[s].type];if(a){r[s].id="area_"+this.uid();var n="";r[s].button&&(n="<div class='dhx_custom_button' index='"+s+"'><div class='dhx_custom_button_"+r[s].button+"'></div><div>"+this.locale.labels["button_"+r[s].button]+"</div></div>"),this.config.wide_form&&(t+="<div class='dhx_wrap_section'>");var d=this.locale.labels["section_"+r[s].name];"string"!=typeof d&&(d=r[s].name),t+="<div id='"+r[s].id+"' class='dhx_cal_lsection'>"+n+d+"</div>"+a.render.call(this,r[s]),
t+="</div>"}}for(var o=e.getElementsByTagName("div"),s=0;s<o.length;s++){var l=o[s],_=scheduler._getClassName(l);if("dhx_cal_larea"==_){l.innerHTML=t;break}}this.setLightboxSize(),this._init_lightbox_events(this),e.style.display="none",e.style.visibility="visible"}return this._lightbox},scheduler.attachEvent("onEventIdChange",function(e,t){this._lightbox_id==e&&(this._lightbox_id=t)}),scheduler._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>",
scheduler._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(this.xy.scroll_width=0,window.navigator.msPointerEnabled?(this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(e){return e.pointerType==e.MSPOINTER_TYPE_MOUSE?null:e},function(e){return!e||e.pointerType==e.MSPOINTER_TYPE_MOUSE||scheduler._pointerDragId&&scheduler._pointerDragId!=e.pointerId;
}),this._obj.ondblclick=function(){}):this._touch_events(["touchmove","touchstart","touchend"],function(e){return e.touches&&e.touches.length>1?null:e.touches[0]?{target:e.target,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY}:e},function(e){return!!(e.touches&&e.touches.length>1)}))},scheduler._touch_events=function(e,t,i){function s(e,t,i){dhtmlxEvent(e,t,function(e){return scheduler._is_lightbox_open()?!0:i(e)})}function r(e,t,i,s){if(e&&t){for(var r=e.target;r&&r!=scheduler._obj;)r=r.parentNode;
if(r==scheduler._obj){var a=Math.abs(e.pageY-t.pageY),n=Math.abs(e.pageX-t.pageX);s>a&&n>i&&(!a||n/a>3)&&(e.pageX>t.pageX?scheduler._click.dhx_cal_next_button():scheduler._click.dhx_cal_prev_button())}}}function a(e){var t=scheduler.getState().drag_mode,i=scheduler.matrix?scheduler.matrix[scheduler._mode]:!1,s=scheduler.render_view_data;"create"==t&&i&&(scheduler.render_view_data=function(){for(var e=scheduler.getState().drag_id,t=scheduler.getEvent(e),s=i.y_property,r=scheduler.getEvents(t.start_date,t.end_date),a=0;a<r.length;a++)r[a][s]!=t[s]&&(r.splice(a,1),
a--);t._sorder=r.length-1,t._count=r.length,this.render_data([t],scheduler.getState().mode)}),scheduler._on_mouse_move(e),"create"==t&&i&&(scheduler.render_view_data=s)}function n(e){scheduler._hide_global_tip(),_&&(scheduler._on_mouse_up(t(e||event)),scheduler._temp_touch_block=!1),scheduler._drag_id=null,scheduler._drag_mode=null,scheduler._drag_pos=null,scheduler._pointerDragId=null,clearTimeout(l),_=c=!1,h=!0}var d,o,l,_,h,c,u=(-1!=navigator.userAgent.indexOf("Android")&&-1!=navigator.userAgent.indexOf("WebKit"),
0);s(document.body,e[0],function(e){if(!i(e)){var s=t(e);if(s){if(_)return a(s),scheduler._update_global_tip(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;if(o=t(e),c)return o?void((d.target!=o.target||Math.abs(d.pageX-o.pageX)>5||Math.abs(d.pageY-o.pageY)>5)&&(h=!0,clearTimeout(l))):void(h=!0)}}}),s(this._els.dhx_cal_data[0],"scroll",n),s(this._els.dhx_cal_data[0],"touchcancel",n),s(this._els.dhx_cal_data[0],"contextmenu",function(e){return c?(e&&e.preventDefault&&e.preventDefault(),
(e||event).cancelBubble=!0,!1):void 0}),s(this._obj,e[1],function(e){if(!i(e)){scheduler._pointerDragId=e.pointerId;var s;if(_=h=!1,c=!0,scheduler._temp_touch_block=!0,s=o=t(e),!s)return void(h=!0);var r=new Date;if(!h&&!_&&250>r-u)return scheduler._click.dhx_cal_data(s),window.setTimeout(function(){s.type="dblclick",scheduler._on_dbl_click(s)},50),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._block_next_stop=!0,!1;if(u=r,!h&&!_&&scheduler.config.touch_drag){var a=scheduler._locate_event(document.activeElement),n=scheduler._locate_event(s.target),g=d?scheduler._locate_event(d.target):null;
if(a&&n&&a==n&&a!=g)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._ignore_next_click=!1,scheduler._click.dhx_cal_data(s),d=s,!1;l=setTimeout(function(){_=!0;var e=d.target,t=scheduler._getClassName(e);e&&-1!=t.indexOf("dhx_body")&&(e=e.previousSibling),scheduler._on_mouse_down(d,e),scheduler._drag_mode&&"create"!=scheduler._drag_mode&&scheduler.for_rendered(scheduler._drag_id,function(e,t){e.style.display="none",scheduler._rendered.splice(t,1)}),scheduler.config.touch_tip&&scheduler._show_global_tip(),
scheduler.updateEvent(scheduler._drag_id)},scheduler.config.touch_drag),d=s}}}),s(this._els.dhx_cal_data[0],e[2],function(e){return i(e)?void 0:(_||r(d,o,200,100),_&&(scheduler._ignore_next_click=!0),n(e),scheduler._block_next_stop?(scheduler._block_next_stop=!1,e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):void 0)}),dhtmlxEvent(document.body,e[2],n)},scheduler._show_global_tip=function(){scheduler._hide_global_tip();var e=scheduler._global_tip=document.createElement("DIV");e.className="dhx_global_tip",
scheduler._update_global_tip(1),document.body.appendChild(e)},scheduler._update_global_tip=function(e){var t=scheduler._global_tip;if(t){var i="";if(scheduler._drag_id&&!e){var s=scheduler.getEvent(scheduler._drag_id);s&&(i="<div>"+(s._timed?scheduler.templates.event_header(s.start_date,s.end_date,s):scheduler.templates.day_date(s.start_date,s.end_date,s))+"</div>")}"create"==scheduler._drag_mode||"new-size"==scheduler._drag_mode?t.innerHTML=(scheduler.locale.labels.drag_to_create||"Drag to create")+i:t.innerHTML=(scheduler.locale.labels.drag_to_move||"Drag to move")+i;
}},scheduler._hide_global_tip=function(){var e=scheduler._global_tip;e&&e.parentNode&&(e.parentNode.removeChild(e),scheduler._global_tip=0)},scheduler._dp_init=function(e){e._methods=["_set_event_text_style","","_dp_change_event_id","_dp_hook_delete"],this._dp_change_event_id=function(e,t){scheduler.getEvent(e)&&scheduler.changeEventId(e,t)},this._dp_hook_delete=function(t,i){return scheduler.getEvent(t)?(t!=i&&("true_deleted"==this.getUserData(t,e.action_param)&&this.setUserData(t,e.action_param,"updated"),
this.changeEventId(t,i)),this.deleteEvent(i,!0)):void 0},this.attachEvent("onEventAdded",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"inserted")}),this.attachEvent("onConfirmedBeforeEventDelete",function(t){if(this._validId(t)){var i=e.getState(t);return"inserted"==i||this._new_event?(e.setUpdated(t,!1),!0):"deleted"==i?!1:"true_deleted"==i?!0:(e.setUpdated(t,!0,"deleted"),!1)}}),this.attachEvent("onEventChanged",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"updated");
}),scheduler.attachEvent("onClearAll",function(){e._in_progress={},e._invalid={},e.updatedRows=[],e._waitMode=0}),e._objToJson=function(t,i,s){s=s||"",i=i||{};for(var r in t)0!==r.indexOf("_")&&(t[r]&&t[r].getUTCFullYear?i[s+r]=this.obj.templates.xml_format(t[r]):t[r]&&"object"==typeof t[r]?e._objToJson(t[r],i,s+r+"."):i[s+r]=t[r]);return i},e._getRowData=function(e,t){var i=this.obj.getEvent(e);return this._objToJson(i)},e._clearUpdateFlag=function(){},e.attachEvent("insertCallback",scheduler._update_callback),
e.attachEvent("updateCallback",scheduler._update_callback),e.attachEvent("deleteCallback",function(e,t){this.obj.getEvent(t)?(this.obj.setUserData(t,this.action_param,"true_deleted"),this.obj.deleteEvent(t)):this.obj._add_rec_marker&&this.obj._update_callback(e,t)})},scheduler._validId=function(e){return!0},scheduler.setUserData=function(e,t,i){if(e){var s=this.getEvent(e);s&&(s[t]=i)}else this._userdata[t]=i},scheduler.getUserData=function(e,t){if(e){var i=this.getEvent(e);return i?i[t]:null}return this._userdata[t];
},scheduler._set_event_text_style=function(e,t){if(scheduler.getEvent(e)){this.for_rendered(e,function(e){e.style.cssText+=";"+t});var i=this.getEvent(e);i._text_style=t,this.event_updated(i)}},scheduler._update_callback=function(e,t){var i=scheduler._xmlNodeToJSON(e.firstChild);"none"==i.rec_type&&(i.rec_pattern="none"),i.text=i.text||i._tagvalue,i.start_date=scheduler.templates.xml_date(i.start_date),i.end_date=scheduler.templates.xml_date(i.end_date),scheduler.addEvent(i),scheduler._add_rec_marker&&scheduler.setCurrentView();
},scheduler._skin_settings={fix_tab_position:[1,0],use_select_menu_space:[1,0],wide_form:[1,0],hour_size_px:[44,42],displayed_event_color:["#ff4a4a","ffc5ab"],displayed_event_text_color:["#ffef80","7e2727"]},scheduler._skin_xy={lightbox_additional_height:[90,50],nav_height:[59,22],bar_height:[24,20]},scheduler._configure=function(e,t,i){for(var s in t)"undefined"==typeof e[s]&&(e[s]=t[s][i])},scheduler._skin_init=function(){if(!scheduler.skin)for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){
var i=e[t].href.match("dhtmlxscheduler_([a-z]+).css");if(i){scheduler.skin=i[1];break}}var s=0;if(!scheduler.skin||"classic"!==scheduler.skin&&"glossy"!==scheduler.skin||(s=1),this._configure(scheduler.config,scheduler._skin_settings,s),this._configure(scheduler.xy,scheduler._skin_xy,s),"flat"===scheduler.skin&&(scheduler.xy.scale_height=35,scheduler.templates.hour_scale=function(e){var t=e.getMinutes();t=10>t?"0"+t:t;var i="<span class='dhx_scale_h'>"+e.getHours()+"</span><span class='dhx_scale_m'>&nbsp;"+t+"</span>";
return i}),!s){var r=scheduler.config.minicalendar;r&&(r.padding=14),scheduler.templates.event_bar_date=function(e,t,i){return"• <b>"+scheduler.templates.event_date(e)+"</b> "},scheduler.attachEvent("onTemplatesReady",function(){var e=scheduler.date.date_to_str("%d");scheduler.templates._old_month_day||(scheduler.templates._old_month_day=scheduler.templates.month_day);var t=scheduler.templates._old_month_day;if(scheduler.templates.month_day=function(i){if("month"==this._mode){var s=e(i);return 1==i.getDate()&&(s=scheduler.locale.date.month_full[i.getMonth()]+" "+s),
+i==+scheduler.date.date_part(new Date)&&(s=scheduler.locale.labels.dhx_cal_today_button+" "+s),s}return t.call(this,i)},scheduler.config.fix_tab_position){for(var i=scheduler._els.dhx_cal_navline[0].getElementsByTagName("div"),s=null,r=211,a=0;a<i.length;a++){var n=i[a],d=n.getAttribute("name");if(d)switch(n.style.right="auto",d){case"day_tab":n.style.left="14px",n.className+=" dhx_cal_tab_first";break;case"week_tab":n.style.left="75px";break;case"month_tab":n.style.left="136px",n.className+=" dhx_cal_tab_last";
break;default:n.style.left=r+"px",n.className+=" dhx_cal_tab_standalone",r=r+14+n.offsetWidth}else 0===(n.className||"").indexOf("dhx_minical_icon")&&n.parentNode==scheduler._els.dhx_cal_navline[0]&&(s=n)}s&&(s.style.left=r+"px")}}),scheduler._skin_init=function(){}}},window.jQuery&&!function(e){var t=[];e.fn.dhx_scheduler=function(i){if("string"!=typeof i){var s=[];return this.each(function(){if(this&&this.getAttribute&&!this.getAttribute("dhxscheduler")){for(var e in i)"data"!=e&&(scheduler.config[e]=i[e]);
this.getElementsByTagName("div").length||(this.innerHTML='<div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div><div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div></div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div>',
this.className+=" dhx_cal_container"),scheduler.init(this,scheduler.config.date,scheduler.config.mode),i.data&&scheduler.parse(i.data),s.push(scheduler)}}),1===s.length?s[0]:s}return t[i]?t[i].apply(this,[]):void e.error("Method "+i+" does not exist on jQuery.dhx_scheduler")}}(jQuery),function(){function e(e,t,i){t&&(e._date=t),i&&(e._mode=i)}var t=scheduler.setCurrentView,i=scheduler.updateView,s=null,r=null,a=function(t,a){var n=this;window.clearTimeout(r),window.clearTimeout(s),e(this,t,a),r=setTimeout(function(){
n.callEvent("onBeforeViewChange",[n._mode,n._date,a||n._mode,t||n._date])&&(i.call(n,t,a),n.callEvent("onViewChange",[n._mode,n._date]),window.clearTimeout(s),r=0)},scheduler.config.delay_render)},n=function(t,a){var n=this,d=arguments;e(this,t,a),window.clearTimeout(s),s=setTimeout(function(){r||i.apply(n,d)},scheduler.config.delay_render)};scheduler.attachEvent("onSchedulerReady",function(){scheduler.config.delay_render?(scheduler.setCurrentView=a,scheduler.updateView=n):(scheduler.setCurrentView=t,
scheduler.updateView=i)})}();
scheduler.config.limit_start=null,scheduler.config.limit_end=null,scheduler.config.limit_view=!1,scheduler.config.check_limits=!0,scheduler.config.mark_now=!0,scheduler.config.display_marked_timespans=!0,scheduler._temp_limit_scope=function(){function e(e,t,a,r,s){var i=scheduler,n=[],d={_props:"map_to",matrix:"y_property"};for(var l in d){var o=d[l];if(i[l])for(var _ in i[l]){var h=i[l][_],c=h[o];e[c]&&(n=i._add_timespan_zones(n,scheduler._get_blocked_zones(t[_],e[c],a,r,s)))}}return n=i._add_timespan_zones(n,scheduler._get_blocked_zones(t,"global",a,r,s));
}var t=null,a="dhx_time_block",r="default",s=function(e,t,a){return t instanceof Date&&a instanceof Date?(e.start_date=t,e.end_date=a):(e.days=t,e.zones=a),e},i=function(e,t,r){var i="object"==typeof e?e:{days:e};return i.type=a,i.css="",t&&(r&&(i.sections=r),i=s(i,e,t)),i};scheduler.blockTime=function(e,t,a){var r=i(e,t,a);return scheduler.addMarkedTimespan(r)},scheduler.unblockTime=function(e,t,a){t=t||"fullday";var r=i(e,t,a);return scheduler.deleteMarkedTimespan(r)},scheduler.attachEvent("onBeforeViewChange",function(e,t,a,r){
function s(e,t){var a=scheduler.config.limit_start,r=scheduler.config.limit_end,s=scheduler.date.add(e,1,t);return e.valueOf()>r.valueOf()||s<=a.valueOf()}return scheduler.config.limit_view&&(r=r||t,a=a||e,s(r,a)&&t.valueOf()!=r.valueOf())?(setTimeout(function(){var e=s(t,a)?scheduler.config.limit_start:t;scheduler.setCurrentView(s(e,a)?null:e,a)},1),!1):!0}),scheduler.checkInMarkedTimespan=function(t,a,s){a=a||r;for(var i=!0,n=new Date(t.start_date.valueOf()),d=scheduler.date.add(n,1,"day"),l=scheduler._marked_timespans;n<t.end_date;n=scheduler.date.date_part(d),
d=scheduler.date.add(n,1,"day")){var o=+scheduler.date.date_part(new Date(n)),_=n.getDay(),h=e(t,l,_,o,a);if(h)for(var c=0;c<h.length;c+=2){var u=scheduler._get_zone_minutes(n),v=t.end_date>d||t.end_date.getDate()!=n.getDate()?1440:scheduler._get_zone_minutes(t.end_date),g=h[c],p=h[c+1];if(v>g&&p>u&&(i="function"==typeof s?s(t,u,v,g,p):!1,!i))break}}return!i};var n=scheduler.checkLimitViolation=function(e){if(!e)return!0;if(!scheduler.config.check_limits)return!0;var t=scheduler,r=t.config,s=[];if(e.rec_type)for(var i=scheduler.getRecDates(e),n=0;n<i.length;n++){
var d=scheduler._copy_event(e);scheduler._lame_copy(d,i[n]),s.push(d)}else s=[e];for(var l=!0,o=0;o<s.length;o++){var _=!0,d=s[o];d._timed=scheduler.isOneDayEvent(d),_=r.limit_start&&r.limit_end?d.start_date.valueOf()>=r.limit_start.valueOf()&&d.end_date.valueOf()<=r.limit_end.valueOf():!0,_&&(_=!scheduler.checkInMarkedTimespan(d,a,function(e,a,r,s,i){var n=!0;return i>=a&&a>=s&&((1440==i||i>r)&&(n=!1),e._timed&&t._drag_id&&"new-size"==t._drag_mode?(e.start_date.setHours(0),e.start_date.setMinutes(i)):n=!1),
(r>=s&&i>r||s>a&&r>i)&&(e._timed&&t._drag_id&&"new-size"==t._drag_mode?(e.end_date.setHours(0),e.end_date.setMinutes(s)):n=!1),n})),_||(_=t.checkEvent("onLimitViolation")?t.callEvent("onLimitViolation",[d.id,d]):_),l=l&&_}return l||(t._drag_id=null,t._drag_mode=null),l};scheduler._get_blocked_zones=function(e,t,a,r,s){var i=[];if(e&&e[t])for(var n=e[t],d=this._get_relevant_blocked_zones(a,r,n,s),l=0;l<d.length;l++)i=this._add_timespan_zones(i,d[l].zones);return i},scheduler._get_relevant_blocked_zones=function(e,t,a,r){
var s=a[t]&&a[t][r]?a[t][r]:a[e]&&a[e][r]?a[e][r]:[];return s},scheduler.attachEvent("onMouseDown",function(e){return!(e==a)}),scheduler.attachEvent("onBeforeDrag",function(e){return e?n(scheduler.getEvent(e)):!0}),scheduler.attachEvent("onClick",function(e,t){return n(scheduler.getEvent(e))}),scheduler.attachEvent("onBeforeLightbox",function(e){var a=scheduler.getEvent(e);return t=[a.start_date,a.end_date],n(a)}),scheduler.attachEvent("onEventSave",function(e,t,a){if(!t.start_date||!t.end_date){
var r=scheduler.getEvent(e);t.start_date=new Date(r.start_date),t.end_date=new Date(r.end_date)}if(t.rec_type){var s=scheduler._lame_clone(t);return scheduler._roll_back_dates(s),n(s)}return n(t)}),scheduler.attachEvent("onEventAdded",function(e){if(!e)return!0;var t=scheduler.getEvent(e);return!n(t)&&scheduler.config.limit_start&&scheduler.config.limit_end&&(t.start_date<scheduler.config.limit_start&&(t.start_date=new Date(scheduler.config.limit_start)),t.start_date.valueOf()>=scheduler.config.limit_end.valueOf()&&(t.start_date=this.date.add(scheduler.config.limit_end,-1,"day")),
t.end_date<scheduler.config.limit_start&&(t.end_date=new Date(scheduler.config.limit_start)),t.end_date.valueOf()>=scheduler.config.limit_end.valueOf()&&(t.end_date=this.date.add(scheduler.config.limit_end,-1,"day")),t.start_date.valueOf()>=t.end_date.valueOf()&&(t.end_date=this.date.add(t.start_date,this.config.event_duration||this.config.time_step,"minute")),t._timed=this.isOneDayEvent(t)),!0}),scheduler.attachEvent("onEventChanged",function(e){if(!e)return!0;var a=scheduler.getEvent(e);if(!n(a)){
if(!t)return!1;a.start_date=t[0],a.end_date=t[1],a._timed=this.isOneDayEvent(a)}return!0}),scheduler.attachEvent("onBeforeEventChanged",function(e,t,a){return n(e)}),scheduler.attachEvent("onBeforeEventCreated",function(e){var t=scheduler.getActionData(e).date,a={_timed:!0,start_date:t,end_date:scheduler.date.add(t,scheduler.config.time_step,"minute")};return n(a)}),scheduler.attachEvent("onViewChange",function(){scheduler._mark_now()}),scheduler.attachEvent("onSchedulerResize",function(){return window.setTimeout(function(){
scheduler._mark_now()},1),!0}),scheduler.attachEvent("onTemplatesReady",function(){scheduler._mark_now_timer=window.setInterval(function(){scheduler._is_initialized()&&scheduler._mark_now()},6e4)}),scheduler._mark_now=function(e){var t="dhx_now_time";this._els[t]||(this._els[t]=[]);var a=scheduler._currentDate(),r=this.config;if(scheduler._remove_mark_now(),!e&&r.mark_now&&a<this._max_date&&a>this._min_date&&a.getHours()>=r.first_hour&&a.getHours()<r.last_hour){var s=this.locate_holder_day(a);this._els[t]=scheduler._append_mark_now(s,a);
}},scheduler._append_mark_now=function(e,t){var a="dhx_now_time",r=scheduler._get_zone_minutes(t),s={zones:[r,r+1],css:a,type:a};if(!this._table_view){if(this._props&&this._props[this._mode]){var i,n,d=this._props[this._mode],l=d.size||d.options.length;d.days>1?(i=e,n=e+l):(i=0,n=i+l);for(var o=[],_=i;n>_;_++){var h=_;s.days=h;var c=scheduler._render_marked_timespan(s,null,h)[0];o.push(c)}return o}return s.days=e,scheduler._render_marked_timespan(s,null,e)}return"month"==this._mode?(s.days=+scheduler.date.date_part(t),
scheduler._render_marked_timespan(s,null,null)):void 0},scheduler._remove_mark_now=function(){for(var e="dhx_now_time",t=this._els[e],a=0;a<t.length;a++){var r=t[a],s=r.parentNode;s&&s.removeChild(r)}this._els[e]=[]},scheduler._marked_timespans={global:{}},scheduler._get_zone_minutes=function(e){return 60*e.getHours()+e.getMinutes()},scheduler._prepare_timespan_options=function(e){var t=[],a=[];if("fullweek"==e.days&&(e.days=[0,1,2,3,4,5,6]),e.days instanceof Array){for(var s=e.days.slice(),i=0;i<s.length;i++){
var n=scheduler._lame_clone(e);n.days=s[i],t.push.apply(t,scheduler._prepare_timespan_options(n))}return t}if(!e||!(e.start_date&&e.end_date&&e.end_date>e.start_date||void 0!==e.days&&e.zones))return t;var d=0,l=1440;"fullday"==e.zones&&(e.zones=[d,l]),e.zones&&e.invert_zones&&(e.zones=scheduler.invertZones(e.zones)),e.id=scheduler.uid(),e.css=e.css||"",e.type=e.type||r;var o=e.sections;if(o){for(var _ in o)if(o.hasOwnProperty(_)){var h=o[_];h instanceof Array||(h=[h]);for(var i=0;i<h.length;i++){
var c=scheduler._lame_copy({},e);c.sections={},c.sections[_]=h[i],a.push(c)}}}else a.push(e);for(var u=0;u<a.length;u++){var v=a[u],g=v.start_date,p=v.end_date;if(g&&p)for(var f=scheduler.date.date_part(new Date(g)),m=scheduler.date.add(f,1,"day");p>f;){var c=scheduler._lame_copy({},v);delete c.start_date,delete c.end_date,c.days=f.valueOf();var y=g>f?scheduler._get_zone_minutes(g):d,x=p>m||p.getDate()!=f.getDate()?l:scheduler._get_zone_minutes(p);c.zones=[y,x],t.push(c),f=m,m=scheduler.date.add(m,1,"day");
}else v.days instanceof Date&&(v.days=scheduler.date.date_part(v.days).valueOf()),v.zones=e.zones.slice(),t.push(v)}return t},scheduler._get_dates_by_index=function(e,t,a){var r=[];t=scheduler.date.date_part(new Date(t||scheduler._min_date)),a=new Date(a||scheduler._max_date);for(var s=t.getDay(),i=e-s>=0?e-s:7-t.getDay()+e,n=scheduler.date.add(t,i,"day");a>n;n=scheduler.date.add(n,1,"week"))r.push(n);return r},scheduler._get_css_classes_by_config=function(e){var t=[];return e.type==a&&(t.push(a),
e.css&&t.push(a+"_reset")),t.push("dhx_marked_timespan",e.css),t.join(" ")},scheduler._get_block_by_config=function(e){var t=document.createElement("DIV");return e.html&&("string"==typeof e.html?t.innerHTML=e.html:t.appendChild(e.html)),t},scheduler._render_marked_timespan=function(e,t,a){var r=[],s=scheduler.config,i=this._min_date,n=this._max_date,d=!1;if(!s.display_marked_timespans)return r;if(!a&&0!==a){if(e.days<7)a=e.days;else{var l=new Date(e.days);if(d=+l,!(+n>+l&&+l>=+i))return r;a=l.getDay();
}var o=i.getDay();o>a?a=7-(o-a):a-=o}var _=e.zones,h=scheduler._get_css_classes_by_config(e);if(scheduler._table_view&&"month"==scheduler._mode){var c=[],u=[];if(t)c.push(t),u.push(a);else{u=d?[d]:scheduler._get_dates_by_index(a);for(var v=0;v<u.length;v++)c.push(this._scales[u[v]])}for(var v=0;v<c.length;v++){t=c[v],a=u[v];var g=Math.floor((this._correct_shift(a,1)-i.valueOf())/(864e5*this._cols.length)),p=this.locate_holder_day(a,!1)%this._cols.length;if(!this._ignores[p]){var f=scheduler._get_block_by_config(e),m=Math.max(t.offsetHeight-1,0),y=Math.max(t.offsetWidth-1,0),x=this._colsS[p],b=this._colsS.heights[g]+(this._colsS.height?this.xy.month_scale_height+2:2)-1;
f.className=h,f.style.top=b+"px",f.style.lineHeight=f.style.height=m+"px";for(var w=0;w<_.length;w+=2){var k=_[v],D=_[v+1];if(k>=D)return[];var E=f.cloneNode(!0);E.style.left=x+Math.round(k/1440*y)+"px",E.style.width=Math.round((D-k)/1440*y)+"px",t.appendChild(E),r.push(E)}}}}else{var M=a;if(this._ignores[this.locate_holder_day(a,!1)])return r;if(this._props&&this._props[this._mode]&&e.sections&&e.sections[this._mode]){var N=this._props[this._mode];M=N.order[e.sections[this._mode]];var O=N.order[e.sections[this._mode]];
if(N.days>1){var L=N.size||N.options.length;M=M*L+O}else M=O,N.size&&M>N.position+N.size&&(M=0)}t=t?t:scheduler.locate_holder(M);for(var v=0;v<_.length;v+=2){var k=Math.max(_[v],60*s.first_hour),D=Math.min(_[v+1],60*s.last_hour);if(k>=D){if(v+2<_.length)continue;return[]}var E=scheduler._get_block_by_config(e);E.className=h;var C=24*this.config.hour_size_px+1,T=36e5;E.style.top=Math.round((60*k*1e3-this.config.first_hour*T)*this.config.hour_size_px/T)%C+"px",E.style.lineHeight=E.style.height=Math.max(Math.round(60*(D-k)*1e3*this.config.hour_size_px/T)%C,1)+"px",
t.appendChild(E),r.push(E)}}return r},scheduler._mark_timespans=function(){for(var e=this._els.dhx_cal_data[0],t=[],a=new Date(scheduler._min_date),r=0,s=e.childNodes.length;s>r;r++){var i=e.childNodes[r];i.firstChild&&scheduler._getClassName(i.firstChild).indexOf("dhx_scale_hour")>-1||(t.push.apply(t,scheduler._on_scale_add_marker(i,a)),a=scheduler.date.add(a,1,"day"))}return t},scheduler.markTimespan=function(e){var t=!1;this._els.dhx_cal_data||(scheduler.get_elements(),t=!0);var a=scheduler._marked_timespans_ids,r=scheduler._marked_timespans_types,s=scheduler._marked_timespans;
scheduler.deleteMarkedTimespan(),scheduler.addMarkedTimespan(e);var i=scheduler._mark_timespans();return t&&(scheduler._els=[]),scheduler._marked_timespans_ids=a,scheduler._marked_timespans_types=r,scheduler._marked_timespans=s,i},scheduler.unmarkTimespan=function(e){if(e)for(var t=0;t<e.length;t++){var a=e[t];a.parentNode&&a.parentNode.removeChild(a)}},scheduler._marked_timespans_ids={},scheduler.addMarkedTimespan=function(e){var t=scheduler._prepare_timespan_options(e),a="global";if(t.length){var r=t[0].id,s=scheduler._marked_timespans,i=scheduler._marked_timespans_ids;
i[r]||(i[r]=[]);for(var n=0;n<t.length;n++){var d=t[n],l=d.days,o=(d.zones,d.css,d.sections),_=d.type;if(d.id=r,o){for(var h in o)if(o.hasOwnProperty(h)){s[h]||(s[h]={});var c=o[h],u=s[h];u[c]||(u[c]={}),u[c][l]||(u[c][l]={}),u[c][l][_]||(u[c][l][_]=[],scheduler._marked_timespans_types||(scheduler._marked_timespans_types={}),scheduler._marked_timespans_types[_]||(scheduler._marked_timespans_types[_]=!0));var v=u[c][l][_];d._array=v,v.push(d),i[r].push(d)}}else{s[a][l]||(s[a][l]={}),s[a][l][_]||(s[a][l][_]=[]),
scheduler._marked_timespans_types||(scheduler._marked_timespans_types={}),scheduler._marked_timespans_types[_]||(scheduler._marked_timespans_types[_]=!0);var v=s[a][l][_];d._array=v,v.push(d),i[r].push(d)}}return r}},scheduler._add_timespan_zones=function(e,t){var a=e.slice();if(t=t.slice(),!a.length)return t;for(var r=0;r<a.length;r+=2)for(var s=a[r],i=a[r+1],n=r+2==a.length,d=0;d<t.length;d+=2){var l=t[d],o=t[d+1];if(o>i&&i>=l||s>l&&o>=s)a[r]=Math.min(s,l),a[r+1]=Math.max(i,o),r-=2;else{if(!n)continue;
var _=s>l?0:2;a.splice(r+_,0,l,o)}t.splice(d--,2);break}return a},scheduler._subtract_timespan_zones=function(e,t){for(var a=e.slice(),r=0;r<a.length;r+=2)for(var s=a[r],i=a[r+1],n=0;n<t.length;n+=2){var d=t[n],l=t[n+1];if(l>s&&i>d){var o=!1;s>=d&&l>=i&&a.splice(r,2),d>s&&(a.splice(r,2,s,d),o=!0),i>l&&a.splice(o?r+2:r,o?0:2,l,i),r-=2;break}}return a},scheduler.invertZones=function(e){return scheduler._subtract_timespan_zones([0,1440],e.slice())},scheduler._delete_marked_timespan_by_id=function(e){
var t=scheduler._marked_timespans_ids[e];if(t)for(var a=0;a<t.length;a++)for(var r=t[a],s=r._array,i=0;i<s.length;i++)if(s[i]==r){s.splice(i,1);break}},scheduler._delete_marked_timespan_by_config=function(e){var t=scheduler._marked_timespans,a=e.sections,s=e.days,i=e.type||r,n=[];if(a){for(var d in a)if(a.hasOwnProperty(d)&&t[d]){var l=a[d];t[d][l]&&t[d][l][s]&&t[d][l][s][i]&&(n=t[d][l][s][i])}}else t.global[s]&&t.global[s][i]&&(n=t.global[s][i]);for(var o=0;o<n.length;o++){var _=n[o],h=scheduler._subtract_timespan_zones(_.zones,e.zones);
if(h.length)_.zones=h;else{n.splice(o,1),o--;for(var c=scheduler._marked_timespans_ids[_.id],u=0;u<c.length;u++)if(c[u]==_){c.splice(u,1);break}}}for(var o in scheduler._marked_timespans.timeline)for(var v in scheduler._marked_timespans.timeline[o])for(var u in scheduler._marked_timespans.timeline[o][v])u===i&&delete scheduler._marked_timespans.timeline[o][v][u]},scheduler.deleteMarkedTimespan=function(e){if(arguments.length||(scheduler._marked_timespans={global:{}},scheduler._marked_timespans_ids={},
scheduler._marked_timespans_types={}),"object"!=typeof e)scheduler._delete_marked_timespan_by_id(e);else{e.start_date&&e.end_date||(e.days||(e.days="fullweek"),e.zones||(e.zones="fullday"));var t=[];if(e.type)t.push(e.type);else for(var a in scheduler._marked_timespans_types)t.push(a);for(var r=scheduler._prepare_timespan_options(e),s=0;s<r.length;s++)for(var i=r[s],n=0;n<t.length;n++){var d=scheduler._lame_clone(i);d.type=t[n],scheduler._delete_marked_timespan_by_config(d)}}},scheduler._get_types_to_render=function(e,t){
var a=e?scheduler._lame_copy({},e):{};for(var r in t||{})t.hasOwnProperty(r)&&(a[r]=t[r]);return a},scheduler._get_configs_to_render=function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push.apply(t,e[a]);return t},scheduler._on_scale_add_marker=function(e,t){if(!scheduler._table_view||"month"==scheduler._mode){var a=t.getDay(),r=t.valueOf(),s=this._mode,i=scheduler._marked_timespans,n=[],d=[];if(this._props&&this._props[s]){var l=this._props[s],o=l.options,_=scheduler._get_unit_index(l,t),h=o[_];
if(l.days>1){var c=864e5,u=Math.round((t-scheduler._min_date)/c);t=scheduler.date.add(scheduler._min_date,Math.floor(u/o.length),"day"),t=scheduler.date.date_part(t)}else t=scheduler.date.date_part(new Date(this._date));if(a=t.getDay(),r=t.valueOf(),i[s]&&i[s][h.key]){var v=i[s][h.key],g=scheduler._get_types_to_render(v[a],v[r]);n.push.apply(n,scheduler._get_configs_to_render(g))}}var p=i.global,f=p[r]||p[a];n.push.apply(n,scheduler._get_configs_to_render(f));for(var m=0;m<n.length;m++)d.push.apply(d,scheduler._render_marked_timespan(n[m],e,t));
return d}},scheduler.attachEvent("onScaleAdd",function(){scheduler._on_scale_add_marker.apply(scheduler,arguments)}),scheduler.dblclick_dhx_marked_timespan=function(e,t){scheduler.callEvent("onScaleDblClick",[scheduler.getActionData(e).date,t,e]),scheduler.config.dblclick_create&&scheduler.addEventNow(scheduler.getActionData(e).date,null,e)}},scheduler._temp_limit_scope();

scheduler._props={},scheduler.createUnitsView=function(e,t,r,a,s,n,i){"object"==typeof e&&(r=e.list,t=e.property,a=e.size||0,s=e.step||1,n=e.skip_incorrect,i=e.days||1,e=e.name),scheduler._props[e]={map_to:t,options:r,step:s,position:0,days:i},a>scheduler._props[e].options.length&&(scheduler._props[e]._original_size=a,a=0),scheduler._props[e].size=a,scheduler._props[e].skip_incorrect=n||!1,scheduler.date[e+"_start"]=scheduler.date.day_start,scheduler.templates[e+"_date"]=function(t,r){var a=scheduler._props[e];
return a.days>1?scheduler.templates.week_date(t,r):scheduler.templates.day_date(t)},scheduler._get_unit_index=function(e,t){var r=e.position||0,a=Math.round((scheduler._correct_shift(+t,1)-+scheduler._min_date)/864e5),s=e.options.length;return a>=s&&(a%=s),r+a},scheduler.templates[e+"_scale_text"]=function(e,t,r){return r.css?"<span class='"+r.css+"'>"+t+"</span>":t},scheduler.templates[e+"_scale_date"]=function(t){var r=scheduler._props[e],a=r.options;if(!a.length)return"";var s=scheduler._get_unit_index(r,t),n=a[s];
return scheduler.templates[e+"_scale_text"](n.key,n.label,n)},scheduler.templates[e+"_second_scale_date"]=function(e){return scheduler.templates.week_scale_date(e)},scheduler.date["add_"+e]=function(t,r){return scheduler.date.add(t,r*scheduler._props[e].days,"day")},scheduler.date["get_"+e+"_end"]=function(t){return scheduler.date.add(t,(scheduler._props[e].size||scheduler._props[e].options.length)*scheduler._props[e].days,"day")},scheduler.attachEvent("onOptionsLoad",function(){for(var t=scheduler._props[e],r=t.order={},a=t.options,s=0;s<a.length;s++)r[a[s].key]=s;
t._original_size&&0===t.size&&(t.size=t._original_size,delete t.original_size),t.size>a.length?(t._original_size=t.size,t.size=0):t.size=t._original_size||t.size,scheduler._date&&scheduler._mode==e&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}),scheduler["mouse_"+e]=function(e){var t=scheduler._props[this._mode];if(t){if(e=this._week_indexes_from_pos(e),this._drag_event||(this._drag_event={}),this._drag_id&&this._drag_mode&&(this._drag_event._dhx_changed=!0),this._drag_mode&&"new-size"==this._drag_mode){
var r=scheduler._get_event_sday(scheduler._events[scheduler._drag_id]);Math.floor(e.x/t.options.length)!=Math.floor(r/t.options.length)&&(e.x=r)}var a=e.x%t.options.length,s=Math.min(a+t.position,t.options.length-1);e.section=(t.options[s]||{}).key,e.x=Math.floor(e.x/t.options.length);var n=this.getEvent(this._drag_id);this._update_unit_section({view:t,event:n,pos:e})}return e.force_redraw=!0,e},scheduler.callEvent("onOptionsLoad",[])},scheduler._update_unit_section=function(e){var t=e.view,r=e.event,a=e.pos;
r&&(r[t.map_to]=a.section)},scheduler.scrollUnit=function(e){var t=scheduler._props[this._mode];t&&(t.position=Math.min(Math.max(0,t.position+e),t.options.length-t.size),this.setCurrentView())},function(){var e=function(e){var t=scheduler._props[scheduler._mode];if(t&&t.order&&t.skip_incorrect){for(var r=[],a=0;a<e.length;a++)"undefined"!=typeof t.order[e[a][t.map_to]]&&r.push(e[a]);e.splice(0,e.length),e.push.apply(e,r)}return e},t=scheduler._pre_render_events_table;scheduler._pre_render_events_table=function(r,a){
return r=e(r),t.apply(this,[r,a])};var r=scheduler._pre_render_events_line;scheduler._pre_render_events_line=function(t,a){return t=e(t),r.apply(this,[t,a])};var a=function(e,t){if(e&&"undefined"==typeof e.order[t[e.map_to]]){var r=scheduler,a=864e5,s=Math.floor((t.end_date-r._min_date)/a);return e.options.length&&(t[e.map_to]=e.options[Math.min(s+e.position,e.options.length-1)].key),!0}},s=scheduler.is_visible_events;scheduler.is_visible_events=function(e){var t=s.apply(this,arguments);if(t){var r=scheduler._props[this._mode];
if(r&&r.size){var a=r.order[e[r.map_to]];if(a<r.position||a>=r.size+r.position)return!1}}return t};var n=scheduler._process_ignores;scheduler._process_ignores=function(e,t,r,a,s){if(!scheduler._props[this._mode])return void n.call(this,e,t,r,a,s);this._ignores={},this._ignores_detected=0;var i=scheduler["ignore_"+this._mode];if(i){var d=scheduler._props&&scheduler._props[this._mode]?scheduler._props[this._mode].size||scheduler._props[this._mode].options.length:1;t/=d;for(var l=new Date(e),_=0;t>_;_++){
if(i(l))for(var o=_*d,c=(_+1)*d,h=o;c>h;h++)this._ignores_detected+=1,this._ignores[h]=!0,s&&t++;l=scheduler.date.add(l,a,r),scheduler.date[r+"_start"]&&(l=scheduler.date[r+"_start"](l))}}};var i=scheduler._reset_scale;scheduler._reset_scale=function(){var e=scheduler._props[this._mode],t=i.apply(this,arguments);if(e){this._max_date=this.date.add(this._min_date,e.days,"day");for(var r=this._els.dhx_cal_data[0].childNodes,a=0;a<r.length;a++)r[a].className=r[a].className.replace("_now","");var s=new Date;
if(s.valueOf()>=this._min_date&&s.valueOf()<this._max_date){var n=864e5,d=Math.floor((s-scheduler._min_date)/n),l=e.options.length,_=d*l,o=_+l;for(a=_;o>a;a++)r[a]&&(r[a].className_disabled=r[a].className.replace("dhx_scale_holder","dhx_scale_holder_now"))}if(e.size&&e.size<e.options.length){var c=this._els.dhx_cal_header[0],h=document.createElement("DIV");e.position&&(h.className="dhx_cal_prev_button",h.style.cssText="left:1px;top:2px;position:absolute;",h.innerHTML="&nbsp;",c.firstChild.appendChild(h),h.onclick=function(){
scheduler.scrollUnit(-1*e.step)}),e.position+e.size<e.options.length&&(h=document.createElement("DIV"),h.className="dhx_cal_next_button",h.style.cssText="left:auto; right:0px;top:2px;position:absolute;",h.innerHTML="&nbsp;",c.lastChild.appendChild(h),h.onclick=function(){scheduler.scrollUnit(e.step)})}}return t};var d=scheduler._reset_scale;scheduler._reset_scale=function(){var e=scheduler._props[this._mode],t=scheduler.xy.scale_height;e&&e.days>1?this._header_resized||(this._header_resized=scheduler.xy.scale_height,
scheduler.xy.scale_height=2*t):this._header_resized&&(scheduler.xy.scale_height/=2,this._header_resized=!1),d.apply(this,arguments)};var l=scheduler._get_view_end;scheduler._get_view_end=function(){var e=scheduler._props[this._mode];if(e&&e.days>1){var t=this._get_timeunit_start();return scheduler.date.add(t,e.days,"day")}return l.apply(this,arguments)};var _=scheduler._render_x_header;scheduler._render_x_header=function(e,t,r,a){var s=scheduler._props[this._mode];if(!s||s.days<=1)return _.apply(this,arguments);
if(s.days>1){var n=scheduler.xy.scale_height;scheduler.xy.scale_height=Math.ceil(n/2),_.call(this,e,t,r,a,Math.ceil(scheduler.xy.scale_height));var i=s.options.length;if((e+1)%i===0){var d=document.createElement("DIV");d.className="dhx_scale_bar dhx_second_scale_bar";var l=this.date.add(this._min_date,Math.floor(e/i),"day");this.templates[this._mode+"_second_scalex_class"]&&(d.className+=" "+this.templates[this._mode+"_second_scalex_class"](new Date(l)));var o,c=this._cols[e]*i-1;o=i>1?this._colsS[e-(i-1)]-this.xy.scale_width-2:t,
this.set_xy(d,c,this.xy.scale_height-2,o,0),d.innerHTML=this.templates[this._mode+"_second_scale_date"](new Date(l),this._mode),a.appendChild(d)}scheduler.xy.scale_height=n}};var o=scheduler._get_event_sday;scheduler._get_event_sday=function(e){var t=scheduler._props[this._mode];if(t){if(t.days<=1)return a(t,e),this._get_section_sday(e[t.map_to]);var r=864e5,s=Math.floor((e.end_date.valueOf()-1-60*e.end_date.getTimezoneOffset()*1e3-(scheduler._min_date.valueOf()-60*scheduler._min_date.getTimezoneOffset()*1e3))/r),n=t.options.length,i=t.order[e[t.map_to]];
return s*n+i-t.position}return o.call(this,e)},scheduler._get_section_sday=function(e){var t=scheduler._props[this._mode];return t.order[e]-t.position};var c=scheduler.locate_holder_day;scheduler.locate_holder_day=function(e,t,r){var s=scheduler._props[this._mode];if(!s)return c.apply(this,arguments);var n;if(r?a(s,r):(r={start_date:e,end_date:e},n=0),s.days<=1)return 1*(void 0===n?s.order[r[s.map_to]]:n)+(t?1:0)-s.position;var i=864e5,d=Math.floor((r.start_date.valueOf()-scheduler._min_date.valueOf())/i),l=s.options.length,_=void 0===n?s.order[r[s.map_to]]:n;
return d*l+1*_+(t?1:0)-s.position};var h=scheduler._time_order;scheduler._time_order=function(e){var t=scheduler._props[this._mode];t?e.sort(function(e,r){return t.order[e[t.map_to]]>t.order[r[t.map_to]]?1:-1}):h.apply(this,arguments)};var u=scheduler._pre_render_events_table;scheduler._pre_render_events_table=function(e,t){function r(e){var t=scheduler.date.add(e,1,"day");return t=scheduler.date.date_part(t)}var a=scheduler._props[this._mode];if(a&&a.days>1&&!this.config.all_timed){for(var s={},n=0;n<e.length;n++){
var i=e[n];if(this.isOneDayEvent(e[n])){var d=+scheduler.date.date_part(new Date(i.start_date));s[d]||(s[d]=[]),s[d].push(i)}else{var l=new Date(Math.min(+i.end_date,+this._max_date)),_=new Date(Math.max(+i.start_date,+this._min_date));for(e.splice(n,1);+l>+_;){var o=this._copy_event(i);o.start_date=_,o.end_date=r(o.start_date),_=scheduler.date.add(_,1,"day");var d=+scheduler.date.date_part(new Date(_));s[d]||(s[d]=[]),s[d].push(o),e.splice(n,0,o),n++}n--}}var c=[];for(var n in s)c.splice.apply(c,[c.length-1,0].concat(u.apply(this,[s[n],t])));
for(var n=0;n<c.length;n++)this._ignores[c[n]._sday]?(c.splice(n,1),n--):c[n]._first_chunk=c[n]._last_chunk=!1;c.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1}),e=c}else e=u.apply(this,[e,t]);return e},scheduler.attachEvent("onEventAdded",function(e,t){if(this._loading)return!0;for(var r in scheduler._props){var a=scheduler._props[r];"undefined"==typeof t[a.map_to]&&(t[a.map_to]=a.options[0].key)}return!0}),scheduler.attachEvent("onEventCreated",function(e,t){
var r=scheduler._props[this._mode];if(r&&t){var s=this.getEvent(e);a(r,s);var n=this._mouse_coords(t);this._update_unit_section({view:r,event:s,pos:n}),this.event_updated(s)}return!0})}();

scheduler.attachEvent("onTemplatesReady",function(){function e(e,t,a,r){for(var s=t.getElementsByTagName(e),n=a.getElementsByTagName(e),i=n.length-1;i>=0;i--){var a=n[i];if(r){var d=document.createElement("SPAN");d.className="dhx_text_disabled",d.innerHTML=r(s[i]),a.parentNode.insertBefore(d,a),a.parentNode.removeChild(a)}else a.disabled=!0,t.checked&&(a.checked=!0)}}var t=scheduler.config.lightbox.sections.slice(),a=scheduler.config.buttons_left.slice(),r=scheduler.config.buttons_right.slice();scheduler.attachEvent("onBeforeLightbox",function(e){
if(this.config.readonly_form||this.getEvent(e).readonly){this.config.readonly_active=!0;for(var s=0;s<this.config.lightbox.sections.length;s++)this.config.lightbox.sections[s].focus=!1}else this.config.readonly_active=!1,scheduler.config.lightbox.sections=t.slice(),scheduler.config.buttons_left=a.slice(),scheduler.config.buttons_right=r.slice();var n=this.config.lightbox.sections;if(this.config.readonly_active){for(var s=0;s<n.length;s++)if("recurring"==n[s].type){this.config.readonly_active&&n.splice(s,1);
break}for(var i=["dhx_delete_btn","dhx_save_btn"],d=[scheduler.config.buttons_left,scheduler.config.buttons_right],s=0;s<i.length;s++)for(var l=i[s],o=0;o<d.length;o++){for(var _=d[o],c=-1,h=0;h<_.length;h++)if(_[h]==l){c=h;break}-1!=c&&_.splice(c,1)}}return this.resetLightbox(),!0});var s=scheduler._fill_lightbox;scheduler._fill_lightbox=function(){var t=this.getLightbox();this.config.readonly_active&&(t.style.visibility="hidden",t.style.display="block");var a=s.apply(this,arguments);if(this.config.readonly_active&&(t.style.visibility="",
t.style.display="none"),this.config.readonly_active){var r=this.getLightbox(),i=this._lightbox_r=r.cloneNode(!0);i.id=scheduler.uid(),e("textarea",r,i,function(e){return e.value}),e("input",r,i,!1),e("select",r,i,function(e){return e.options.length?e.options[Math.max(e.selectedIndex||0,0)].text:""}),r.parentNode.insertBefore(i,r),n.call(this,i),scheduler._lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox),this._lightbox=i,scheduler.config.drag_lightbox&&(i.firstChild.onmousedown=scheduler._ready_to_dnd),
this.setLightboxSize(),i.onclick=function(e){var t=e?e.target:event.srcElement;if(scheduler._getClassName(t)||(t=t.previousSibling),t&&t.className)switch(scheduler._getClassName(t)){case"dhx_cancel_btn":scheduler.callEvent("onEventCancel",[scheduler._lightbox_id]),scheduler._edit_stop_event(scheduler.getEvent(scheduler._lightbox_id),!1),scheduler.hide_lightbox()}}}return a};var n=scheduler.showCover;scheduler.showCover=function(){this.config.readonly_active||n.apply(this,arguments)};var i=scheduler.hide_lightbox;
scheduler.hide_lightbox=function(){return this._lightbox_r&&(this._lightbox_r.parentNode.removeChild(this._lightbox_r),this._lightbox_r=this._lightbox=null),i.apply(this,arguments)}});

window.dhtmlXTooltip=scheduler.dhtmlXTooltip=window.dhtmlxTooltip={},dhtmlXTooltip.config={className:"dhtmlXTooltip tooltip",timeout_to_display:50,timeout_to_hide:50,delta_x:15,delta_y:-20},dhtmlXTooltip.tooltip=document.createElement("div"),dhtmlXTooltip.tooltip.className=dhtmlXTooltip.config.className,dhtmlXTooltip.show=function(e,t){if(!scheduler.config.touch||scheduler.config.touch_tooltip){var r=dhtmlXTooltip,a=this.tooltip,s=a.style;r.tooltip.className=r.config.className;var n=this.position(e),i=e.target||e.srcElement;
if(!this.isTooltip(i)){var d=n.x+(r.config.delta_x||0),l=n.y-(r.config.delta_y||0);s.visibility="hidden",s.removeAttribute?(s.removeAttribute("right"),s.removeAttribute("bottom")):(s.removeProperty("right"),s.removeProperty("bottom")),s.left="0",s.top="0",this.tooltip.innerHTML=t,document.body.appendChild(this.tooltip);var _=this.tooltip.offsetWidth,o=this.tooltip.offsetHeight;document.body.offsetWidth-d-_<0?(s.removeAttribute?s.removeAttribute("left"):s.removeProperty("left"),s.right=document.body.offsetWidth-d+2*(r.config.delta_x||0)+"px"):0>d?s.left=n.x+Math.abs(r.config.delta_x||0)+"px":s.left=d+"px",
document.body.offsetHeight-l-o<0?(s.removeAttribute?s.removeAttribute("top"):s.removeProperty("top"),s.bottom=document.body.offsetHeight-l-2*(r.config.delta_y||0)+"px"):0>l?s.top=n.y+Math.abs(r.config.delta_y||0)+"px":s.top=l+"px",s.visibility="visible",this.tooltip.onmouseleave=function(e){e=e||window.event;for(var t=scheduler.dhtmlXTooltip,r=e.relatedTarget;r!=scheduler._obj&&r;)r=r.parentNode;r!=scheduler._obj&&t.delay(t.hide,t,[],t.config.timeout_to_hide)},scheduler.callEvent("onTooltipDisplayed",[this.tooltip,this.tooltip.event_id]);
}}},dhtmlXTooltip._clearTimeout=function(){this.tooltip._timeout_id&&window.clearTimeout(this.tooltip._timeout_id)},dhtmlXTooltip.hide=function(){if(this.tooltip.parentNode){var e=this.tooltip.event_id;this.tooltip.event_id=null,this.tooltip.onmouseleave=null,this.tooltip.parentNode.removeChild(this.tooltip),scheduler.callEvent("onAfterTooltip",[e])}this._clearTimeout()},dhtmlXTooltip.delay=function(e,t,r,a){this._clearTimeout(),this.tooltip._timeout_id=setTimeout(function(){var a=e.apply(t,r);return e=t=r=null,
a},a||this.config.timeout_to_display)},dhtmlXTooltip.isTooltip=function(e){var t=!1;for("dhtmlXTooltip"==scheduler._getClassName(e).split(" ")[0];e&&!t;)t=e.className==this.tooltip.className,e=e.parentNode;return t},dhtmlXTooltip.position=function(e){if(e=e||window.event,e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var t=window._isIE&&"BackCompat"!=document.compatMode?document.documentElement:document.body;return{x:e.clientX+t.scrollLeft-t.clientLeft,y:e.clientY+t.scrollTop-t.clientTop}},scheduler.attachEvent("onMouseMove",function(e,t){
var r=window.event||t,a=r.target||r.srcElement,s=dhtmlXTooltip,n=s.isTooltip(a),i=s.isTooltipTarget&&s.isTooltipTarget(a);if(e||n||i){var d;if(e||s.tooltip.event_id){var l=scheduler.getEvent(e)||scheduler.getEvent(s.tooltip.event_id);if(!l)return;if(s.tooltip.event_id=l.id,d=scheduler.templates.tooltip_text(l.start_date,l.end_date,l),!d)return s.hide()}i&&(d="");var _;if(_isIE){_={pageX:void 0,pageY:void 0,clientX:void 0,clientY:void 0,target:void 0,srcElement:void 0};for(var o in _)_[o]=r[o]}if(!scheduler.callEvent("onBeforeTooltip",[e])||!d)return;
s.delay(s.show,s,[_||r,d])}else s.delay(s.hide,s,[],s.config.timeout_to_hide)}),scheduler.attachEvent("onBeforeDrag",function(){return dhtmlXTooltip.hide(),!0}),scheduler.attachEvent("onEventDeleted",function(){return dhtmlXTooltip.hide(),!0}),scheduler.templates.tooltip_date_format=scheduler.date.date_to_str("%Y-%m-%d %H:%i"),scheduler.templates.tooltip_text=function(e,t,r){return"<b>Event:</b> "+r.text+"<br/><b>Start date:</b> "+scheduler.templates.tooltip_date_format(e)+"<br/><b>End date:</b> "+scheduler.templates.tooltip_date_format(t);
};

scheduler._temp_matrix_scope=function(){function e(){for(var e=scheduler.get_visible_events(),t=[],r=0;r<this.y_unit.length;r++)t[r]=[];var a;t[a]||(t[a]=[]);for(var r=0;r<e.length;r++){a=this.order[e[r][this.y_property]];for(var s=0;this._trace_x[s+1]&&e[r].start_date>=this._trace_x[s+1];)s++;for(;this._trace_x[s]&&e[r].end_date>this._trace_x[s];)t[a][s]||(t[a][s]=[]),t[a][s].push(e[r]),s++}return t}function t(e,t,r){var a=0,s=r._step,n=r.round_position,d=0,i=t?e.end_date:e.start_date;i.valueOf()>scheduler._max_date.valueOf()&&(i=scheduler._max_date);
var l=i-scheduler._min_date_timeline;if(l>0){var _=scheduler._get_date_index(r,i);scheduler._ignores[_]&&(n=!0);for(var o=0;_>o;o++)a+=scheduler._cols[o];var c=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*_,scheduler.matrix[scheduler._mode].x_unit);n?+i>+c&&t&&(d=scheduler._cols[_]):(l=i-c,r.first_hour||r.last_hour?(l-=r._start_correction,0>l&&(l=0),d=Math.round(l/s),d>scheduler._cols[_]&&(d=scheduler._cols[_])):d=Math.round(l/s))}return a+=t?0===l||n?d-14:d-12:d+1;
}function r(e,t){var r=scheduler._get_date_index(this,e),a=this._trace_x[r];return t&&+e!=+this._trace_x[r]&&(a=this._trace_x[r+1]?this._trace_x[r+1]:scheduler.date.add(this._trace_x[r],this.x_step,this.x_unit)),new Date(a)}function a(e){if(scheduler._ignores_detected)for(var t,r,a,s,n=0;n<e.length;n++){for(s=e[n],a=!1,t=scheduler._get_date_index(this,s.start_date),r=scheduler._get_date_index(this,s.end_date);r>t;){if(!scheduler._ignores[t]){a=!0;break}t++}a||t!=r||scheduler._ignores[r]||+s.end_date>+this._trace_x[r]&&(a=!0),
a||(e.splice(n,1),n--)}}function s(e){var t="";if(e&&"cell"!=this.render){a.call(this,e),e.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var s=[],n=e.length,d=0;n>d;d++){var i=e[d];i._inner=!1;var l=this.round_position?r.apply(this,[i.start_date,!1]):i.start_date;for(this.round_position?r.apply(this,[i.end_date,!0]):i.end_date;s.length;){var _=s[s.length-1];if(!(_.end_date.valueOf()<=l.valueOf()))break;s.splice(s.length-1,1);
}for(var o=!1,c=0;c<s.length;c++){var h=s[c];if(h.end_date.valueOf()<=l.valueOf()){o=!0,i._sorder=h._sorder,s.splice(c,1),i._inner=!0;break}}if(s.length&&(s[s.length-1]._inner=!0),!o)if(s.length)if(s.length<=s[s.length-1]._sorder){if(s[s.length-1]._sorder)for(var u=0;u<s.length;u++){for(var v=!1,p=0;p<s.length;p++)if(s[p]._sorder==u){v=!0;break}if(!v){i._sorder=u;break}}else i._sorder=0;i._inner=!0}else{for(var f=s[0]._sorder,g=1;g<s.length;g++)s[g]._sorder>f&&(f=s[g]._sorder);i._sorder=f+1,i._inner=!1;
}else i._sorder=0;s.push(i),s.length>(s.max_count||0)?(s.max_count=s.length,i._count=s.length):i._count=i._count?i._count:1}for(var m=0;m<e.length;m++)e[m]._count=s.max_count;for(var y=0;n>y;y++)t+=scheduler.render_timeline_event.call(this,e[y],!1)}return t}function n(e){var t="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>";scheduler._load_mode&&scheduler._load();for(var r=scheduler._prepare_timeline_events(this),a=0,n=0;n<scheduler._cols.length;n++)a+=scheduler._cols[n];var d=new Date,i=scheduler._cols.length-scheduler._ignores_detected;
d=(scheduler.date.add(d,this.x_step*i,this.x_unit)-d-(this._start_correction+this._end_correction)*i)/a,this._step=d,this._summ=a;var l=scheduler._colsS.heights=[],_=[];this._events_height={},this._section_height={};for(var n=0;n<this.y_unit.length;n++){var o=this._logic(this.render,this.y_unit[n],this);scheduler._merge(o,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*o.height<e.offsetHeight&&(o.height=Math.max(o.height,Math.floor((e.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[n].key]=o.height),
o.td_className||(o.td_className="dhx_matrix_scell"+(scheduler.templates[this.name+"_scaley_class"](this.y_unit[n].key,this.y_unit[n].label,this.y_unit[n])?" "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[n].key,this.y_unit[n].label,this.y_unit[n]):"")),o.td_content||(o.td_content=scheduler.templates[this.name+"_scale_label"](this.y_unit[n].key,this.y_unit[n].label,this.y_unit[n])),scheduler._merge(o,{tr_className:"",style_height:"height:"+o.height+"px;",style_width:"width:"+this.dx+"px;",
summ_width:"width:"+a+"px;",table_className:""});var c=s.call(this,r[n]);if(this.fit_events){var h=this._events_height[this.y_unit[n].key]||0;o.height=h>o.height?h:o.height,o.style_height="height:"+o.height+"px;",this._section_height[this.y_unit[n].key]=o.height}if(t+="<tr class='"+o.tr_className+"' style='"+o.style_height+"'><td class='"+o.td_className+"' style='"+o.style_width+" height:"+(o.height-1)+"px;'>"+o.td_content+"</td>","cell"==this.render)for(var u=0;u<scheduler._cols.length;u++)t+=scheduler._ignores[u]?"<td></td>":"<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](r[n][u],this._trace_x[u],this.y_unit[n])+"' style='width:"+scheduler._cols[u]+"px'><div style='width:auto'>"+scheduler.templates[this.name+"_cell_value"](r[n][u],this._trace_x[u],this.y_unit[n])+"</div></td>";else{
t+="<td><div style='"+o.summ_width+" "+o.style_height+" position:relative;' class='dhx_matrix_line'>",t+=c,t+="<table class='"+o.table_className+"' cellpadding='0' cellspacing='0' style='"+o.summ_width+" "+o.style_height+"' >";for(var u=0;u<scheduler._cols.length;u++)t+=scheduler._ignores[u]?"<td></td>":"<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](r[n],this._trace_x[u],this.y_unit[n])+"' style='width:"+scheduler._cols[u]+"px'></td>";t+="</table>",t+="</div></td>"}t+="</tr>",
_.push(o)}t+="</table>",this._matrix=r,e.innerHTML=t,scheduler._populate_timeline_rendered(e),this._scales={};for(var v=e.firstChild.rows,p=null,n=0,f=_.length;f>n;n++){p=this.y_unit[n],l.push(_[n].height);var g=p.key,m=this._scales[g]=scheduler._isRender("cell")?v[n]:v[n].childNodes[1].getElementsByTagName("div")[0];scheduler.callEvent("onScaleAdd",[m,g])}}function d(e){var t=scheduler._min_date,r=scheduler._max_date;scheduler._process_ignores(t,this.x_size,this.x_unit,this.x_step,e);for(var a=(this.x_size+(e?scheduler._ignores_detected:0),
0),s=0;+r>+t;)if(this._trace_x[s]=new Date(t),t=scheduler.date.add(t,this.x_step,this.x_unit),scheduler.date[this.x_unit+"_start"]&&(t=scheduler.date[this.x_unit+"_start"](t)),scheduler._ignores[s]||a++,s++,e)if(a<this.x_size&&!(+r>+t))r=scheduler.date["add_"+this.name+"_private"](r,(this.x_length||this.x_size)*this.x_step);else if(a>=this.x_size){scheduler._max_date=t;break}return{total:s,displayed:a}}function i(e){var t=scheduler.xy.scale_height,r=this._header_resized||scheduler.xy.scale_height;
scheduler._cols=[],scheduler._colsS={height:0},this._trace_x=[];var a=scheduler._x-this.dx-scheduler.xy.scroll_width,s=[this.dx],n=scheduler._els.dhx_cal_header[0];n.style.width=s[0]+a+"px";for(var i=scheduler._min_date_timeline=scheduler._min_date,_=scheduler.config.preserve_scale_length,o=d.call(this,_),c=o.displayed,h=o.total,u=0;h>u;u++)scheduler._ignores[u]?(scheduler._cols[u]=0,c++):scheduler._cols[u]=Math.floor(a/(c-u)),a-=scheduler._cols[u],s[u+1]=s[u]+scheduler._cols[u];if(e.innerHTML="<div></div>",
this.second_scale){for(var p=this.second_scale.x_unit,f=[this._trace_x[0]],g=[],m=[this.dx,this.dx],y=0,x=0;x<this._trace_x.length;x++){var b=this._trace_x[x],w=l(p,b,f[y]);w&&(++y,f[y]=b,m[y+1]=m[y]);var k=y+1;g[y]=scheduler._cols[x]+(g[y]||0),m[k]+=scheduler._cols[x]}e.innerHTML="<div></div><div></div>";var E=e.firstChild;E.style.height=r+"px";var D=e.lastChild;D.style.position="relative";for(var N=0;N<f.length;N++){var M=f[N],C=scheduler.templates[this.name+"_second_scalex_class"](M),O=document.createElement("DIV");
O.className="dhx_scale_bar dhx_second_scale_bar"+(C?" "+C:""),scheduler.set_xy(O,g[N]-1,r-3,m[N],0),O.innerHTML=scheduler.templates[this.name+"_second_scale_date"](M),E.appendChild(O)}}scheduler.xy.scale_height=r,e=e.lastChild;for(var T=0;T<this._trace_x.length;T++)if(!scheduler._ignores[T]){i=this._trace_x[T],scheduler._render_x_header(T,s[T],i,e);var L=scheduler.templates[this.name+"_scalex_class"](i);L&&(e.lastChild.className+=" "+L)}scheduler.xy.scale_height=t;var S=this._trace_x;e.onclick=function(e){
var t=v(e);t&&scheduler.callEvent("onXScaleClick",[t.x,S[t.x],e||event])},e.ondblclick=function(e){var t=v(e);t&&scheduler.callEvent("onXScaleDblClick",[t.x,S[t.x],e||event])}}function l(e,t,r){switch(e){case"hour":return t.getHours()!=r.getHours()||l("day",t,r);case"day":return!(t.getDate()==r.getDate()&&t.getMonth()==r.getMonth()&&t.getFullYear()==r.getFullYear());case"week":return!(scheduler.date.week_start(new Date(t)).valueOf()==scheduler.date.week_start(new Date(r)).valueOf());case"month":return!(t.getMonth()==r.getMonth()&&t.getFullYear()==r.getFullYear());
case"year":return!(t.getFullYear()==r.getFullYear());default:return!1}}function _(e){if(this._header_resized&&(!e||!this.second_scale)){scheduler.xy.scale_height/=2,this._header_resized=!1;var t=scheduler._els.dhx_cal_header[0];t.className=t.className.replace(/ dhx_second_cal_header/gi,"")}}function o(e){if(_.call(this,e),e){this.second_scale&&!this._header_resized&&(this._header_resized=scheduler.xy.scale_height,scheduler.xy.scale_height*=2,scheduler._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),
scheduler.set_sizes(),scheduler._init_matrix_tooltip();var t=scheduler._min_date;i.call(this,scheduler._els.dhx_cal_header[0]),n.call(this,scheduler._els.dhx_cal_data[0]),scheduler._min_date=t,scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date),scheduler._mark_now&&scheduler._mark_now(),_.call(this,e)}c()}function c(){scheduler._tooltip&&(scheduler._tooltip.style.display="none",scheduler._tooltip.date="")}function h(e,t,r){if("cell"==e.render){
var a=t.x+"_"+t.y,s=e._matrix[t.y][t.x];if(!s)return c();if(s.sort(function(e,t){return e.start_date>t.start_date?1:-1}),scheduler._tooltip){if(scheduler._tooltip.date==a)return;scheduler._tooltip.innerHTML=""}else{var n=scheduler._tooltip=document.createElement("DIV");n.className="dhx_year_tooltip",document.body.appendChild(n),n.onclick=scheduler._click.dhx_cal_data}for(var d="",i=0;i<s.length;i++){var l=s[i].color?"background-color:"+s[i].color+";":"",_=s[i].textColor?"color:"+s[i].textColor+";":"";
d+="<div class='dhx_tooltip_line' event_id='"+s[i].id+"' style='"+l+_+"'>",d+="<div class='dhx_tooltip_date'>"+(s[i]._timed?scheduler.templates.event_date(s[i].start_date):"")+"</div>",d+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",d+=scheduler.templates[e.name+"_tooltip"](s[i].start_date,s[i].end_date,s[i])+"</div>"}scheduler._tooltip.style.display="",scheduler._tooltip.style.top="0px",document.body.offsetWidth-r.left-scheduler._tooltip.offsetWidth<0?scheduler._tooltip.style.left=r.left-scheduler._tooltip.offsetWidth+"px":scheduler._tooltip.style.left=r.left+t.src.offsetWidth+"px",
scheduler._tooltip.date=a,scheduler._tooltip.innerHTML=d,document.body.offsetHeight-r.top-scheduler._tooltip.offsetHeight<0?scheduler._tooltip.style.top=r.top-scheduler._tooltip.offsetHeight+t.src.offsetHeight+"px":scheduler._tooltip.style.top=r.top+"px"}}function u(e){for(var t=e.parentNode.childNodes,r=-1,a=0;a<t.length;a++)if(t[a]==e){r=a;break}var s=r;if(scheduler._ignores_detected)for(var n in scheduler._ignores)scheduler._ignores[n]&&s>=1*n&&s++;return s}function v(e){e=e||event;for(var t=e.target?e.target:e.srcElement;t&&"DIV"!=t.tagName;)t=t.parentNode;
if(t&&"DIV"==t.tagName){var r=scheduler._getClassName(t).split(" ")[0];if("dhx_scale_bar"==r)return{x:u(t),y:-1,src:t,scale:!0}}}scheduler.matrix={},scheduler._merge=function(e,t){for(var r in t)"undefined"==typeof e[r]&&(e[r]=t[r])},scheduler.createTimelineView=function(e){scheduler._skin_init(),scheduler._merge(e,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:scheduler.xy.bar_height-5,
event_min_dy:scheduler.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(e,t,r){var a={};return scheduler.checkEvent("onBeforeSectionRender")&&(a=scheduler.callEvent("onBeforeSectionRender",[e,t,r])),a}}),e._original_x_start=e.x_start,"day"!=e.x_unit&&(e.first_hour=e.last_hour=0),e._start_correction=e.first_hour?60*e.first_hour*60*1e3:0,e._end_correction=e.last_hour?60*(24-e.last_hour)*60*1e3:0,scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[e]);
var t=scheduler.render_data;scheduler.render_data=function(r,a){if(this._mode!=e.name)return t.apply(this,arguments);if(a&&!e.show_unassigned&&"cell"!=e.render)for(var s=0;s<r.length;s++)this.clear_event(r[s]),this.render_timeline_event.call(this.matrix[this._mode],r[s],!0);else scheduler._renderMatrix.call(e,!0,!0)},scheduler.matrix[e.name]=e,scheduler.templates[e.name+"_cell_value"]=function(e){return e?e.length:""},scheduler.templates[e.name+"_cell_class"]=function(e){return""},scheduler.templates[e.name+"_scalex_class"]=function(e){
return""},scheduler.templates[e.name+"_second_scalex_class"]=function(e){return""},scheduler.templates[e.name+"_scaley_class"]=function(e,t,r){return""},scheduler.templates[e.name+"_scale_label"]=function(e,t,r){return t},scheduler.templates[e.name+"_tooltip"]=function(e,t,r){return r.text},scheduler.templates[e.name+"_date"]=function(e,t){return e.getDay()==t.getDay()&&864e5>t-e||+e==+scheduler.date.date_part(new Date(t))||+scheduler.date.add(e,1,"day")==+t&&0===t.getHours()&&0===t.getMinutes()?scheduler.templates.day_date(e):e.getDay()!=t.getDay()&&864e5>t-e?scheduler.templates.day_date(e)+" &ndash; "+scheduler.templates.day_date(t):scheduler.templates.week_date(e,t);
},scheduler.templates[e.name+"_scale_date"]=scheduler.date.date_to_str(e.x_date||scheduler.config.hour_date),scheduler.templates[e.name+"_second_scale_date"]=scheduler.date.date_to_str(e.second_scale&&e.second_scale.x_date?e.second_scale.x_date:scheduler.config.hour_date),scheduler.date["add_"+e.name+"_private"]=function(t,r){var a=r,s=e.x_unit;if("minute"==e.x_unit||"hour"==e.x_unit){var n=a;"hour"==e.x_unit&&(n*=60),n%1440||(a=n/1440,s="day")}return scheduler.date.add(t,a,s)},scheduler.date["add_"+e.name]=function(t,r,a){
var s=scheduler.date["add_"+e.name+"_private"](t,(e.x_length||e.x_size)*e.x_step*r);if("minute"==e.x_unit||"hour"==e.x_unit){var n=e.x_length||e.x_size,d="hour"==e.x_unit?60*e.x_step:e.x_step;if(d*n%1440)if(+scheduler.date.date_part(new Date(t))==+scheduler.date.date_part(new Date(s)))e.x_start+=r*n;else{var i=1440/(n*d)-1,l=Math.round(i*n);r>0?e.x_start=e.x_start-l:e.x_start=l+e.x_start}}return s},scheduler.date[e.name+"_start"]=function(t){var r=scheduler.date[e.x_unit+"_start"]||scheduler.date.day_start,a=r.call(scheduler.date,t),s=a.getTimezoneOffset();
a=scheduler.date.add(a,e.x_step*e.x_start,e.x_unit);var n=a.getTimezoneOffset();return s!=n&&a.setTime(a.getTime()+6e4*(n-s)),a},scheduler.callEvent("onOptionsLoad",[e]),scheduler[e.name+"_view"]=function(t){t?scheduler._set_timeline_dates(e):scheduler._renderMatrix.apply(e,arguments)};var a=new Date;scheduler.date.add(a,e.x_step,e.x_unit).valueOf()-a.valueOf();scheduler["mouse_"+e.name]=function(t){var a=this._drag_event;this._drag_id&&(a=this.getEvent(this._drag_id)),t.x-=e.dx;var s=scheduler._timeline_drag_date(e,t.x);
if(t.x=0,t.force_redraw=!0,t.custom=!0,"move"==this._drag_mode&&this._drag_id&&this._drag_event){var a=this.getEvent(this._drag_id),n=this._drag_event;if(t._ignores=this._ignores_detected||e._start_correction||e._end_correction,void 0===n._move_delta&&(n._move_delta=(a.start_date-s)/6e4,this.config.preserve_length&&t._ignores&&(n._move_delta=this._get_real_event_length(a.start_date,s,e),n._event_length=this._get_real_event_length(a.start_date,a.end_date,e))),this.config.preserve_length&&t._ignores){
var d=(n._event_length,this._get_fictional_event_length(s,n._move_delta,e,!0));s=new Date(s-d)}else s=scheduler.date.add(s,n._move_delta,"minute")}if("resize"==this._drag_mode&&a&&(!this.config.timeline_swap_resize&&this._drag_id&&(this._drag_from_start&&+s>+a.end_date?this._drag_from_start=!1:!this._drag_from_start&&+s<+a.start_date&&(this._drag_from_start=!0)),t.resize_from_start=this._drag_from_start,!this.config.timeline_swap_resize&&this._drag_id&&this._drag_from_start&&+s>=+scheduler.date.add(a.end_date,-scheduler.config.time_step,"minute")&&(s=scheduler.date.add(a.end_date,-scheduler.config.time_step,"minute"))),
e.round_position)switch(this._drag_mode){case"move":this.config.preserve_length||(s=r.call(e,s,!1),"day"==e.x_unit&&(t.custom=!1));break;case"resize":this._drag_event&&((null===this._drag_event._resize_from_start||void 0===this._drag_event._resize_from_start)&&(this._drag_event._resize_from_start=t.resize_from_start),t.resize_from_start=this._drag_event._resize_from_start,s=r.call(e,s,!this._drag_event._resize_from_start))}this._resolve_timeline_section(e,t),t.section&&this._update_timeline_section({
pos:t,event:this.getEvent(this._drag_id),view:e}),t.y=Math.round((this._correct_shift(s,1)-this._min_date)/(6e4*this.config.time_step)),t.shift=this.config.time_step,e.round_position&&"new-size"==this._drag_mode&&s<=this._drag_start&&(t.shift=scheduler.date.add(this._drag_start,e.x_step,e.x_unit)-this._drag_start);var i=this._is_pos_changed(this._drag_pos,t);return this._drag_pos&&i&&(this._drag_event._dhx_changed=!0),i||this._drag_pos.has_moved||(t.force_redraw=!1),t}},scheduler._prepare_timeline_events=function(t){
var r=[];if("cell"==t.render)r=e.call(t);else for(var a=scheduler.get_visible_events(),s=t.order,n=0;n<a.length;n++){var d=a[n],i=d[t.y_property],l=t.order[i];if(t.show_unassigned&&!i){for(var _ in s)if(s.hasOwnProperty(_)){l=s[_],r[l]||(r[l]=[]);var o=scheduler._lame_copy({},d);o[t.y_property]=_,r[l].push(o)}}else r[l]||(r[l]=[]),r[l].push(d)}return r},scheduler._populate_timeline_rendered=function(e){scheduler._rendered=[];for(var t=e.getElementsByTagName("DIV"),r=0;r<t.length;r++)t[r].getAttribute("event_id")&&scheduler._rendered.push(t[r]);
},scheduler._get_timeline_event_height=function(e,t){var r=e[t.y_property],a=t.event_dy;return"full"==t.event_dy&&(a=t.section_autoheight?t._section_height[r]-6:t.dy-3),t.resize_events&&(a=Math.max(Math.floor(a/e._count),t.event_min_dy)),a},scheduler._get_timeline_event_y=function(e,t){var r=e,a=2+r*t+(r?2*r:0);return scheduler.config.cascade_event_display&&(a=2+r*scheduler.config.cascade_event_margin+(r?2*r:0)),a},scheduler.render_timeline_event=function(e,r){var a=e[this.y_property];if(!a)return"";
var s=e._sorder,n=t(e,!1,this),d=t(e,!0,this),i=scheduler._get_timeline_event_height(e,this),l=i-2;e._inner||"full"!=this.event_dy||(l=(l+2)*(e._count-s)-2);var _=scheduler._get_timeline_event_y(e._sorder,i),o=i+_+2;(!this._events_height[a]||this._events_height[a]<o)&&(this._events_height[a]=o);var c=scheduler.templates.event_class(e.start_date,e.end_date,e);c="dhx_cal_event_line "+(c||""),e._no_drag_move&&(c+=" no_drag_move");var h=e.color?"background:"+e.color+";":"",u=e.textColor?"color:"+e.textColor+";":"",v=scheduler.templates.event_bar_text(e.start_date,e.end_date,e),p='<div event_id="'+e.id+'" class="'+c+'" style="'+h+u+"position:absolute; top:"+_+"px; height: "+l+"px; left:"+n+"px; width:"+Math.max(0,d-n)+"px;"+(e._text_style||"")+'">';
if(scheduler.config.drag_resize&&!scheduler.config.readonly){var f="dhx_event_resize",g="<div class='"+f+" "+f+"_start' style='height: "+l+"px;'></div>",m="<div class='"+f+" "+f+"_end' style='height: "+l+"px;'></div>";p+=(e._no_resize_start?"":g)+(e._no_resize_end?"":m)}if(p+=v+"</div>",!r)return p;var y=document.createElement("DIV");y.innerHTML=p;var x=this.order[a],b=scheduler._els.dhx_cal_data[0].firstChild.rows[x];if(b){var w=b.cells[1].firstChild;scheduler._rendered.push(y.firstChild),w.appendChild(y.firstChild);
}},scheduler._matrix_tooltip_handler=function(e){var t=scheduler.matrix[scheduler._mode];if(t&&"cell"==t.render){if(t){var r=scheduler._locate_cell_timeline(e),e=e||event;e.target||e.srcElement;if(r)return h(t,r,getOffset(r.src))}c()}},scheduler._init_matrix_tooltip=function(){scheduler._detachDomEvent(scheduler._els.dhx_cal_data[0],"mouseover",scheduler._matrix_tooltip_handler),dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",scheduler._matrix_tooltip_handler)},scheduler._set_timeline_dates=function(e){
scheduler._min_date=scheduler.date[e.name+"_start"](new Date(scheduler._date)),scheduler._max_date=scheduler.date["add_"+e.name+"_private"](scheduler._min_date,e.x_size*e.x_step),scheduler.date[e.x_unit+"_start"]&&(scheduler._max_date=scheduler.date[e.x_unit+"_start"](scheduler._max_date)),scheduler._table_view=!0},scheduler._renderMatrix=function(e,t){t||(scheduler._els.dhx_cal_data[0].scrollTop=0),scheduler._set_timeline_dates(this),o.call(this,e)},scheduler._locate_cell_timeline=function(e){e=e||event;
for(var t=e.target?e.target:e.srcElement,r={},a=scheduler.matrix[scheduler._mode],s=scheduler.getActionData(e),n=scheduler._ignores,d=0,i=0;i<a._trace_x.length-1&&!(+s.date<a._trace_x[i+1]);i++)n[i]||d++;r.x=0===d?0:i,r.y=a.order[s.section];var l=scheduler._isRender("cell")?1:0;r.src=a._scales[s.section]?a._scales[s.section].getElementsByTagName("td")[i+l]:null;for(var _=!1;0===r.x&&"dhx_cal_data"!=scheduler._getClassName(t)&&t.parentNode;){if("dhx_matrix_scell"==scheduler._getClassName(t).split(" ")[0]){
_=!0;break}t=t.parentNode}return _?(r.x=-1,r.src=t,r.scale=!0):r.x=i,r};var p=scheduler._click.dhx_cal_data;scheduler._click.dhx_marked_timespan=scheduler._click.dhx_cal_data=function(e){var t=p.apply(this,arguments),r=scheduler.matrix[scheduler._mode];if(r){var a=scheduler._locate_cell_timeline(e);a&&(a.scale?scheduler.callEvent("onYScaleClick",[a.y,r.y_unit[a.y],e||event]):scheduler.callEvent("onCellClick",[a.x,a.y,r._trace_x[a.x],(r._matrix[a.y]||{})[a.x]||[],e||event]))}return t},scheduler.dblclick_dhx_matrix_cell=function(e){
var t=scheduler.matrix[scheduler._mode];if(t){var r=scheduler._locate_cell_timeline(e);r&&(r.scale?scheduler.callEvent("onYScaleDblClick",[r.y,t.y_unit[r.y],e||event]):scheduler.callEvent("onCellDblClick",[r.x,r.y,t._trace_x[r.x],(t._matrix[r.y]||{})[r.x]||[],e||event]))}};var f=scheduler.dblclick_dhx_marked_timespan||function(){};scheduler.dblclick_dhx_marked_timespan=function(e){var t=scheduler.matrix[scheduler._mode];return t?scheduler.dblclick_dhx_matrix_cell(e):f.apply(this,arguments)},scheduler.dblclick_dhx_matrix_scell=function(e){
return scheduler.dblclick_dhx_matrix_cell(e)},scheduler._isRender=function(e){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==e},scheduler.attachEvent("onCellDblClick",function(e,t,r,a,s){if(!this.config.readonly&&("dblclick"!=s.type||this.config.dblclick_create)){var n=scheduler.matrix[scheduler._mode],d={};d.start_date=n._trace_x[e],d.end_date=n._trace_x[e+1]?n._trace_x[e+1]:scheduler.date.add(n._trace_x[e],n.x_step,n.x_unit),n._start_correction&&(d.start_date=new Date(1*d.start_date+n._start_correction)),
n._end_correction&&(d.end_date=new Date(d.end_date-n._end_correction)),d[n.y_property]=n.y_unit[t].key,scheduler.addEventNow(d,null,s)}}),scheduler.attachEvent("onBeforeDrag",function(e,t,r){return!scheduler._isRender("cell")}),scheduler.attachEvent("onEventChanged",function(e,t){t._timed=this.isOneDayEvent(t)}),scheduler.attachEvent("onBeforeEventChanged",function(e,t,r,a){return e&&(e._move_delta=void 0),a&&(a._move_delta=void 0),!0}),scheduler._is_column_visible=function(e){var t=scheduler.matrix[scheduler._mode],r=scheduler._get_date_index(t,e);
return!scheduler._ignores[r]};var g=scheduler._render_marked_timespan;scheduler._render_marked_timespan=function(e,r,a,s,n){if(!scheduler.config.display_marked_timespans)return[];if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){if(scheduler._isRender("cell"))return;var d=scheduler._lame_copy({},scheduler.matrix[scheduler._mode]);d.round_position=!1;var i=[],l=[],_=[],o=e.sections?e.sections.units||e.sections.timeline:null;if(a)_=[r],l=[a];else{var c=d.order;if(o)c.hasOwnProperty(o)&&(l.push(o),
_.push(d._scales[o]));else for(var h in c)c.hasOwnProperty(h)&&(l.push(h),_.push(d._scales[h]))}var s=s?new Date(s):scheduler._min_date,n=n?new Date(n):scheduler._max_date;s.valueOf()<scheduler._min_date.valueOf()&&(s=new Date(scheduler._min_date)),n.valueOf()>scheduler._max_date.valueOf()&&(n=new Date(scheduler._max_date));for(var u=0;u<d._trace_x.length&&!scheduler._is_column_visible(d._trace_x[u]);u++);if(u==d._trace_x.length)return;var v=[];if(e.days>6){var p=new Date(e.days);scheduler.date.date_part(new Date(s))<=+p&&+n>=+p&&v.push(p);
}else v.push.apply(v,scheduler._get_dates_by_index(e.days));for(var f=e.zones,m=scheduler._get_css_classes_by_config(e),y=0;y<l.length;y++){r=_[y],a=l[y];for(var u=0;u<v.length;u++)for(var x=v[u],b=0;b<f.length;b+=2){var w=f[b],k=f[b+1],E=new Date(+x+60*w*1e3),D=new Date(+x+60*k*1e3);if(D>s&&n>E){var N=scheduler._get_block_by_config(e);N.className=m;var M=t({start_date:E},!1,d)-1,C=t({start_date:D},!1,d)-1,O=Math.max(1,C-M-1),T=d._section_height[a]-1||d.dy-1;N.style.cssText="height: "+T+"px; left: "+M+"px; width: "+O+"px; top: 0;",
r.insertBefore(N,r.firstChild),i.push(N)}}}return i}return g.apply(scheduler,[e,r,a])};var m=scheduler._append_mark_now;scheduler._append_mark_now=function(e,t){if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){var r=scheduler._currentDate(),a=scheduler._get_zone_minutes(r),s={days:+scheduler.date.date_part(r),zones:[a,a+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return scheduler._render_marked_timespan(s)}return m.apply(scheduler,[e,t])};var y=scheduler._mark_timespans;scheduler._mark_timespans=function(){
if(scheduler.matrix&&scheduler.matrix[scheduler.getState().mode]){for(var e=[],t=scheduler.matrix[scheduler.getState().mode],r=t.y_unit,a=0;a<r.length;a++){var s=r[a].key,n=t._scales[s],d=scheduler._on_scale_add_marker(n,s);e.push.apply(e,d)}return e}return y.apply(this,arguments)};var x=scheduler._on_scale_add_marker;scheduler._on_scale_add_marker=function(e,t){if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){var r=[],a=scheduler._marked_timespans;if(a&&scheduler.matrix&&scheduler.matrix[scheduler._mode])for(var s=scheduler._mode,n=scheduler._min_date,d=scheduler._max_date,i=a.global,l=scheduler.date.date_part(new Date(n));d>l;l=scheduler.date.add(l,1,"day")){
var _=+l,o=l.getDay(),c=[],h=i[_]||i[o];if(c.push.apply(c,scheduler._get_configs_to_render(h)),a[s]&&a[s][t]){var u=[],v=scheduler._get_types_to_render(a[s][t][o],a[s][t][_]);u.push.apply(u,scheduler._get_configs_to_render(v)),u.length&&(c=u)}for(var p=0;p<c.length;p++){var f=c[p],g=f.days;7>g?(g=_,r.push.apply(r,scheduler._render_marked_timespan(f,e,t,l,scheduler.date.add(l,1,"day"))),g=o):r.push.apply(r,scheduler._render_marked_timespan(f,e,t,l,scheduler.date.add(l,1,"day")))}}return r}return x.apply(this,arguments);
},scheduler._resolve_timeline_section=function(e,t){var r=0,a=0;for(r;r<this._colsS.heights.length&&(a+=this._colsS.heights[r],!(a>t.y));r++);e.y_unit[r]||(r=e.y_unit.length-1),this._drag_event&&!this._drag_event._orig_section&&(this._drag_event._orig_section=e.y_unit[r].key),t.fields={},r>=0&&e.y_unit[r]&&(t.section=t.fields[e.y_property]=e.y_unit[r].key)},scheduler._update_timeline_section=function(e){var t=e.view,r=e.event,a=e.pos;if(r){if(r[t.y_property]!=a.section){var s=this._get_timeline_event_height(r,t);
r._sorder=this._get_dnd_order(r._sorder,s,t._section_height[a.section])}r[t.y_property]=a.section}},scheduler._get_date_index=function(e,t){for(var r=0,a=e._trace_x;r<a.length-1&&+t>=+a[r+1];)r++;return r},scheduler._timeline_drag_date=function(e,t){var r,a,s=e,n={x:t},d=0,i=0;for(i;i<=this._cols.length-1;i++)if(a=this._cols[i],d+=a,d>n.x){r=(n.x-(d-a))/a,r=0>r?0:r;break}if(s.round_position){var l=1,_=scheduler.getState().drag_mode;_&&"move"!=_&&"create"!=_&&(l=.5),r>=l&&i++,r=0}if(0===i&&this._ignores[0])for(i=1,
r=0;this._ignores[i];)i++;else if(i==this._cols.length&&this._ignores[i-1]){for(i=this._cols.length-1,r=0;this._ignores[i];)i--;i++}var o;if(i>=s._trace_x.length)o=scheduler.date.add(s._trace_x[s._trace_x.length-1],s.x_step,s.x_unit),s._end_correction&&(o=new Date(o-s._end_correction));else{var c=r*a*s._step+s._start_correction;o=new Date(+s._trace_x[i]+c)}return o},scheduler.attachEvent("onBeforeTodayDisplayed",function(){for(var e in scheduler.matrix){var t=scheduler.matrix[e];t.x_start=t._original_x_start;
}return!0}),scheduler.attachEvent("onOptionsLoad",function(){for(var e in scheduler.matrix){var t=scheduler.matrix[e];t.order={},scheduler.callEvent("onOptionsLoadStart",[]);for(var e=0;e<t.y_unit.length;e++)t.order[t.y_unit[e].key]=e;scheduler.callEvent("onOptionsLoadFinal",[]),scheduler._date&&t.name==scheduler._mode&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}}),scheduler.attachEvent("onSchedulerResize",function(){if(scheduler.matrix[this._mode]){var e=scheduler.matrix[this._mode];
return scheduler._renderMatrix.call(e,!0,!0),!1}return!0}),scheduler.attachEvent("onBeforeDrag",function(e,t,r){if("resize"==t){var a=r.target||r.srcElement,s=scheduler._getClassName(a);s.indexOf("dhx_event_resize_end")<0?scheduler._drag_from_start=!0:scheduler._drag_from_start=!1}return!0})},scheduler._temp_matrix_scope();


scheduler.attachEvent("onTimelineCreated",function(e){"tree"==e.render&&(e.y_unit_original=e.y_unit,e.y_unit=scheduler._getArrayToDisplay(e.y_unit_original),scheduler.attachEvent("onOptionsLoadStart",function(){e.y_unit=scheduler._getArrayToDisplay(e.y_unit_original)}),scheduler.form_blocks[e.name]={render:function(e){var t="<div class='dhx_section_timeline' style='overflow: hidden; height: "+e.height+"px'></div>";return t},set_value:function(e,t,r,a){var s=scheduler._getArrayForSelect(scheduler.matrix[a.type].y_unit_original,a.type);
e.innerHTML="";var n=document.createElement("select");e.appendChild(n);var i=e.getElementsByTagName("select")[0];!i._dhx_onchange&&a.onchange&&(i.onchange=a.onchange,i._dhx_onchange=!0);for(var d=0;d<s.length;d++){var l=document.createElement("option");l.value=s[d].key,l.value==r[scheduler.matrix[a.type].y_property]&&(l.selected=!0),l.innerHTML=s[d].label,i.appendChild(l)}},get_value:function(e,t,r){return e.firstChild.value},focus:function(e){}})}),scheduler.attachEvent("onBeforeSectionRender",function(e,t,r){
var a={};if("tree"==e){var s,n,i,d,l,_;d="dhx_matrix_scell",t.children?(s=r.folder_dy||r.dy,r.folder_dy&&!r.section_autoheight&&(i="height:"+r.folder_dy+"px;"),n="dhx_row_folder",d+=" folder",l="<div class='dhx_scell_expand'>"+(t.open?"-":"+")+"</div>",_=r.folder_events_available?"dhx_data_table folder_events":"dhx_data_table folder"):(s=r.dy,n="dhx_row_item",d+=" item",l="",_="dhx_data_table"),d+=scheduler.templates[r.name+"_scaley_class"](t.key,t.label,t)?" "+scheduler.templates[r.name+"_scaley_class"](t.key,t.label,t):"";
var o="<div class='dhx_scell_level"+t.level+"'>"+l+"<div class='dhx_scell_name'>"+(scheduler.templates[r.name+"_scale_label"](t.key,t.label,t)||t.label)+"</div></div>";a={height:s,style_height:i,tr_className:n,td_className:d,td_content:o,table_className:_}}return a});var section_id_before;scheduler.attachEvent("onBeforeEventChanged",function(e,t,r){if(scheduler._isRender("tree"))for(var a=scheduler._get_event_sections?scheduler._get_event_sections(e):[e[scheduler.matrix[scheduler._mode].y_property]],s=0;s<a.length;s++){
var n=scheduler.getSection(a[s]);if(n&&n.children&&!scheduler.matrix[scheduler._mode].folder_events_available)return r||(e[scheduler.matrix[scheduler._mode].y_property]=section_id_before),!1}return!0}),scheduler.attachEvent("onBeforeDrag",function(e,t,r){if(scheduler._isRender("tree")){var a,s=scheduler._locate_cell_timeline(r);if(s&&(a=scheduler.matrix[scheduler._mode].y_unit[s.y].key,scheduler.matrix[scheduler._mode].y_unit[s.y].children&&!scheduler.matrix[scheduler._mode].folder_events_available))return!1;
var n=scheduler.getEvent(e),i=scheduler.matrix[scheduler._mode].y_property;section_id_before=n&&n[i]?n[i]:a}return!0}),scheduler._getArrayToDisplay=function(e){var t=[],r=function(e,a){for(var s=a||0,n=0;n<e.length;n++)e[n].level=s,e[n].children&&"undefined"==typeof e[n].key&&(e[n].key=scheduler.uid()),t.push(e[n]),e[n].open&&e[n].children&&r(e[n].children,s+1)};return r(e),t},scheduler._getArrayForSelect=function(e,t){var r=[],a=function(e){for(var s=0;s<e.length;s++)scheduler.matrix[t].folder_events_available?r.push(e[s]):e[s].children||r.push(e[s]),
e[s].children&&a(e[s].children,t)};return a(e),r},scheduler._toggleFolderDisplay=function(e,t,r){var a,s=function(e,t,r,n){for(var i=0;i<t.length&&(t[i].key!=e&&!n||!t[i].children||(t[i].open="undefined"!=typeof r?r:!t[i].open,a=!0,n||!a));i++)t[i].children&&s(e,t[i].children,r,n)},n=scheduler.getSection(e);"undefined"!=typeof t||r||(t=!n.open),scheduler.callEvent("onBeforeFolderToggle",[n,t,r])&&(s(e,scheduler.matrix[scheduler._mode].y_unit_original,t,r),scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),
scheduler.callEvent("onOptionsLoad",[]),scheduler.callEvent("onAfterFolderToggle",[n,t,r]))},scheduler.attachEvent("onCellClick",function(e,t,r,a,s){scheduler._isRender("tree")&&(scheduler.matrix[scheduler._mode].folder_events_available||"undefined"!=typeof scheduler.matrix[scheduler._mode].y_unit[t]&&scheduler.matrix[scheduler._mode].y_unit[t].children&&scheduler._toggleFolderDisplay(scheduler.matrix[scheduler._mode].y_unit[t].key))}),scheduler.attachEvent("onYScaleClick",function(e,t,r){scheduler._isRender("tree")&&t.children&&scheduler._toggleFolderDisplay(t.key);
}),scheduler.getSection=function(e){if(scheduler._isRender("tree")){var t,r=function(e,a){for(var s=0;s<a.length;s++)a[s].key==e&&(t=a[s]),a[s].children&&r(e,a[s].children)};return r(e,scheduler.matrix[scheduler._mode].y_unit_original),t||null}},scheduler.deleteSection=function(e){if(scheduler._isRender("tree")){var t=!1,r=function(e,a){for(var s=0;s<a.length&&(a[s].key==e&&(a.splice(s,1),t=!0),!t);s++)a[s].children&&r(e,a[s].children)};return r(e,scheduler.matrix[scheduler._mode].y_unit_original),
scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),scheduler.callEvent("onOptionsLoad",[]),t}},scheduler.deleteAllSections=function(){scheduler._isRender("tree")&&(scheduler.matrix[scheduler._mode].y_unit_original=[],scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),scheduler.callEvent("onOptionsLoad",[]))},scheduler.addSection=function(e,t){if(scheduler._isRender("tree")){
var r=!1,a=function(e,s,n){if(t)for(var i=0;i<n.length&&(n[i].key==s&&n[i].children&&(n[i].children.push(e),r=!0),!r);i++)n[i].children&&a(e,s,n[i].children);else n.push(e),r=!0};return a(e,t,scheduler.matrix[scheduler._mode].y_unit_original),scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),scheduler.callEvent("onOptionsLoad",[]),r}},scheduler.openAllSections=function(){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(1,!0,!0);
},scheduler.closeAllSections=function(){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(1,!1,!0)},scheduler.openSection=function(e){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(e,!0)},scheduler.closeSection=function(e){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(e,!1)};

